计算机应用
COMPUTER APPLICATIONS
1999年 第19卷 第6期 Vol.19 No.6 1999



PowerBuilder的若干公用对象设计
李振华　吕国斌　墙芳躅
　　摘　要　在PowerBuilder开发过程中，将常用操作做成公用对象，并存入公用库（.pbl）中，这种设计方法有利于提高程序的可重用性和可维护性。设计公用对象的一种方法及其设计实例在本文中作了探讨。
　　关键词　PowerBuilder，公用对象，公用库
引言
　　PowerBuilder作为主要的数据库前台开发语言，已得到了广泛的应用。这些数据可以分别用弧-结点表、弧坐标表、弧的邻接表、多边形标识表、多边形-弧表等表格表示。如果每出现一次这样操作都相应的为其写一次程序的话，那么，这些不同窗口中的程序是相似的甚至是重复的，这既增加了程序的编写工作量，又增加了程序的维护工作量。一种可行的方法是将这些常用操作做成公用对象，并存入公用库（.pbl）中，这样，在程序设计时便可直接地调用或使用这些对象。这种做法既提高了程序的可重用性和程序编制效率，又提高了程序的可维护性。
　　浏览器一般都有Cache机制，在该Cache中存放过去一段时间使用过的一些主页，预送Web主页也可以以HTML格式存于Cache中，实现时只要在浏览时运行一个后台的将预送主页存入Cache中的进程即可，实现方便。本文所提出的方法是采用参数传递：公用对象只针对入口参数进行设计，使用或调用公用对象时再向其传入具体的参数，这样，公用对象的设计便可与具体的应用设计相互独立。当然，采用此种方法，设计的关键就在于传递参数的选择及其处理。
　　由于AutoCAD记录体素的几何、拓扑信息使用的是B-rep表示法，因此针对体素，我们的仿真系统采用类似翼边结构的数据结构，建立了顶点、边、面链表结构，其中由于边链表的生成算法是通过遍历面链表，对应三角形面中的任意两个顶点都生成一条边，因此会产生一条边记录两次，为了方便删除链表结点，边采用双链表结构。相应的，它们的使用方式也不相同，公用窗口需带参数的调用；而控件则可直接在父窗口中被使用。以下分述之。
2.1　窗口类
2.1.1　查询窗口
　　查询窗口的设计流程是：在获取了被查询数据窗口的有关参数后，即弹出本窗口，由用户在本窗口
中构造出检索表达式（或称条件表达式，同where子句），并将此表达式回送原数据窗口进行过滤，并在原数据窗口中得到用户所需的查询结果。
　　在使用查询窗口前，需知道被查询窗口的有关参数。
吴翠先　硕士研究生。
　　. 数据窗口参数获取函数
　　本函数获取数据窗口以下参数：所有的字段名及其数据类型和标识。
　　定义如下:
　　入口参数：数据窗口控件名（类型Reference）。返回值：字符串。
3　ASP服务器组件的实现
　　下面用VB5.0开发一个ActiveX DLL），以实现Web页面上的随机图形显示，相信它会为你的站点增色不少。
i―ColCount = Integer(dw―1.Describe(′DataWindow.Column.Count′))[ ZK)〗 
　　其中dw―1为欲检索的数据窗口对象。
　　② 建立循环，以第1步得到的字段个数为循环次数，依次得到数据窗口中每个字段的字段名及其数据类型和标识，并将它们存入字符串中。
　　相关语句如下：
　　取字段名：
s―ColName = dw―1.Describe(′#′ + String(i) + ′.name′)
　　取字段类型：
s―ColType = dw―1.Describe(′#′ + String(i) + ′.coltype′)
　　取字段标识：
s―ColText = dw―1.Describe(s―ColName + ′―t′ + ′.text′)
说明：在生成数据窗口时，系统缺省地将字段标识的名字定为字段名+′―t′
　　上述语句中的dw―1为入口参数，i 是指第几个字段。
　　③ 返回此字符串。
3.2　透明图形的实现方法
　　在编写应用程序时，有时要在窗口移动一个小小的图形（响应鼠标动作或用Windows 定时器自动移动它），如果图形是矩形，只要调用BitBlt用SRCCOPY光栅操作码在窗口的每个新图形位置显示包含图形的位图。返回值：字符串（即检索表达式）。
　　窗口中主要控件为一数据窗口和一命令钮（见图1）。

图1　公用查询窗口示例
　　数据窗口控件用于构造检索表达式，它对应的数据窗口对象以入口参数（即原数据窗口有关参数）为数据源（其数据源设计为外部（External）），其结果集（Result Set）由以下四项组成：
　　① 字段标识――由入口参数提供，在窗口open事件中生成，编辑形式为下拉列表框，其显示值（Display Value）对应于入口参数中s―ColText，其数据值（Data Value）对应于入口参数中s―ColName。
　　② 检索符――关系运算符，编辑形式为下拉列表框。
　　③ 检索值――此项由用户填入。
　　④ 逻辑符――与或符，编辑形式为下拉列表框。
　　命令钮则根据数据窗口的用户操作结果，生成一字符串（即检索表达式）并返回。服务器内带有多种SAFs，这些SAFs实现服务器的功能和它的高级特性。并将它们传入数据窗口标识字段的编辑形式中。
dw―1.Modify(′#1.values = "′ + Message.StringParm + ′"′)
　　注意传入参数Message.StringParm须符合编辑形式的定义格式。② 如第1步操作无误，则在数据窗口是插入一空行，等待用户的输入。
　　数据窗口的itemchanged事件：当数据窗口中当前行的所有列都填满时自动插入一行，等待用户下一行的输入（程序略）。这虽然增加了一些客户的复杂度，但是大大提高了性能和分布式应用的能力。
　　④ 计算当前数据窗口中行数。如为空，则返回空值。
　　在该工程中建立ASP页面，点击菜单File | New ，在New 对话框中选Files | Active Server Page ，并指定其名字：Randimage.asp。此返回的字符串即为所需的检索表达式。
2.1.2　打印预览窗口
　　本窗口对数据窗口如下参数作定义：边界、纸张尺寸、打印方向、预览缩放比例，并作相应输出。
　　定义如下：
　　入口参数：数据窗口对象　　　返回值：无
　　窗口除数据窗口控件外，其余主要的控件可分为两类：参数设置类、操作类。
　　数据窗口是原数据窗口的一个拷贝。当工作信号失效时,自愈功能选择轮缘信号,当失效修复时再将它倒换到正常工作状态。不直接对原数据窗口进行操作也是基于通用性的考虑。
　　参数设置类控件一般为单行编辑框或下拉式列表框，供用户设置打印参数。
　　操作类控件一般为命令钮或检查框。
　　有关的程序设计主要有：
　　本窗口的open事件：
　　① 取入口参数，并据此产生本数据窗口数据源。
　　过滤器filter――搜索匹配一个给出的入口时所必须满足的条件。有关参数有：边界、纸张尺寸、打印方向、页数。
王宁生　教授，博士生导师。用Modify函数实现。
　　以边界参数设置为例：
　dw―1.Modify("datawindow.print.margin.top="
+em―top.text+&
"datawindow.print.margin.bottom="+em―bottom.text+&
"datawindow.print.margin.left="+em―left.text+&
"datawindow.print.margin.right="+em―right.text)
　　② 重新计算页数。如当前数据窗口已在预览状态下，则直接计算出。否则须改变数据窗口至预览览态下计算，计算毕，再改变回原状态。
　　计算页数：
i―Count = dw―1.Describe ("Evaluate(′PageCount()′,0)")
　　改变至预览状态：
　　dw―1.Modify("datawindow.print.preview=yes")
　　至于打印操作，可另建一公用打印窗口，用于设置打印选项，如打印范围、打印方式（分奇、偶数）、自动分页、打印份数、打印定向（到文件或打印机）等。要生成高逼真度的图像,首先要生成高质量的三维实体模型。
　　要说明的是，上述只是常用的公用窗口两个特例，参照以上方法，可以建立其它的公用窗口。
2.2　控件
　　插入、删除、保存等也是数据窗口经常要使用的操作。用自定义控件实现这些操作是一种可行的方法。用以下方法设计的自定义控件，可在父窗口中直接被使用。处于使能状态时，其它对象中的指示就象缺省对象中的同种指示一样，这就让我们可以改变缺省对象的行为。
6　结束语
　　本文提出了一种基于Web页面预送的Web服务加速技术，讨论了它的具体实现办法与相关预送策略，最后通过实验比较了采用预送技术与不采用预送技术的浏览器体系性能，我们认为这种浏览器加速技术能有效提高浏览器服务质量，具有一定的实用价值!
dw―Here=gb―WhichControl
EXIT
END CHOOSE
NEXT

//删除操作
dw―Here.DeleteRow(0)
　　这段程序中，真正执行删除操作的语句只涉及最后一行，其余的程序都是针对通用性所进行的设计。
　　以上讨论了两类公用对象：窗口类和控件类。当然，这两类公用对象在设计时也可以互相包含，公用窗口中可以直接使用公用控件，反过来，公用控件也可以调用公用窗口。
3　结语
　　将常用操作做成公用对象放入公用库中，在设计时直接调用或使用它们，是一种有效率和可维护性好的设计方法，在大型开发项目中，这种设计方法的优越性更为明显。在本文中，为保证公用对象的通用性，采取了参数传递的方法。当然，为了获得通用性，牺牲了一定程序运行效率。
　　在程序编制和撰写本文的过程中，得到了武汉菲旺电子科技有限公司的大力帮助，在此深表谢意！
作者简介：李振华　讲师。
吕国斌　副教授。
墙芳躅　 教授。该算法只需利用图中弧与多边形的拓扑信息，避免了多边形内角的计算与比较，算法中根据图的拓扑特征采取有效的策略，加快了多边形自动生成的速度。
作者单位：中国地质大学网络中心　湖北.武汉（430074)
参考文献
［1］　Biberdorf,D,著.PowerBuilder 5开发人员指南.陈向群,译.北京：机械工业出版社，1997,9
收稿日期:1998-12-27(修改稿)
