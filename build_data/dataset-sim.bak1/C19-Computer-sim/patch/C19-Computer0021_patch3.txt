计算机应用
COMPUTER APPLICATIONS
1999年 第19卷 第6期 Vol.19 No.6 1999



防火墙技术与防火墙系统设计
肖　捷
　　摘　要　本文通过对防火墙系统的两种基本技术的分析，提出了防火墙系统总体设计的基本思想，并设计了一种基于包过滤技术、代理技术和身份验证技术相结合的实用防火墙系统。
　　关键词　包过滤技术，代理技术，身份验证
1　防火墙
　　随着Internet 在世界范围内的普及，网络安全问题变得愈来愈重要。 为了防止侵入者盗窃、修改或破坏系统上的数据，维护私用网络和防止对计算机资源的非授权使用，获得对Internet比较安全的应用，防火墙系统是一种重要的应用模式。
2　防火墙技术分析
　　根据ISO/OSI参考模型，防火墙技术主要分为两大类：一类是建立在网络层上的基于包过滤技术的防火墙;另一类是建立在应用层上的基于代理技术的防火墙。
2.1　包过滤技术防火墙
　　包过滤技术防火墙，也称网络层防火墙，作用于IP层，通常由过滤路由器来构建，其实现原理是：对每一个到达过滤路由器的IP包，过滤路由器从IP包头中获得有关信息，如：IP包头中协议类型、源IP地址、目的IP地址、源端口号、目的端口号及各种标志位等信息，根据过滤路由器中预先制订好的过滤规则进行检查，决定IP包的通过或阻塞，从而实现对IP包的过滤，其核心就是过滤规则的制订。连接结构如图1。这种防火墙技术的优点是简单方便，透明性好，速度快，对网络性能影响不大，缺点是正确建立和管理包过滤规则比较困难，同时还缺乏审计、跟踪及身份验证功能。

图1　过滤路由器防火墙系统连接结构
2.2　代理技术防火墙
　　代理技术防火墙，也称应用层防火墙，作用于应用层。其核心是运行于防火墙主机上的代理服务器进程，它代替网络用户完成特点的TCP/IP功能。树中的任意一个节点都是目录信息树的一个入口（Entry）。外部网络和内部网络之间要建立连接，必须通过代理的中间转换，内部网络只接受代理服务提出的服务请求，拒绝外部网络的直接连接。连接结构如图2。
　　系统的内部结构分为如图2所示的两层：固定信息层和动态查询层。
　　关键词　预送，响应时间，Web浏览器，Web服务器
THE ACCELERATION TO WEB SERVER BASED ON
PRE-SENDING TECHNOLOGY
Tan Zhenqiang　Chen Xinmeng　Zeng Yan
Department of Computer Science and Technology, Wuhan University, Hubei.Wuhan 430072
　　Abstract　On account of the slow speed of Web Service, the paper introduces a kind of technology to accelerate the Web service based upon pre―sending Web pages . Secondly, we discuss the strategies to select pre―sent pages and to catch suitable time for pre―sending Web pages. Finally, we gave the experiment results and appraised it.
　　Keywords　Pre―send, Respond time, Web browser, Web server
1　Web浏览体系现状
　　Internet的个人用户发展迅速，使用IE或Netscape进入Internet，并通过Web访问世界各地的Web服务器成为一种时尚，然而因特网用户可能都曾体验过响应速度慢的上网浏览经历，因此，采取适当的加速策略提高Web的浏览速度非常重要。
　　工作流引擎可以是系统根据触发条件自动运行的程序，也可以是人工调用的独立程序。 自愈轮在头尾结点中需要更多的端口,但其外围结点设备简单。

图3　过滤路由器+代理服务器防火墙系统连接结构
3　防火墙系统总体设计基本思想
3.1　设计防火墙系统的拓扑结构
　　在确定防火墙系统的拓扑结构时，首先必须确定被保护网络的安全级别。从整个系统的成本、安全保护的实现、维护、升级、改造以及重要资源的保护等方面进行考虑，以决定防火墙系统的拓扑结构。通常有三种主要的拓扑结构。一、双宿主主机结构，通过在主机中插入两块网卡实现硬件连接，它是防火墙系统使用的最基本配置，这种防火墙主机的重要性是路由被禁止，网络段之间唯一的路径是通过应用层的服务程序来实现。二、屏蔽主网关结构，即由过滤路由器和代理主机分别实现包过滤和代理服务两级安全防护，其中代理主机是这种结构防火墙系统的中心主机，通常称为堡垒主机。三、屏蔽子网网关结构，即由两台路由器和一台堡垒主机构成一个中间的过滤子网，由其实现外部网与内部网的分离，但内部网、外部网都可以访问中间的过滤子网，显然，这种结构的安全性较好。你可编辑这个文件以便安装和配置自己的SAFs。前一条策略拒绝一切未经认可的服务，防火墙封锁所有的信息流，逐一完成每项许可的服务。
　　我们可以将点、弧段、多边形组成的图形看成为一个连通图，这里要提出的算法是从图的拓扑信息即弧与弧的邻接关系（以弧-结点表、弧的邻接表表示）自动生成所有的最小多边形，从而建立多边形的拓扑关系，至于由多边形的标识点生成弧的左右邻接表的算法，这里不予讨论。
3.3　确定包过滤规则
　　包过滤规则是以处理IP包头信息为基础，在设计包过滤规则时，一般先组织好包过滤规则 ，然后再进行具体设置。
3.4　规划代理服务器
　　代理服务器(PROXY)是防火墙系统中的一个服务器进程，安装运行在防火墙主机上，为内部网络与外部网络充当中继，阻止内部网络与外部网络的直接连接。这种操作模式可能会带来性能上的问题。对于网络管理员来说，选择一个成熟且便于管理和配置的代理服务器程序非常重要，图4给出了代理服务器的逻辑结构。

FTP代理TELNET代理WWW代理……
用户身份验证模块
监控、记录模块

图4 代理服务器的逻辑结构
4　防火墙系统设计实例
　　按照防火墙系统总体设计基本思想，本文给出了一个基于包过滤技术、代理技术以及身份验证技术相结合的实用防火墙系统，拓扑结构如图5。该防火墙系统由一个内部路由器、一个代理服务器和一个边界路由器构成一个中间的过滤子网，以实施安全防护。它的表结构由该工作流的联系类参数决定，表中的参数由系统根据用户在过程定义工具的引导下输入的数据决定。设计的过滤规则如下表。
<%
//提取编号为sql―id的查询语句
var sql―text=rsTmp.fields.getValue("s―text");
//创建、初始化Recordset对象
var rsResults=Server.CreateObject("ADODB.Recordset");
rsResults.CursorType=adOpenDynamic;
rsResults.LockType=adLockOptimistic;
//执行编号为sql―id的查询
rsResults.Open(sql―text,DBConn);
//以超文本方式显示查询结果
var rdCount=rsResults.getCount(); 
//记录数
var fdCount=rsResults.fields.getCount();
//字段数
%>
<table border=1>
<thead>
<tr>
<% for i = 0 to fdCount -1 %>
<th>
<% =rsResults.fields.getName(i) %>
</th>
<% next %>
</tr>
<tbody>
<%
for i = 0 to rdCount - 1
Response.Write("<tr>");
for j = 0 to fdCount - 1
Response.Write("<td>");
Response.Write(rsResults.fields.getValue(j));
Response.Write("</td>");
next
rsResults.moveNext();
next
%>
</tbody>
</table>
5　结语
　　上述系统设计和实现只是整个Web应用中的一部分，尚有许多需要改进和增加的部分，如：参数查询处理、用户标识验证、安全性机制、事务处理、数据库管理的Web化以及用户的个性化设置等。
表1　外部路由器过滤规则表

过滤规则号允许/拒绝源IP地址源端口号目的IP地址目的端口号协议ACK位描述
1允许外部网络＊代理服务器＊TCPACK　
2允许内部网络＊＊＊TCPACK　
3允许代理服务器＊＊＊TCPACK　

表2　内部路由器过滤规则表

过滤规则号允许/拒绝源IP地址源端口号目的IP地址目的端口号协议ACK位描述
1允许内部网络＊＊＊TCP＊　
2允许＊＊＊＊TCPACK　
3允许代理服务器＊＊＊TCP＊　

4.2　代理服务器的设计
　　代理服务器为内部网络和外部网络双方的通信充当中继，阻止内部网络和外部网络的直接连接，再辅以用户身份验证模块和监控、记录模块，可以完全控制通信双方的会话过程，提供更高级的安全性。服务器依据这些返回代码可以决定是跳到下一步、执行当前一步的下一个SAF还是取消处理。

图6　代理服务器逻辑结构
　　我们选用Netscape Proxy server3.5代理服务器软件，在安装好代理服务器后，再设计一个代理服务器的配置文件，代理服务器根据该配置文件的源IP地址、目的IP地址和身份验证控制内外网络的访问权限，利用监控、记录模块实现对所有数据流的监控和记录，以提供网管所需的各种数据。另外，为了防止侵入者窃取系统口令文件和通过偷听网络连接来获取合法用户ID和口令，从而对内部网络进行攻击，本系统采用了一次性口令系统（OTP）对用户身份进行认证，以进一步提高整个网络系统的安全性。该算法只需利用图中弧与多边形的拓扑信息，避免了多边形内角的计算与比较，算法中根据图的拓扑特征采取有效的策略，加快了多边形自动生成的速度。
作者简介：肖捷　工程师。主要研究分布式计算系统、分布并行算法。
　　. 如果在一个或多个流入轮辐信号中检测到LOS,则：
　　a) 将最小的失效轮辐号赋给i;
　　b) 为所有到点 i+1,i+2,…,Q的下游轮辐信号设置AIS;
　　c) 将所有结点号为 i+1,i+2,i+3,…,Q 相关的保护型VP倒换到结点i的轮辐信号上;
　　d) 将所有结点号为 i+2,i+3,…,Q 的相关保护型VP倒换到结点i+1的轮辐信号上去(这样能恢复轮缘结点失效);
　　e) 在轮缘信号上接收所有来自结点 i, i+1,i+2,…,Q的保护型上游业务(或相当于来自结点Q的轮辐信号)