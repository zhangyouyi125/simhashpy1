计算机应用
COMPUTER APPLICATIONS
1999年 第19卷 第6期 Vol.19 No.6 1999



防火墙技术与防火墙系统设计
肖　捷
　　摘　要　本文通过对防火墙系统的两种基本技术的分析，提出了防火墙系统总体设计的基本思想，并设计了一种基于包过滤技术、代理技术和身份验证技术相结合的实用防火墙系统。
　　关键词　包过滤技术，代理技术，身份验证
1　防火墙
　　随着Internet 在世界范围内的普及，网络安全问题变得愈来愈重要。在另一台装有NT操作系统的主机上运行Winproxy软件，主板上两块网卡一块连Server，一块连到Hub上，构成网关，它最多同时代理五个连接。 ASP文件可通过通用的文本编辑器 （如记事本） 或专门的集成开发环境Visual InterDev进行开发;
　　. 编程语言通用。
　　例：（本例是执行身份认证的函数）
#include "base/pblock.h"
#include "base/session.h"
#include "frame/req.h"
typedef struct {
char *name;
char *pw;
} user―s;
static user―s user―set［］ = {
{"joe", "shmoe"},
{"suzy", "creamcheese"},
{NULL, NULL}
};
#include "frame/log.h"
#ifdef XP―WIN32
#define NSAPI―PUBLIC ―　―　declspec(dllexport)
#else /* 。（2）预送Web页面机制以独立于主页服务程序的状态出现：预送机制以一个通用的浏览服务加速程序来实现，当启动该加速程序后，它自动检测主页使用之间的关联关系，与浏览服务程序并行执行。这种防火墙技术的优点是简单方便，透明性好，速度快，对网络性能影响不大，缺点是正确建立和管理包过滤规则比较困难，同时还缺乏审计、跟踪及身份验证功能。

图1　过滤路由器防火墙系统连接结构
2.2　代理技术防火墙
　　代理技术防火墙，也称应用层防火墙，作用于应用层。其核心是运行于防火墙主机上的代理服务器进程，它代替网络用户完成特点的TCP/IP功能。一个代理服务器实际上是一个为特定网络应用而连接两个网络的网关，对于每一种不同的应用服务，都必须有一个相应的代理。外部网络和内部网络之间要建立连接，必须通过代理的中间转换，内部网络只接受代理服务提出的服务请求，拒绝外部网络的直接连接。连接结构如图2。这种防火墙技术的优点是它能完全控制通信双方的会话过程，具有用户级的身份验证、日志管理和帐号管理功能，提供了比过滤路由器更为严格的安全性，缺点是缺乏透明性，影响网络性能，必须针对每一项服务都建立对应的应用层网关，才能提供全面的安全保证，这势必严重限制新应用的采纳。能否开发一个包罗万象的代理服务器，将有利于新应用的挂接。

图2　代理服务器防火墙系统连接结构
　　综合上述两种防火墙技术的优缺点，在实际构建防火墙系统时，通常由过滤路由器和代理服务器组合在一起构成一个混合的多级防火墙系统，由过滤路由器提供第一级的安全防护，主要用于防止IP欺骗攻击，再由代理服务器提供更高级的安全防护机制。连接结构如图3。

图3　过滤路由器+代理服务器防火墙系统连接结构
3　防火墙系统总体设计基本思想
3.1　设计防火墙系统的拓扑结构
　　在确定防火墙系统的拓扑结构时，首先必须确定被保护网络的安全级别。从整个系统的成本、安全保护的实现、维护、升级、改造以及重要资源的保护等方面进行考虑，以决定防火墙系统的拓扑结构。根据需要,由STM集中器提供给用户透明的承载通路,一些用户可能用专线。一个对象标签有name和ppath两个参数，它们都可有自己的通配符。二、屏蔽主网关结构，即由过滤路由器和代理主机分别实现包过滤和代理服务两级安全防护，其中代理主机是这种结构防火墙系统的中心主机，通常称为堡垒主机。修改辨识名请求定义为：

entrynewrdndeleteoldrdnnewSuperior

参数说明如下：
　　入口entry――将被修改的入口的辨识名。

图1　动态协作机制的实现
2.4　工作流复杂流程的实现
　　为联系类增加一些控制参数就可以实现复杂的工作流程。前一条策略拒绝一切未经认可的服务，防火墙封锁所有的信息流，逐一完成每项许可的服务。后一条策略允许一切没有被禁止的服务，防火墙转发所有信息，逐一删除被禁止的服务。
3.3　确定包过滤规则
　　包过滤规则是以处理IP包头信息为基础，在设计包过滤规则时，一般先组织好包过滤规则 ，然后再进行具体设置。
3.4　规划代理服务器
　　代理服务器(PROXY)是防火墙系统中的一个服务器进程，安装运行在防火墙主机上，为内部网络与外部网络充当中继，阻止内部网络与外部网络的直接连接。失效时,自愈轮将“简化”为ATM环。对于网络管理员来说，选择一个成熟且便于管理和配置的代理服务器程序非常重要，图4给出了代理服务器的逻辑结构。虽然一条弧可能在一个或几个多边形的列表中出现，但是每一条弧只存贮一次。该防火墙系统由一个内部路由器、一个代理服务器和一个边界路由器构成一个中间的过滤子网，以实施安全防护。

图5　实用防火墙系统拓扑结构
4.1　包过滤规则的设计
　　对于过滤路由器中过滤规则的设计，我们采用的安全策略是：不允许IP源路由，起于内部网络的服务允许给过滤子网中的代理服务器，允许外部网络到代理服务器的流量，允许过滤子网中代理服务器到内部网络的流量。
　　工作流列表由工作流代号、联系对象参数表名、联系类名组成，是工作流启动的入口。采用这种过滤机制，使得路由器中的规则库仅包含3条规则，既方便维护和管理，又易于验证过滤规则的完备性和正确性。
表1　外部路由器过滤规则表

过滤规则号允许/拒绝源IP地址源端口号目的IP地址目的端口号协议ACK位描述
1允许外部网络＊代理服务器＊TCPACK　
2允许内部网络＊＊＊TCPACK　
3允许代理服务器＊＊＊TCPACK　

表2　内部路由器过滤规则表

过滤规则号允许/拒绝源IP地址源端口号目的IP地址目的端口号协议ACK位描述
1允许内部网络＊＊＊TCP＊　
2允许＊＊＊＊TCPACK　
3允许代理服务器＊＊＊TCP＊　

4.2　代理服务器的设计
　　代理服务器为内部网络和外部网络双方的通信充当中继，阻止内部网络和外部网络的直接连接，再辅以用户身份验证模块和监控、记录模块，可以完全控制通信双方的会话过程，提供更高级的安全性。在每一个结点处，若结点的度为m，则在这一算法中，必须进行如下计算：利用公式
ψ=arctg［(y2-y1)/(x2-x1)］
计算m次反正切；作m(m+1)/2次角度的比较。

图6　代理服务器逻辑结构
　　我们选用Netscape Proxy server3.5代理服务器软件，在安装好代理服务器后，再设计一个代理服务器的配置文件，代理服务器根据该配置文件的源IP地址、目的IP地址和身份验证控制内外网络的访问权限，利用监控、记录模块实现对所有数据流的监控和记录，以提供网管所需的各种数据。
　　新优先级newSuperior――是可选项，其值为LDAPDN类型。数据库系统无特殊要求，只须支持ODBC即可，并且数据库系统可安装于Web服务器上，也可安装于另外服务器上，成为数据库服务器。
作者简介：肖捷　工程师。研究方向：计算机网络及数据库系统。
作者单位：广东省韶关大学　广东.韶关（512005）
参考文献
［1］　（美）Chris Hare Karanjit Siyan,著.Internet防火墙与网络安全.北京:机械工业出版社,1998
［2］　（美）David Wolfe,著. Microsoft Proxy Server开发指南.北京:电子工业出版社,1998
［3］　(美)William A.T., Mary A.P., Keith A.B,著.Internet 使用大全.北京:清华大学出版社,1995
收稿日期:1999-01-10(修改稿)
