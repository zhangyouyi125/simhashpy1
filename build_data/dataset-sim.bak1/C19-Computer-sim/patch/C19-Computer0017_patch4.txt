计算机应用
COMPUTER APPLICATIONS
1999年 第19卷 第6期 Vol.19 No.6 1999



用OpenGL开发虚拟制造环境（一）
周杰韩　杜润生　吴波
　　摘　要　本文介绍了几何图形信息的数据结构、存储与显示基本原理。从应用程序角度论述Windows图形设备接口GDI的客户服务器本质及虚屏幕显示技术。最后讲述OpenGL图形库在虚拟制造仿真的应用基础。
　　关键词　虚拟制造，客户/服务器，OpenGL图形库
1　计算机图形
1.1　几何图形信息的数组结构
　　图形显示是从点的显示开始的。Java使能的Web浏览器为网络和系统管理员执行各种管理任务提供了灵活、一致的操作用户接口，被管理的网络设备和资源中安装有相应的管理代理SNMP Agent，通过代理与Web管理服务器交换管理信息。几何学上的点是没有大小的。线段的显示实际上用有限个点来产生图形，因而每个点都有一定的大小。此时的点不再是真正的几何点，而是像素（图像基本元素）。
　　另外，因为消息在没有碰到故障时，采用的是最短路径路由。显示屏如同由像素组成的二维数组。每个像素对应数组的一个元素。每个像素有一个地址，对应数组的下标。像素亮度值对应元素值。设定显示屏上每一像素的亮度可以产生一幅图像。
1.2　几何图形信息的存储

图1　帧缓冲器与图像显示
　　一幅图像是由有限数量的像素组成。一个分辨率较高的显示设备若在x和y方向各有1000个像素，则这个显示屏将含有100万个像素。为了显示每一点的亮暗，每一像素至少需要1比特的亮度信息，其存储空间至少需要100万/8个字节。用来存储像素亮度数组的存储器称为帧缓冲器。
　　对计费管理的具体实现如下：(1) 在交换机的实时操作系统IMX平台上用C语言实现了一个处理计费数据的计费管理程序，该程序的主要功能是对计费数据进行分拣、分类和结算。
1.3　几何图形信息的显示
　　光栅显示是用得较多的图形显示方法。光栅显示是利用扫描发生器每秒钟扫描帧缓冲器30到60次，将代表像素亮度的信息一行一行取出，然后送往显示器。帧缓冲器的存取地址与光栅扫描信号同步地产生。帧缓冲器的内容用来输出视屏信号控制阴极射线管电子束强度。强度大小决定像素的显示明暗。网管平台还提供存储、访问和交换网管数据所需的通信功能和存放MIB的数据库管理系统；并为用户提供一致的图形用户界面（GUI）和一定的开发工具供用户开发管理模块以便装入平台。这样做不光访问方便了，也解决了一些通常方法完成不了的问题(具体参见文献[2])。每一次扫描帧缓冲器都使屏幕得到刷新。由于光栅显示系统利用直接存储器存取（DMA）硬件不断地扫描帧缓冲器，并把图形显示出来，因而图像生成不受中央处理器（CPU）控制。
　　本文介绍的用于连体字符处理的分离、修剪算法包括：
　　(1)搜索鞍点　搜索鞍点是一直线向前的过程。显示文件驱动程序形成图形应用程序与显示设备之间的接口。若应用程序可以产生标准显示文件代码，那么每个带有驱动程序的具体显示设备就能正确地运行应用程序，从而提高了应用程序的可移植性。显示设备与显示驱动程序通常由硬件商一起提供。
1.5　应用程序图形显示步骤
　　帧缓冲器数组直接与显示屏内容相对应，并且以亮度编码的形式保存了被显示的图形。在 Mapping 方面一般用C++。其次应用程序把图形信息写入帧缓冲器，由帧缓冲器直接传送到显示设备。空帧缓冲器对应空白的显示屏。最后由结束图形程序释放显示设备包括重新分配存储器。
2　Windows环境下的图形显示
2.1　Windows环境下的虚屏显示
　　在MS-DOS应用中，图形和文本程序不仅常常直接写到视屏上，而且这样做时经常绕过BIOS屏幕调用。然而在Windows环境下避免了这种状况。
1　相关研究
　　近年来提出了许许多多的MPP系统互连网络中的路由算法。所有应用程序的显示活动，都必须通过Windows API函数来操作。任何试图绕过API函数都视为扰乱系统的行为。其次在Windows环境下屏幕操作根本不写到物理视屏上，即使使用API函数时也是这样。应用程序请求写文本或图形的操作，都是将信息写到虚拟屏幕也称为设备环境DC。最后Windows把虚拟屏幕映像到物理显示屏上。
2.2　图形用户接口（GDI）的客户/服务器本质
　　Windows将应用程序从具体输出设备中分离出来。在MS-DOS中，应用程序负责为所有输出设备编程。Windows应用程序不负责对输出设备编程。图形用户接口GDI为应用程序提供了一套独立于设备的标准绘图指令集。对于添加的新硬件，由硬件制造商提供驱动程序，而应用程序则通过GDI创建并维护设备环境（DC）。Win32应用程序在Windows95环境下都被分隔成了用户模式与核心模式。在用户模式下禁止直接取用图形设备资源，而是交给操作系统核心模式来完成。这种模式称为GDI的客户/服务器模式如图2。GDI的客户/服务器模式有效地将应用程序彼此分离，从而提高了Windows 环境的安全特性。而且任何访问输出设备的函数都留在GDI的服务器方，从而保证了入侵应用程序不能直接访问到其它应用程序的屏幕数据。

图2
3　OpenGL应用程序的图形支持
3.1　OpenGL图形软件在应用中的地位
　　OpenGL是SGI公司的IRIS GL图形工作站的分支。近年来，作为工业标准图形程序库，在CAD/CAM等需要高级的三维对象可视化和图形绘制领域得到广泛应用。OpenGL为应用程序员提供了程序和图形输入输出设备之间的功能接口，定义了一个独立于语言的图形核心系统。编写应用程序过程中，用符合语言的约定方式把OpenGL嵌入到相应的语言之中。OpenGL在图形应用中的地位如图3所示。许多代理被写成代理服务API，包括：
　　diakinfo 磁盘信息，etherif 以太网接口统计，hostif 接口统计，hostmem 主机内存使用，hostperf 主机运行数据，iostat 磁盘I/O，CPU和终端统计，ippath IP分组路由路线信息，iproutes IP路由表和统计，layers 物理层统计，lpstat 打印机状态，ping IP联结信息，rpcnfs RPC和NFS统计，snmp MIB I，II，snmpd SPARC系统的SNMP代理，sync 同步接口统计，traffic 以太网流量分析。

图3
3.2　OpenGL客户/服务器图形显示方式
　　OpenGL通过客户/服务器方式实现图形显示。应用程序作为客户工作并调用OpenGL API。OpenGL客户模块同OpenGL服务模块通信并发出应用程序的OpenGL命令。OpenGL服务模块调用Win32设备驱动接口来使用驱动程序。 
　　专线接入客户端微机的基本配置为 P II-300、内存 32M、硬盘4GB ，通信设备为 10M 3COM网卡，外部配备为 AGAF DUOSCAN T1200透射式扫描仪和16位声卡及配套的话筒和音箱。
　　远程会诊流程如图2所示，请求会诊客户方将需要会诊病人的病历资料整理分成三类，分类（按不同的扫描方式）扫描生成图形文件。OpenGL环境又叫着色环境，是OpenGL与Windows系统之间的桥梁。所有的OpenGL调用都通过着色环境来完成。OpenGL着色环境与设备环境有相同的像素格式。在为一个设备环境设置好了像素格式后就可以产生一个与之接近的着色环境。通过给出的设备环境，着色环境就可以在设备环境指出的设备上绘图。其逻辑模式如图4。

图4
　　用OpenGL去着色一个Windows窗口的典型操作过程如下：
　　. 建立正确的窗口格式；
　　. 建立像素格式；
　　. 创建设备环境；
　　. 创建一个着色环境；
　　. 将着色环境设为一个线程的当前着色环境；
　　. 线程进行有关OpenGL的初始化；
　　. 线程调用OpenGL着色函数；
　　. 当OpenGL处理结束后，将着色环境设为非当前使用的（断开与着色环境的联系）；
　　. 释放着色环境与设备环境。 
注：国家教委博士点基金资助。在理论上，JMAPI的应用程序在整个Web上将以同样的界面和功能灵活地实现互操作。
作者简介：卢　达(1949～)，男，副教授，主要研究方向为模式识别、图象处理等
作者单位：卢　达　浦　炜　常熟高等专科学校，常熟　215500
　　　　　谢铭培　复旦大学计算机科学系，上海　200433
参考文献
1 Fujisawa H,Nakano Y,Kurino K.Segmentation Methods for Character Recognition:from Segmentation to Document Structure Analysis. Proc. of the IEEE, 1992, 80(7): 1079-1092
2 Kahan S,Pavlidis T,Baird H S.On the Recognition of Printed Characters of Any Font and Size. IEEE Trans.Pattern Anal. Machine Intell, 1987, 9(2): 274-288
3 Mitchell B T,Gillies A M. A Model-based Computer Vision System for Recognizing Handwritten ZIP Codes. Machine Vision and Applications, 1989:231-243
4 Tsujimoto S,Asada H.Major Components of a Complete Text Reading System.Proc. of the IEEE, 1992,80(7):1133-1149
收稿日期：1998-12-21
。(2) Dispatcher：为了使远程网元有一定的管理功能，必须将管理应用分发到远程网元系统