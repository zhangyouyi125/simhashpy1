计算机应用
COMPUTER APPLICATIONS
1999年 第19卷 第6期 Vol.19 No.6 1999



板材柔性制造系统中的数据接口技术
陈慧宝　程远利　张振龙
　　摘　要　本文介绍了板材柔性制造系统中的数据接口技术。叙述了CAD/CAPP系统集成技术中的一些关键问题，并提出了有效的解决方法。
　　关键词　钣金,板材,CAD/CAPP,数据接口
　　我们为沈阳某科技公司板材柔性制造系统设计了一套钣金产品计算机辅助设计加工系统。和单纯分层和分布式体系结构不同的是：管理器的组织结构按照网络的方式组成。钣金CAD子系统基于通用绘图软件AutoCAD进行二次开发；CAD/CAPP数据接口子系统通过对CAD子系统的图形信息进行分析处理后，传输给CAPP子系统完成CAD/CAPP的内部数据连接，对信息联机传递、实时处理。

图1　系统组成简图
1　钣金产品图形数据特点
　　钣金产品CAD子系统是基于参数化思想而设计的。只要输入几个关键的参数，系统自动生成钣金零件的三维视图和展开图。展开图是一个二维图形，CAD/CAPP数据接口对展开图的*.DXF命令组文件进行处理，传递信息到CAPP子系统用于满足板件的冲裁下料。

图2　钣金件设计方案
　　钣金产品的设计和加工有其自身的结构、材料和工艺特点。
2.2　MA&C系统Agent的通信
　　由于MA&C是一个基于MultiAgent和CSCW的多媒体教学系统，而一个协同系统中，通信是基础，合作是形式，协调是关键。
　　不失一般性，假设处理机集合P={P1,P2,…,Pp}通过相同的网络连接而构成一个BSP计算机，各处理机的通信速度g基本相同。
　　2） 落料加工的所有工艺特征，如粗糙度、定位精度、直线度等均由NC机床保证。
　　CAD系统的信息模型是几何学模型、线架模型、面架模型及体素造型，对于公差和技术要求是按标注信息进行处理。CAPP系统要求的是工艺特征和制造信息， 而不是点、线、面的几何特征。并且由于钣金产品设计加工的自身特点，以*.DXF文件作为数据文件直接作为CAPP子系统的输入信息存在许多问题。
　　鉴于以上各种因素，为保证OLTP的性能，必须将数据仓库与传统操作数据相分离，为了获得数据仓库中的数据，首先必须进行数据仓库的设计。
　　. 几何交点不重合
　　由于*.DXF文件中的几何点信息是CAD图形通过内部计算而获得的，许多图形元素的几何交点实际上是两个点。尽管两点之间的误差很小，不影响加工精度，但是这样的图形数据不能用于CAPP子系统进行自动工艺编程。
　　. 无序的拓扑关系
　　由于在*.DXF文件中，图形相关数据按CAD子系统在AutoCAD图形界面生成图形元素的先后顺序而存储，因而不能保证组成零件图形的各图形元素之间的拓扑关系是否具有精确的逻辑关系。
*基金项目：国家自然科学基金、浙江大学曹光彪高科技基金
作者简介：余春艳(1976～)，女，研究生，主要研究方向为CSCW、MultiAgent、智能CAI
作者单位：浙江大学人工智能研究所，杭州　310027
参考文献
1Koch M.The Collaborative Multi-user Editor Project　　Iris.TUM Info XI,1995-08 
2林守勋,林宗楷,郭玉钗等.多Agent协同工作环境MACE.计算机学报,1998,21(2)：188-192
3齐英剑,赵志勇,齐英辉.计算机支持的协同工作及系统模型研究.第一次全国 CSCW 学术会议论文集,北京:电子工业出版社,15-19 
收稿日期：1998-12-24
。这样的图形是不能用于数控加工的。
　　数据库主要操作对象是多维数据，因此也称为多维数据库。而展开图的*.DXF文件包含的有关轮廓信息不能确定环的走向，须对组环实体进行分析计算，根据数据文件输出要求的加工走向，依序将环中实体写入数据文件中。
2　解决方法
2.1　把问题消灭在CAD子系统内
　　在CAD子系统总体设计时考虑CAPP的要求。场所是Agent之间进行交易的地方，一般情况下，每个场所都有一个服务 Agent ，用户Agent需要某种服务时必须移动到提供该服务的场所与服务Agent 进行交互才能完成交易。对于CAPP子系统，做一个数据接口软件，其任务是对零件展开图的*.DXF文件做进一步处理，内容包括：剔除非加工信息（包括不必要的工艺信息和技术说明）；修正消除几何不重合点，建立拓扑关系，找出加工环；按照事先约定指出加工环走向。
3　设计思想及算法实现
　　在钣金产品CAD子系统中，零件展开图先用AutoCAD的EXPLODE命令将图形打碎，再生成相应的*.DXF文件。只从*.DXF中提取与工件廓形数据有关的实体段信息(CIRCLE、LINE、ARC)到程序中；进行分析计算找出图形信息中外轮廓上一点，依据此点找出外轮廓加工环；在余下的图形信息中寻找其余的内轮廓加工环(CIRCLE作为一个独立的加工环)；判断环向，并将加工环所含图形信息依环向写入数据输出文件中。

图3　流程简图
3.1　系统的数据结构
　　本系统数据结构采用双向链表结构。由于钣金加工特点(板材均匀性)，因此可以简单按二维图形处理。而且，无论是冲孔还是落料，其轮廓都构成闭环,它是由直线或圆弧首尾相连构成的图形(或是一个整圆)。
　　建立

　class ARC:public CIRCLE,public LINE
　{ 
　int Direct;
　};
　　其中，类ARC是类CIRCLE、LINE的子类。协作者凭借良好的愿望、常识和社会行为来避免冲突。
3.2　几何信息提取模块
　　图形实体经打碎后成为“LINE”、“ARC”、“CIRCLE”三种类型(经研究发现，对V13.0图形实体打碎到最后均为LINE、ARC、CIRCLE，如Fit拟合的Pline解碎后为Arc，Spline拟合的Pline解碎后为Line等)。因此程序的核心以ARC、LINE、CIRCLE为对象。
　　目前，CSCW已广泛应用于CAD、远程医疗诊断、多媒体协同编著、电子会议等领域。
　　例如：对于直线，可用10和11组码提取其起点、终点坐标。
3.3　组环算法
　　每一个class中都有一个Distant()函数，这个函数用于寻找每一个实体上距原点距离最大点。比较所有实体的Distant()函数值，从中找出距原点距离最大点，该点对应的实体N1必在外轮廓上。其主要成员有通信线程的指针m_pComThread，在构造函数中赋值，用于向通信线程发送消息。
　　如果N1为直线或圆弧，则以实体N1为基准组环S0(外轮廓加工环)。以N1起始点为环S0的起点，以N1终止点为环的下一个实体的起始点。由于执行的主体程序在服务器上，所以必须在服务器上安装所需要的服务进程。该点所在实体作为环的第二链，继续在余下的实体ARC和LINE中寻找环的下一链，并判断链中的终止点是否与环的起点近似重合。不重合重复此过程，否则外轮廓环S0组环结束。
　　在余下未组环的实体ARC、LINE中继续组环S1、S2、S3、S4…(均为内轮廓环，组环方法同上)。直至所有实体ARC、LINE均组入各环中。
　　读取余下的实体CIRCLE作为内环。
3.4　数据输出模块
　　在输出时判断环的走向。对于三个实体组成的环，直接两实体叉乘，运用右手定则判断环的走向；对于一般实体环寻找环内点，引直线进行叉乘计算判断环向，再按照约定格式输出数据到数据文件中，并将数据文件传送到CAPP子系统。当某一个域(domain a)需要另一个域(domain b)的信息时，对等管理者(管理者a和管理 者b)之间进行通信。CAD/CAPP数据接口子系统将CAD模块输出的图形信息转换成CAPP可以接收识别的数据格式，实现了CAD和CAPP之间信息的提取、交换、共享和处理。其成员和方法与CMsg类相近。以下结合多种代表性计算模型，给出适合于异构网络计算环境的程序设计和开销计算方法