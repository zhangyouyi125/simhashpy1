 
作者单位：上海大学通信工程系，上海 201800
参考文献 
1 Internets Structure and Identical of Management Information for TCP/IP Base.RFC1155. 1990-05 
2 A Simple Network Management Protocal.RFC1157.1990-05 
3 周明天，汪勇编 . TCP/IP 原理与技术 . 北京：清华大学出版社 , 1993 
4 石冰心 . 中国教育和科研计算机网的研究与发展 (1). 武汉：华中 理工大学出版社 , 1996 
计算机工程
 ENGINEERING
1999年 第25卷 第8期 Vol.25 No.8 1999



在线络收费管理的分析与研究
罗静，真藓科青藓
摘要：对HFC网的Internet服务收费机制进行了分析和设计，讲座了针对HFC网的使用者入特点，分析了收费系统的一些关键问题和难点，从而提出解决方式。
关键词：计费；简单网络管理；传输控制/网间协议；光纤同轴电缆混合
Analysis and Research on Accounting Managemetn in HFC
Luo Jin,Wang Ming
(Department of Communication Engineering,Shanghai Univ.,Shanghai 201800)
【Abstract】This article analyizes the methods of accouting for Internet service,discusses the characters of HFC access network,proposes some important questions and difficulties,and then gives the solutions to them.
【Key words】Accounting;SNMP;TCP/;HFC
　　网络计费系统可分两大部分：数据采集和对采集的数据进行分析处理。由于用户使用网络的方式不同，其数据的采集方法也不相同，而用户本身又可分两类：个人用户和集团用户 ( 如学校等 ) ，对他们的计费方式都有所区别。个人用户一般通过电话拨号玩游戏，而集团用户则通过 x.25 、 DDN 、以太网等有  连接的方式上网。电话拨号又可分两种：仿真终端方式和 PPP/SLIP 方式。为了简化系统的设计和实现，对计费系统提出以下原则： 1) 个人用户 ( 拨号方式 ) 按使用时间计费； 2) 集团用户 ( 专线方式 ) 按使用的数据流量计费。整个系统实现的过程如图 2 所示： 

图2 IP流量计费系统实现过程
　　该计费系统只是处理一个边界路由器时的情况。 
1 计费系统研究 
　　HFC 是一种光纤同轴电缆混合用户接入网解决方案 , 主干线路为光纤 , 靠近用户这段为同轴电缆 , 用户通过  Modem 连入 HFC,Cable Modem 有 RJ45 ，用户只需插入一块 802.3 网卡就可以上网了。计费管理方案如下： 

图1 HFC拓补结构

以上针对单个用户申请 DHCP 分配 IP 地址的形式，主要根据用户上网时间来计费，对匿名用户可以不收取费用。 HFC 的网络管理是决定网络能否正常运转的前提，而网络计费功能又是网络管理中一个非常重要的方面，它与每个用户的切身利益密切相关。 
　　经过分析和研究 , 整个计费系统分为两部分：用户上网时间计费系统和 IP 流量计费系统。使用 JAVA 网络编程实现灵活性比较高，易于开发出跨平台的系统，既可以运行在 UNIX 工作站上，又可以运行在 NT/95 PC 机上，对硬件要求较低。 

　　人们还注意到，在美国纳斯达克上市的的首支中国网络股对中国将加入ＷＴＯ立即作出反应，中华网国际网络传讯有限公司Ｃｈｉｎａ．ｃｏｍ在纳斯达克股市上涨幅度达７５％，冲出１００美元的高价，再次受到当地投资者的追捧。。而 HFC 网中用户计算机通过网线连入 HFC 网中，相当于专线连接，网络在物理上是一直连通的。虽然 HFC 网不存在用户抢占 RAS 拨号端口的问题，但是 HFC 是树型拓扑结构，李鸿琦的 MAC 规约采用上、下行信道的非对称结构，并将上行信道划分多个竞争信道和预约信道。所以也存在用户抢占上行信道传输信息的问题，这样用户占用信道类似于拨号占用通信端口，对用户连接时间记录是非常有意义的，这也是 HFC 不同于一般专线连接局域网所在。在这种情况下，如果对用户上网时间进行记录可以效仿拨号上网的通信机制，开发一个客户机 / 服务器模式的通信软件包，它由 Server Program 和 Client Programme 两部分组成， Client Programme 提供给用户一个登录界面， Server Programme 相当于一个 RAS 软件，负责帐号的验证和用户上网信息 ( 包括上网时间 ) 的记录。被收集数据的类型与各个网络厂商的 IBEX 定义有关，如在 Cisco 公司的路由器中，对 MIB 对象标志符 1.3.6.1.9.2.4.9(LIPCKAccountingTable) 进行记录，就可以获得经过边界路由器的每个 IP 连接的源地址和目标地址所传送的 IP 包数和 IP 字节数，它反映了区域网内每个 IP 地址到网外的流量。考虑到 Router 有基于 IP 地址的包过滤功能，例如 Cisco 路由器中，通过 access-list list {permit|deny} protocol source source-mask destination destination-mask [string operand][established] 命令可以配置哪些 IP 包可以被路由器转发到 HFC 网外。所以可以通过 Server Programme 执行该命令来控制路由器， Server 验证为合法的 Internet 帐号把响应的 IP 地址记录到路由器中，并开始记时；当用户退出时，再由 Server 把该 IP 地址从路由器中删掉，同时把现在的时间与上网时间相减得到用户上网时间，这样用户必须先启动 Client Programe 才能与外界进行通信，否则路由器予以转发，用户只能得到 HFC 网内服务。。由于在基于 TCP/IP 的互连网络中，所有应用的数据都是在 IP 数据包上进行的，因此， IP 的数据流量反应了用户对网络的实际使用情况。基于流量的记账对于租用专线或信道，它反应了每个 IP 地址使用公用线路的比例，对于按连接时间计费的线路，也具有一定的参考作用，因为一般连接时间越长，传输的也越多。 
　　流量数据的收集是通过 SNMP 完成的。 
　　2) IP 流量发生的时间分为高峰期，低谷期等不同的。网络设备上的 SNMP 代理监测和控制网络设备，如它收集各种网络管理信息，包括端口流量，从一个源 IP 地址到目的 IP 地址的流量等。。 NMS 和 SNMP 代理之间则通过 SNMP 协议交换管理信息，执行管理功能。管理信息的交换是通过 SNMP 协议数据单元 (PDU) 完成的，在 SNMP 协议中，有 5 种基本的 PDU ，它们是： Getrequest-PDU ， Getnextrequest-PDU ， -PDU ， Setrequest-PDU ， Double-PDU 。数据收集的具体是在网络管理工作站上启动一个数据收集进程，它根据配置文件确定收集数据的行为。因为风险高、前期投入大，国内投资机制不健全，难以解决风险投资出口问题，使国内投资远离这些没有赢利的互联网公司。数据收集进程根据这些配置信息，读取相应路由器的信息并保存。不论从传输速度还是从网络方面 HFC 都是一个比较理想的传输网络，而且我们国家有线电视的普及率也比较高，可以利用现有的基础设施，所以 HFC 对于建设国家信息高速公路是非常有利的。 
　　记账管理在已收集的 IP 数据流量的基础上进行，它要把每个 IP 地址的进出流量按照一定的进行统计。。。 SNMP 是一套标准的网络管理协议，在 SNMP 环境下，网络管理是由网络管理服务站 (NMS) 和一些被管理的网络设备 ( 如主机，中断服务器，路由器等 ) 构成的。

　　外资引入对中国互联网发展起到促进作用

　　从美国互联网产业的发展，我们看到，互联网产业的成功来自与资本市场的完美配合，这种资本是其发展的主要动力和燃料。对于本地接收的数据，当目的地址与本地地址范围一致时，则要用源地址作匹配。 
　　另外，对于单位或子网的计费，要通过对每个 IP 地址汇总完成。。因此有专家提醒说，因内企业不要只盯着纳斯达克，ＯＴＣＢＢ同样是新生企业的上市捷径。在统计时，采用对原始收集数据顺序一次扫描，目的地址范围逐个匹配的方法。从发展趋势看，１９９４年，我国上网用户仅０・１６万，到１９９９年就升到４００万，预计年底达７００万，２００３年将达３０００万。因此还需要一张时间段费率表，含有时间段与费率的对应关系。由于表中的值都可以随时根据需要修改，因此，统计是非常灵活的。 
　　对于个人用户的计费将基于主机系统；对集团用户将采用基于 IP 门牌号的流量统计来计费 ( 数据一般取自 ) 。当存在多个出口时，统计的仍然相同，但需要从多个路由器上收集数据，统计也要根据多个数据流量文件汇总完成。
　　但是，网络收费最终要对用户进行， IP 地址并不一定代表用户信息，那么如何确定用户呢？互联网公司目前大多微利或无利，谈不上企业自身的积累，银行不会提供常规贷款。 
　　2) 对于集团用户上网，由 DHCP 分配 IP 地址，并由计费系统根据单位整体计费，再由各单位向用户收取费用，用户访问不受限制。 
2 结论 
　　当今的网络管理系统产品，比如 SUN 公司的 SUNNet Manager ， 英特尔 公司的 Netview 等都需要较好的一台工作站来支持，网管产品本身又比较昂贵，而且都没有提供现成的网络计费功能。这种方法的关键在于如何把该软件与用户申请 Internet 服务紧密结合，要求用户进行 Internet 服务之前运行该软件进行帐号验证工作。软件设计平台采用具有 Windows 特征的开发软件包，通过调用 Win/SNMP 和 Win/MIB 库函数实现数据采集，符合国际 ASP 组件开发标准，也避免了计费系统在不同平台上的重复开发和移值。