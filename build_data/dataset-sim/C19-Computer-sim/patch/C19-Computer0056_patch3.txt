计算机工程
COMPUTER ENGINEERING
1999年  第25卷 第7期 Vol.25 No.5 1999



视频与音频实时多点传输的研究与实现
区海翔 汤庸 李显济 黄鹤远
摘要 在开发桌面视频会议系统（GdDCS）的过程中，利用Windows Socket规范实现了视频、音频在网络上的实时多点播送。例如下列命令执行一个列出所有作者姓氏为“Ringer”的查询：
　　Command cmd = New ADODB.Command
　　cmd.CommandText = "SELECT * from authors WHERE au―lname = 。它们有的只处理直发,有的把每根头发按个体处理,因而在造型控制和绘制效率上有不足之处。所谓CSCW----即计算机支持的协同工作(Computer Supported Cooperative Work)的目的就是让群体在计算机支持下协同工作，共同完成某一任务，共同讨论某一课题或共同决策等。视频会议系统是CSCW研究的重要范例和内容，视频会议系统要求在与会群体中提供实时的视频、音频多点交互，提供群体协商与决策的平台，因而视频、音频信息在网络上实时多点传输是视频会议系统工程的基础。Yang［15］把头发按簇处理,有效地控制了头发的信息量。合理解决这些问题已成为实现视频、音频多点传输的关键。我们在开发桌面会议系统(GdDCS)的过程中，研究了TCP/IP协议网络上多点播送的机制，并利用Windows Socket 规范，实现了视频、音频的多点传输。
1　TCP/IP协议网络的多点播送模型
　　所谓TCP/IP协议网络，指通信协议采用TCP/IP协议的网络。TCP/IP协议是在Internet上通用的协议，而大部分局域网和部门级的Internet也都采用TCP/IP协议作为通信协议。因此研究TCP/IP协议网络的多点播送机制具有普遍意义和实用价值。在TCP/IP协议网络上实现多点通信可以有两种方式：
　　(1)利用网络的广播功能　所谓'广播'，指源发方只需要发送一份数据拷贝，网络上所有站点都可以接收此数据拷贝。广播是局域网的天然特性，但在Internet上却很难实现。Yang［15］把头发按簇处理,有效地控制了头发的信息量。
　　(2)建立发送方到多个接收方的多条虚电路进行多点播送　这种方案的缺点是数据冗佘大，浪费网络带宽，数据通信效率低等，但这种方案数据传输可靠，保密性好。LeBlanc［8］把每根长发定义成弯曲柱面并用多个拼接起来的直棱柱面近似表示；Magnenat-Thalmann［9］应用LeBlanc［8］的方法绘制出了“梦露”带有光照效果的头发；Watanabe和Suenaga［10,11］把头发构造成由三棱柱连续拼接的弯曲三棱柱面。
　　在GdDCS系统中，考虑到现有协议、路由软件的支持程度和数据传输的可靠性，采用了建立多条虚电路模拟多点播送的方法实现多点通信。
　　下面，我们通过4个例子来实现弯曲体纹理方法。
　　中央服务器作为中央集线器或反射器，多点转发客户数据。客户与客户之间不建立虚电路，客户间通信通过服务器转发。在中央服务器上形成并维护与多个客户通信的虚电路。Annjyo［12］,Rosenblum［13］和Shih［14］应用力学原理描述每根头发的形状。在通信协议上采用TCP/IP协议。与对象相关的事件说明了将要发生或已经发生的数据操作过程。在编程实现上使用Windows Socket规范实现网络通信。Windows Socket规范定义并记录了如何使用API与Internet协议族连接，尤其要指出的是，所有的Windows Socket实现都支持流套接口和数据报套接口，也就是可以建立面向连接的虚电路传输和面向无连接的数据报传输。"
　　每个通配符′。在中央服务器上形成多组Socket套构成列表，每一个Socket套与客户端对应的Socket套构成了5条虚电路。现有的典型方法有：几何造型法、粒子方法和纹理映射。
　　数据传输方案采用数据类型划分的方法。视频会议系统中在网络上交互的数据大体可以分为以下4类。
　　(1)用户信息　包括：①客户在建立连接后向中央服务器发送本地音频视频采集格式等；②服务器将用户列表发送到与会各站
　　(2)控制命令　包括：①客户向服务器请求服务；②服务器对客户的应答及广播会议状态等。虽然绘制时间的开销较大,但这种方法产生了最有说服力的毛绒物体图形。
4　结束语
　　ADO是一种最新的数据存取技术，今后将逐步替代老的DAO（Data Access Objects）特别是RDO（Remote Data Objects）数据访问接口，成为新的远程数据访问方法。
　　采用这种数据类型划分的方法，某一类数据只在一组Socket套中交互，这就可以简化数据格式，简化网络数据传输打包、解包的过程，而且不同类型的数据可以并行传输。"
　　每个通配符′。
　　客户进程在建立上述4个Socket后，通过ClientSocket套发送客户站点的用户信息，而其余3个上的4个Socket构成一对双向通信的套接字连接。中央服务器监听一个Socket连接请求是通过监听一个特定的端口号来实现的，要监听4个Socket连接的请求就必须对4个端口同时进行监听。端口号可以由程序设置，通常要大于1024。对不同的程序设计语言，有类似的过程。′由Command对象的Parameter集合中相应的Parameter对象的值进行替换。各个监听线程并行工作，这是多线程(MultiThread)的概念。
　　在实际会议中，至少有两个站点，也可以有多个站点参加会议，中央服务器的监听线程不是简单地形成4个Socket就结束了，还必须把这些新建的Socket存入4个Socket列表中，以便在将来实现多点播送，这4个服务器端的Socket列表分别是：
　　(1)ClientSocket[MAX-USER-NUM]用户信息Socket套组；
　　(2)VideoSocket[MAX-USER-NUM]视频数据Socket套组；
　　(3)AudioSocket[MAX-USER-NUM]音频数据Socket套组；
　　(4)CommandSocket[MAX-USER-NUM]控制命令及状态信息Socket套组。
　　其中，ClientSocket列表在建立网络通信连接时用于多点播送中央服务器上形成的用户列表，而其余3个Socket列表以后用于接收及转发视频、音频数据和实现会议控制功能。
3　语音实时多点播送
　　语音交互是视频会议系统的重要组成部分，语音交互的质量好坏直接决定视频会议的效果，音频模块要保证语音远地回放的质量，延迟小，实时性等。
　　为了使系统适合在Internet上使用，音频的采集，传输与回放通过音频发送缓冲池、音频接收缓冲池进行，如图示1所示。69875019,69843001,69633030)。
　　事件（Event ）　对象模型通过Events处理过程表示Events。由于客户与客户之间没有建立直接通信的逻辑信道，因此，服务器要具备音频转发的功能。在服务器端，接收缓冲池接收数据后，除了在本地回放，还将音频数据包在服务器与客户的多条逻辑信道(源发方除外)上多点播送，从而实现音频的多点交互。
　　音频发送缓冲池、音频接收缓冲池的包数分别为N、M,N、M的值可变，大体上有3种策略设定N、M的值：
　　(1)N=M=1。适合于局域网上应用，局域网带宽大，传输延迟小，N=M=1可以获最好的实时性，控制也最简单。
　　(2)N、M值设为某一域值，N=M或N≠M。修改数据源的数据时，通过修改Recordset中的Field 对象值，最终传递到数据源中。
　　在以上造型完成以后,对体纹理的数据加以随机扰动,以使发型达到自然的效果。
　　Parameter prm = New ADODB.Parameter
　　prm.Name = "au―lname"
　　prm.Type = adVarChar
　　prm.Direction = adInput
　　prm.Size = 40
　　prm.Value = "Ringer"
　　cmd.Parameters.Append prm
　　也可以用CreateParameter方法设置并添加一个Parameter对象，而后加入Parameters集合。因而，这种方法对要求实时音频的应用(如电视会议系统)的开发特别适用。
4　视频实时多点播送
　　视频模块应当作为会议系统的一个可选的组件，强化多用户之间的协同工作，实现CSCW的"WYSIWIS"的目标。
　　记录集（Recordset）　对象模型中用Recordset存贮查询命令返回的结果，是检查和修改记录的主要手段，在Recordset对象中可以检查记录、在记录中浏览、浏览记录的次序、增加修改或删除记录、更新记录已变化的数据源等。
　　关键词　ADO，数据存取，数据连接，记录集，对象
　　
ADO DATA ACCESS TECHNOLOGY

Zhou Zhiping
Department of Information and Control Engineering, Wuxi Jiangnan Institute, Jiangsu*Wuxi 214063

　　Abstract　This paper introduces the Microsoft′s newest data access technologies based on the ActiveX , discusses their principles, and illustrates how to use the ADO programming model to query and update a data source in VB .
　　Keywords　ADO， Data access, Connection, Recordset,Objects

1　引言
　　ADO（ActiveX Data Objects）是由微软公司推出的以ActiveX技术为基础的数据存取方法。针对人的头发,提出并在数学上表示出了弯曲体纹理。在用户界面表现为同时在多个视频播放窗口上回放多个站点的视频图象。
　　(2)视频数据分为两个部分：帧与帧格式。帧位元数据必须在正确的帧格式下才能正确回放，因此视频缓冲池也分为两部分：帧缓冲池与帧格式池，两者成对采集、传输与回放。
5 小结
　　在开发桌面多点视频会议系统(GdDCS)的过程中，我们设计并实现了一个多点播送模型。它利用客户/服务器模型的特性，在客户与服务器间建立多条虚电路连接，通过服务器的转发(反射)实现多点通信。这种方法具有适于TCP/IP协议网络(Internet及大多数Intranet、局域网)、保密性好、控制严密的优点，但在增加网络负载，利用网络带宽上效果不好。图7是图6的侧像。
*本课题得到广东省自然科学基金、广东省重点攻关项目和广东省重点学科项目的资助
作者简介：区海翔 男，22岁，研究生，主要从事多媒体与CSCW研究
作者单位：广东工业大学计算机系 广州 510090
参考文献
1 钟玉琢.多媒体计算机技术.北京：清华大学出版社，1993
2 Fluckiger F.网络多媒体开发与应用.北京：机械工业出版社，1998
收稿日期：1998-03-01
