计算机应用
Computer Applications
1999年 第19卷 第7期  Vol.19 No.7 1999



地理示意图排版软件的面向对象分析
伍　江　魏子乐
　　摘　要　本文讨论了一个地理示意图排版软件的主要结构和思想。该软件采用面向对象的方法进行分析、设计和实现。本文具体阐述了所采用的面向对象方法，并在一些较难实现的功能上提出了创新的解决方法。
　　关键词　面向对象, OOA, 属性, 服务, 连接, 地理示意图

　　
THE OBJECT-ORIENTED ANALYSIS
OF MAP-PUBLISHING SOFTWARE

Wu Jiang　Wei Zile
National Key Laboratory of Text & Graphics Processing, Institute of Computer Science & Technology, 
Peking University, Beijing 100871

　　Abstract　This paper discusses the main structure and theory of a map-publishing software. This software is analyzed, designed and implemented with object-oriented method. This paper describes detailedly the method used in the software, and gives creative solutions to some difficult problems.
　　Keywords　Object-oriented, OOA, Attribute, Service, Link, Map

1　引言
　　地理示意图的排版在专业排版领域还属于一个比较新的方向。当排版人员需要在报纸或杂志的版面上插入一个示意图以表示某个地方的相对位置以及该地方的街区概貌时，通常使用Illustrator、CorelDraw、FreeHand等通用绘图软件来完成。但这些绘图软件由于其固有的通用性，满足不了地理示意图的一些特定要求，例如：方便地绘制各种类型的道路、铁路、河流；灵活设定不同道路之间的交叉覆盖和焊接；灵活地设定文字的方向和位置，等等，这些都是通用绘图软件所不具备的功能。
　　我们开发的地理示意图软件是专门针对各类对坐标位置要求不是很精确的地理示意图的排版而设计的，在需求上考虑了地理示意图版式和操作两方面的特点，因此既不同于精确度很高的专业地图绘制系统，也不同于通用的绘图软件。在整个开发过程中，我们采用了面向对象的分析方法。　　
2　地理示意图软件的需求描述
　　地理示意图排版软件最基本的功能需求是：在窗口上用鼠标以所见即所得的方式生成一个报刊杂志排版时常用的示意图，并且可以将此示意图输出为eps文件或直接打印输出到打印机上。
　　其中前四个宏是Wizcon中类型为DDE的宏。
　　利用以上报表生成器所提供的功能，系统就可以打印出满足用户要求的数据。［2］
3.2　发现对象，建立对象类
　　如图1所示，示意图主要由一些道路、建筑物和各种标志及文字组成。
　　有关如何将报表生成器生成的数据转移到Excel的表格中，可以利用Excel提供的超级链接的功能。对地理示意图进行的各种操作都首先通过该对象进行。后文的所有对象和示意图对象的关系均是整体―部分关系，它们被示意图对象所包含。
　　道路对象　表示地理示意图中的各种道路。它又可派生出以下几种道路对象：带边界路、黑白相间路、无边界路、河流。带边界路的特点是：在一条具有给定宽度和颜色的线两侧再附加上给定宽度和颜色的边界；黑白相间路是指：沿着线的走向黑线段和白线段相互间隔的路；无边界路只是一条具有给定宽度和颜色的线；河流则是在带边界路的基础上再将两条边之间的部分铺以适当的波纹。
　　Wizcon的报表生成器使用户能利用历史数据进入深入分析并且易于使用。
　　3) 用Wizcon报表生成器制作Wizcon报表，假设报表名为wizrep。标志物对象也需要派生出大量具体的对象：如电话亭，路标，公共汽车站，加油站等。每种对象均可由用户设定其特定的参数。
作者单位：张珏　四川大学计算机基础教育中心　四川.成都（610064）
唐宁九　四川大学计算机学院　四川.成都（610064）
收稿日期:1999-04-28
。
　　扩充图形对象　这是一类没有固定物理意义的对象，它具有较强的形状描述能力，能够描述各种比较复杂的几何形状，包括圆、矩形、曲线或直线多边形、以及由这些形状合并而成的复杂形状。例如，服务器端可以通知客户端执行某条命令。
　　依赖对象　用于实现道路之间的覆盖、焊接、道路和河流之间的桥。
3　Firewall的安全性
　　目前的Firewall还不够好，因为它还敞着大门等别人来攻击。从依赖对象派生出覆盖对象、焊接对象、桥对象，从而具体实现道路和道路之间交叉点处的覆盖、焊接和桥。所以管理级Linux系统上的sockd.conf文件设定如下：
　　deny 192.168.2.17 255.255.255.255
　　核心级机器上则是：
　　deny 192.168.2.23 255.255.255.255
　　管理级还要加上这一行：
　　deny 0.0.0.0.0.0.0.0 eq 80
　　这样可以防止任何机器作用Port 80(HTTP Port)，但其他的服务仍然是开放的，除了浏览Web之外，然后两边的文件中还要加上：
　　Permit 192.168.2.0 255.255.255.0
　　使得192.168.2.xxx的电脑可以使用这个Proxy Server，除了已经被拒绝者之外。有关Wizcon的具体介绍参见［1］。　

表1

对象名称属性服务
示意图对象示意图上所有对象(从2到6的对象)的列表。现研究方向为混合动态系统的建模、控制、优化与仿真，计算机集成控制与管理系统。
示意图大小。对象检索服务：列举出示意图中的所有对象或某一类对象；
添加一个新的对象到示意图中；
删除示意图中的对象；
调整对象在示意图中的顺序；
输出整个示意图到屏幕或eps文件。
道路对象
（四种具体道路对象的属性和服务从略）道路的骨架线。取道路的骨架线；
取道路的轮廓；
输出道路到屏幕或eps文件。
　　5) 编写Wizcon语言
　　定义如下Wizcon语言：
　　if $time=9.00
then
BEGIN
report "wizrep 0 0 0 1439 exc.csv 0 0 "@flag""
if @flag=1
then
macro "report"
END
　　在完成上述步骤后，系统即可在每天早上9：00整定时打印报表且报表的格式完全能够满足用户的需求。
唐宁九副教授。
文字对象文字串。
文字所在的位置。
文字的排版格式（如文字的字体，字号，颜色等）附加的提示线属性。输出文字到屏幕或eps文件。
扩充图形对象扩充图形的位置。
扩充图形的形状参数。输出扩充图形到屏幕或eps文件。
4.4　Proxy Server
　　Proxy Server需要额外的软件，你可以从互联网上下载所需软件。
此对象的轮廓和位置。现主要从事智能控制、系统仿真与计算机应用方面的研究。所以有些软件可以使你的Firewall更有用，这里简单介绍以下软件。
　　不允许任何人用File Server作互联网访问，以防止病毒及其他的恶作剧等。
焊接对象（继承依赖对象的全部属性）（没有特别的属性）输出焊接对象到屏幕或eps文件。
桥对象（继承依赖对象的全部属性）两个具有桥关系的对象的上下顺序。
4.2　TCP Wrapper
　　TCP Wrapper不是一个Firewalling工具，但它提供了许多相同的效果。交换所依赖对象的上下关系；
修改桥的参数；
输出桥对象到屏幕或eps文件。

4　定义结构和连接
4.1　整体――部分结构
　　示意图对象包含了所有其他对象，它和其他对象的关系是整体――部分结构。用面向对象的分析图表示出来就是：　　


4.2　一般――特殊结构
　　道路对象和带边界路、黑白相间路、无边界路、河流的关系是一般――特殊结构。所以管理级Linux系统上的sockd.conf文件设定如下：
　　deny 192.168.2.17 255.255.255.255
　　核心级机器上则是：
　　deny 192.168.2.23 255.255.255.255
　　管理级还要加上这一行：
　　deny 0.0.0.0.0.0.0.0 eq 80
　　这样可以防止任何机器作用Port 80(HTTP Port)，但其他的服务仍然是开放的，除了浏览Web之外，然后两边的文件中还要加上：
　　Permit 192.168.2.0 255.255.255.0
　　使得192.168.2.xxx的电脑可以使用这个Proxy Server，除了已经被拒绝者之外。　


　　另外，依赖对象和覆盖对象、焊接对象、桥对象的关系也是一般――特殊结构。后三者重载依赖对象的“输出依赖对象到屏幕或eps文件”服务。图略。
4.3　实例连接
　　A) 覆盖对象
　　在各个依赖对象和道路对象之间存在着实例连接的关系。这是因为：每一个依赖对象都是为某些道路对象提供服务的。在集成时，可将Wizcon作为DDE的服务器端、Excel作为DDE的客户端。该覆盖对象依赖且只依赖于这两条道路。而这两条道路则通过这个覆盖对象来实现它们在交叉点处时谁在上面谁在下面。
　　具体的实现机理是：首先根据两条道路的骨架线计算出它们的交叉点，然后再根据它们各自的宽度算出它们在该交叉点处的重叠区。socks是用一个程序来完成所有的Internet动作，TIS则用不同的功能发展不同的程序。两个网络各接上一台Linux系统作为服务器。这样，就实现了道路A在该交叉点处盖住了道路B。反之，若想实现道路B在该交叉点处盖住道路A，只须让覆盖对象调用道路B的画函数进行重画。但保护网络无法连上Internet，Internet也连不上保护网络。
　　不允许任何人用File Server作互联网访问，以防止病毒及其他的恶作剧等。从而能保证这两条道路和其他对象之间的上下关系不变。
　　6) 剩下四个Domain Names设为paul,ringo,john和george,用来掩人耳目。例如：A的头盖住B的尾，B的头又盖住A的尾。这在高要求的地理示意图中是很可能出现的，而一般的绘图软件要做到这点会很困难。这种方法的另一个好处是便于用户操作：由于覆盖对象具有明确的轮廓（重叠区），因此可以允许用户简单地用鼠标单击重叠区而实现切换该交叉点处的上下覆盖关系。
5.1　网络设计
　　IP地址安排如下：
　　1) 192.168.2.255，用作广播之用。
　　关键词　Wizcon组态软件，Microsoft Excel，报表生成器，系统集成
1　Wizcon的报表生成器
　　Wizcon是基于32位结构、事件驱动、多任务、多线程技术基础上开发的组态软件，因此，Wizcon可在Windows 95和Windows NT环境下运行。
　　B) 桥对象
　　桥对象和覆盖对象非常类似。但二者都提供了对外的绝对保护。另外，桥对象的轮廓计算和覆盖对象的轮廓计算方法不一样，需要考虑桥本身的属性。
作者单位：太原重型机械学院系统仿真与计算机应用研究所　山西.太原（030024）
参考文献
［1］　王宏刚，徐玉斌，曾建潮. Wizcon工业监控软件及应用. 1998年全国（第四届）工业控制系统应用学术会议论文集. 北京：工业出版社，1998
收稿日期:1999-05-16(修改稿)
。（对于另外三类道路，无需考虑焊接）。
　　1) 在Wizcon的“设计”菜单中单击“应用设定”，添加运行“wizddes.exe”和“Excel.exe”两个应用程序。焊接对象的实现机理是：当几条带边界路在某个位置交叉在一起时，由用户通过鼠标将它们在交叉点处的重叠区标识出来（用不规则多边形描述）。该区域作为要生成的焊接对象的轮廓。当将这几条道路都画完后，再通知焊接对象画出自身。焊接对象的画函数则轮流调用每一个被它依赖的带边界路的画路心的函数，并设置焊接对象的轮廓为裁剪区。由于每条带边界路将自己的路心在焊接对象指定的轮廓内重画，因而确保它们的路心都可见，也就是说，在该区域内所有横越路心的边界都会被覆盖掉，从而实现将几条道路的路心焊接在一起的效果。这样可使用户感觉不到Excel的存在。DDE的服务器端在接受到DDE客户端的数据请求以后，按照DDE的地址将数据发送给客户端。这对于现代城市的地理示意图来说，可能是一个非常重要的功能。
　　2) 32个IP地址挪出23个，供互联网访问机器使用。另外，和覆盖对象一样，焊接对象也要在它所依赖的各道路对象画完之后才能画。
　　D) 示意图
　　以上三种联系用图表示出来如下：　　


4.4　消息连接
　　在依赖对象和道路对象之间还存在着双向的消息连接。这主要体现在两方面。例如，服务器端可以通知客户端执行某条命令。
5　结束语
　　在我们开发的地理示意图排版软件中运用OOA方法使我们的程序更易理解，也更易扩展和修改。如果有人想借着使用一般的手法，如邮件炸弹（MAIL BOMB）或“Internet Worm”来攻击受保护的网络，他们可能是无法如愿的。
　　3) 用Wizcon报表生成器制作Wizcon报表，假设报表名为wizrep。主要研究方向：文字和图形的计算机处理。
　　魏子乐　硕士研究生。主要研究方向：文字和图形的计算机处理。
　　作者单位：伍　江　魏子乐（北京大学计算机研究所文字图形处理国家重点实验室　北京100871）
参考文献
［1］汪成为，郑小军，彭木昌. 面向对象的分析、设计及应用. 北京：国防工业出版社，1992
［2］邵维忠，杨芙清. 面向对象的系统分析. 北京：清华大学出版社，广西：广西科学技术出版社，1998 
收稿日期:1999-03-22
