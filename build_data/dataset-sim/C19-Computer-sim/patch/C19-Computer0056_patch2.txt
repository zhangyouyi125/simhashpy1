计算机工程
COMPUTER ENGINEERING
1999年  第25卷 第7期 Vol.25 No.5 1999



视频与音频实时多点传输的研究与实现
区海翔 汤庸 李显济 黄鹤远
摘要 在开发桌面视频会议系统（GdDCS）的过程中，利用Windows Socket规范实现了视频、音频在网络上的实时多点播送。首先描述了GdDCS系统多点播送的模型，然后讨论视频、音频实时多点传输的实现。
关键词 多媒休 视频会议系统 计算机支持的协同工作 实时 广播
The Research and Implementation of Audio and Vide Real-time Multicast
Ou Haixiang Tang Yong Li Xianji Wang Heyuan
Department of Computer Science and Engineering，Guangdong University of Technology Guangzhou 510090
Abstract：We implemented an audio and video real-time multicast on network using Windows Socket programming during the developing of Desktop Video Conferencing System for Multi-participants（GdDCS）.This article describes the multicast model of GdDCS and video real-time multicast.
Key words：Multimedia;Video conferencing system;Computer supported cooperative work;Real-time;Multicast
　　把多媒体引入网络，极大地拓展了多媒体技术的应用范围，例如在计算机支持的环境下进行协同工作更为直观和高效。所谓CSCW----即计算机支持的协同工作(Computer Supported Cooperative Work)的目的就是让群体在计算机支持下协同工作，共同完成某一任务，共同讨论某一课题或共同决策等。1982年Hopfield向美国科学院提交了关于神经网络的报告，其主要内容是，建议收集和重视以前对神经网络所做的许多研究工作，他指出了各种模型的实用性。视频、音频是多媒体的重要内容，但在远程通信(特别是在Internet上)实现视频、音频实时多点交互却还存在诸多问题，例如数据的压缩与解压缩[1]，TCP/IP协议网络的广播或多点播送机制[2]，视频、音频媒体内同步与媒体间同步，视频、音频服务质量(QoS)等。
u(t)＝-R-1BTPx(t)
其中对于所有s0∈Ω0，R满足下列不等式：
R-1+LR-1+R-1LT≥EET+2
这里的＝max｛‖H(r1)‖ r1(t)∈1｝；P为下 列Lyapunov方程的正定矩阵解：
PA+ATP+Q＝0
其中对于所有r0∈0，Q满足下列关系式：
Q＞2qI+GTG
其中q为某一大于1的正常数.
　　定理 2.6　若A为Hurwitz，并且对于所有s0∈Ω0皆 有2I+L+LT＞0，则系统(11)可由下列状态反馈控制器鲁棒镇定：
u(t)＝-γBTPx(t)
其中P为下列Lyapunov方程的正定矩阵解：
PA+ATP+Q＝0
这里的Q满足下列不等式：Q＞2qI+GTG，r0(t)∈R0，q为某一大于1的正常数 ；，其中.
　　定理2.5和定理2.6的证明类似于定理2.4，故从略。我们在开发桌面会议系统(GdDCS)的过程中，研究了TCP/IP协议网络上多点播送的机制，并利用Windows Socket 规范，实现了视频、音频的多点传输。
1　TCP/IP协议网络的多点播送模型
　　所谓TCP/IP协议网络，指通信协议采用TCP/IP协议的网络。TCP/IP协议是在Internet上通用的协议，而大部分局域网和部门级的Internet也都采用TCP/IP协议作为通信协议。因此研究TCP/IP协议网络的多点播送机制具有普遍意义和实用价值。在TCP/IP协议网络上实现多点通信可以有两种方式：
　　(1)利用网络的广播功能　所谓'广播'，指源发方只需要发送一份数据拷贝，网络上所有站点都可以接收此数据拷贝。广播是局域网的天然特性，但在Internet上却很难实现。
　　50年代初，神经网络理论具备了初步模拟实验的条件。
　　(2)建立发送方到多个接收方的多条虚电路进行多点播送　这种方案的缺点是数据冗佘大，浪费网络带宽，数据通信效率低等，但这种方案数据传输可靠，保密性好。目前大多数多点播送使用这种方法进行模拟。
　　在GdDCS系统中，考虑到现有协议、路由软件的支持程度和数据传输的可靠性，采用了建立多条虚电路模拟多点播送的方法实现多点通信。但由于GdDCS的体系结构是服务器模型，因此作了以下改，使通信更为简单，控制更为严密。
　　中央服务器作为中央集线器或反射器，多点转发客户数据。客户与客户之间不建立虚电路，客户间通信通过服务器转发。在中央服务器上形成并维护与多个客户通信的虚电路。当模型的学习环境有噪音时，内部结构有相应的随机联系，这种感知器的学习规则是突触强化律，它可能应用在模式识别和联想记忆等方面。在通信协议上采用TCP/IP协议。由于CP/IP协议是适合于在当前Internet上使用的协议，因此就为系统能够在Internet上使用奠定了良好的基础。在编程实现上使用Windows Socket规范实现网络通信。Windows Socket规范定义并记录了如何使用API与Internet协议族连接，尤其要指出的是，所有的Windows Socket实现都支持流套接口和数据报套接口，也就是可以建立面向连接的虚电路传输和面向无连接的数据报传输。考虑到现有协议对广播的支持程度及在Internet上进行可靠的数据传输，我们采用了面向连接的虚电路传输方案。在中央服务器上形成多组Socket套构成列表，每一个Socket套与客户端对应的Socket套构成了5条虚电路。在实现上采用客户请求、服务器应答的两次握手协议建立一对双向传输的Socket套。本文的证明过程中利用了改进的Razumikhin定理以及二次调节理论中的方法。视频会议系统中在网络上交互的数据大体可以分为以下4类。
　　(1)用户信息　包括：①客户在建立连接后向中央服务器发送本地音频视频采集格式等；②服务器将用户列表发送到与会各站
　　(2)控制命令　包括：①客户向服务器请求服务；②服务器对客户的应答及广播会议状态等。
　　(3)音频数据库　与会各站点采集的音频数据。
　　(4)视频数据库　与会各站点采集的视频帧。
　　采用这种数据类型划分的方法，某一类数据只在一组Socket套中交互，这就可以简化数据格式，简化网络数据传输打包、解包的过程，而且不同类型的数据可以并行传输。他已对这类系统的结构和功能有比较清楚的认识。
　　客户进程在建立上述4个Socket后，通过ClientSocket套发送客户站点的用户信息，而其余3个上的4个Socket构成一对双向通信的套接字连接。中央服务器监听一个Socket连接请求是通过监听一个特定的端口号来实现的，要监听4个Socket连接的请求就必须对4个端口同时进行监听。端口号可以由程序设置，通常要大于1024。
　　中央服务器进程初启后立刻建立4个监听线程，分别监听来自不同端口号的Socket连接请求。一旦后台监听线程在特定的端口号检测到连接请求，它就接收请求(Accept)，建立Socket套连接。各个监听线程并行工作，这是多线程(MultiThread)的概念。
　　在实际会议中，至少有两个站点，也可以有多个站点参加会议，中央服务器的监听线程不是简单地形成4个Socket就结束了，还必须把这些新建的Socket存入4个Socket列表中，以便在将来实现多点播送，这4个服务器端的Socket列表分别是：
　　(1)ClientSocket[MAX-USER-NUM]用户信息Socket套组；
　　(2)VideoSocket[MAX-USER-NUM]视频数据Socket套组；
　　(3)AudioSocket[MAX-USER-NUM]音频数据Socket套组；
　　(4)CommandSocket[MAX-USER-NUM]控制命令及状态信息Socket套组。
　　其中，ClientSocket列表在建立网络通信连接时用于多点播送中央服务器上形成的用户列表，而其余3个Socket列表以后用于接收及转发视频、音频数据和实现会议控制功能。
3　语音实时多点播送
　　语音交互是视频会议系统的重要组成部分，语音交互的质量好坏直接决定视频会议的效果，音频模块要保证语音远地回放的质量，延迟小，实时性等。
　　在以下的讨论中，我们总是假设：ΔA(r0(t))＝BG(r0(t)),ΔAd(r1(t))＝BH(r1 (t)),ΔB(s0(t))＝BL(s0(t)),ΔBd(s1(t))＝BF(s1(t)),Ad＝BE，Bd＝BD. 
　　定理 2.2　若(A，B)可镇定，并且存在正常数ε使得
　　　　　　　　　(5)
其中＝max｛‖F(s1(t))‖2，s1(t)∈Ω1｝.则系统(1)可由下列形式 的状态反馈控制器鲁棒镇定.
u(t)＝-Kx(t)＝-R-1BTPx(t)　　　　　　　　　　　　(6)
其中矩阵P＞0为下列代数Riccati方程的解.
PA+ATP-PBR-1BTP+Q＝0　　　　　　　　　　　　　　(7)
其中分别选取R＞0和Q＞0使得对于所有si(t)∈Ωi,(i＝0,1)下列不等式成立.
　　　　　　(8)
其中
　　　　　　　(9)
　　证明　选取下列形式的Lyapunov泛函：

则有

反复利用引理引2.1可得


于是

由(7)可得
PA+ATP-PBR-1BTP+I+GTG＜0，　r0∈0
而根据(7)我们有
，ri(t)∈i, si(t)∈Ωi,i＝0，1.故当x(t)≠0时，皆有＜0.从而本定理得证。许多国家相应成立了神经网络学会，定期召开国际性、区域性 会议，如：1990年欧洲召开首届国际会议Parallel Problem Solving from Nature (PPSN), 1994年IEEE神经网络学会主持召开了第一届进化计算国际会议。本文讨论在实际应用中更为一般 的含有时变时滞状态以及时变时滞控制输入的不确定时滞线性系统，因此，文献〔5〕中所 讨论的系统以及主要结果可以看着本文的一个特例。由于客户与客户之间没有建立直接通信的逻辑信道，因此，服务器要具备音频转发的功能。在服务器端，接收缓冲池接收数据后，除了在本地回放，还将音频数据包在服务器与客户的多条逻辑信道(源发方除外)上多点播送，从而实现音频的多点交互。
　　定理 2.4　闭环系统(2)和(11)的零解渐近稳定的充分条件为存在 常数q＞1，K∈Rm×n以及正定矩阵P∈Rn×n使得
L(r0(t),r1(t)，s0(t))＜0， ri(t)∈i, s0(t)∈ Ω0
其中
L(r0(t),r1(t),s0(t))＝PA+ATP+PΔA+ΔATP-PBK-KTBTP
-PΔBK-KTΔBTP+PAdATdP+2qI
　　证明　考虑下列Lyapunov函数：
V＝xT(t)Px(t)
则V引闭环系统(2)和(11)的导数为
＝T(t)Px(t)+T(t)P(t)＝xT(t)［PA+ATP+PΔA+ΔATP-PBK-KTBTP
-PΔBK-KTΔBTP］x(t)+2xT(t)PAdx(t-d)+2xT(t)PΔAdx(t- d)
利用引理2.1可得
2xT(t)PAdx(t-d)xT(t)PAdATdPx(t)+xT(t-d)x(t-d )
2xT（t)PΔAdx(t-d)xT(t)PΔAdΔATdPx(t)+xT(t-d)x(t-d)
若‖x(t+θ)‖＜ q‖x(t)‖，θ∈［-r,0］,t≥t0,则当x(t)≠0时有
xT(t)L(r0(t),r1(t),s0(t))x(t)＜0
利用改进的Razumikhin定理(参见文献［8］即可完成本定理的证明。适合于局域网上应用，局域网带宽大，传输延迟小，N=M=1可以获最好的实时性，控制也最简单。
　　(2)N、M值设为某一域值，N=M或N≠M。在Internet上传输必须考虑媒体内同步与媒体间同步，缓冲池的包数可以在达到域值时才发送或播放，同时对音频数据包加上时间戳或同步标记。
　　(3)N、M值动态变化，这是最复杂的缓冲池控制策略，不过在Internet上也可以获得较为理想的实时性与同步性的折中。
　　我们基于低级音频服务编写实时声音的采集、回放以及实现声音在网络上实时的多点传播，这种方法的突出优点是实时性，其次，该方法并不是对音频文件操作，而是利用"流"的机制，能直接对实时音频流信息进行控制编辑。因而，这种方法对要求实时音频的应用(如电视会议系统)的开发特别适用。
4　视频实时多点播送
　　视频模块应当作为会议系统的一个可选的组件，强化多用户之间的协同工作，实现CSCW的"WYSIWIS"的目标。所谓"可选"，指用户可以根据协同的需要、设备状况或网络通信的现状选择是否进行视频交互或调整视频交互的质量。
　　与音频采集、传输和回放类似，视频采集、传输与回放也是通过视频发送缓冲池与一组视频接收缓冲池进行的，如图2所示。

图2 视频多点播送
　　由于视频模块与音频模块在工作机理上的差异，视频模块主要在以下两个方面有所不同：
　　(1)音频流在时间上是互斥关系，即每一时刻都只有一个站点的音频流得以传输，因此一个站点只有一个音频发送缓冲池与一个音频接收缓冲池；视频流在时间上是并发关系，即某个时刻可以有多个站点的视频流在传输，因此一个站点上有一个视频发送缓冲池和多个视频接收缓冲池，多个视频接收缓冲池并行工作。
　　为了镇定不确定系统(1)，我们利用下列形式的线性状态反馈控制律：
u(t)＝-Kx(t)　　　　　　　　　　　　　　(2)
其中常数增益矩阵K∈Rm×n.为了简便起见，ΔA(r0(t)),ΔAd(r1(t)),ΔB(s 0(t)),ΔBd(s1(t)),d(t)以及h(t)有时分别记为ΔA, ΔAd, ΔB, ΔBd, d和h， 
　　于是(1)和(2)所构成的闭环系统为
　　　　　　　　　(3)
其中.
　　首先我们引入下列引理：
　　引理2.1　(参见［3］)
YTX+XTYXTX+YTY
其中X，Y为适当维数的短阵。
　　(2)视频数据分为两个部分：帧与帧格式。帧位元数据必须在正确的帧格式下才能正确回放，因此视频缓冲池也分为两部分：帧缓冲池与帧格式池，两者成对采集、传输与回放。他的这些成果，对当时影响很大 ，有些学者与Grossberg合作，他组建的自适应系统中心取得了丰硕的成果，几乎涉及到 神经网络的各个领域。它利用客户/服务器模型的特性，在客户与服务器间建立多条虚电路连接，通过服务器的转发(反射)实现多点通信。这种方法具有适于TCP/IP协议网络(Internet及大多数Intranet、局域网)、保密性好、控制严密的优点，但在增加网络负载，利用网络带宽上效果不好。下一步拟用UDP协议实现通信，以提高传输效率。
*本课题得到广东省自然科学基金、广东省重点攻关项目和广东省重点学科项目的资助
作者简介：区海翔 男，22岁，研究生，主要从事多媒体与CSCW研究
作者单位：广东工业大学计算机系 广州 510090
参考文献
1 钟玉琢.多媒体计算机技术.北京：清华大学出版社，1993
2 Fluckiger F.网络多媒体开发与应用.北京：机械工业出版社，1998
收稿日期：1998-03-01
