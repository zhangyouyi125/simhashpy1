计算机应用
Computer Applications
1999年 第19卷 第7期  Vol.19 No.7 1999



电子商务中在线支付的安全保障
刘卫宁　宋　伟

　　摘　要　本文详细分析和比较了保障在线支付安全的主流协议： SSL协议和SET协议。
　　关键词　在线支付，安全， SSL，SET
　　
SECURE FACILITIES FOR ONLINE PAYMENT
IN ELECTRONIC COMMERCE

Liu Weining　Song Wei 
Computer Science & Engineering College, Chongqing University, Chonqging 400044
　　Abstract　This paper analyzes and compares the popular protocols which ensure the security of online payment system: SSL and SET.
　　Keywords　Online payment, Security, SSL, SET

　　实现电子商务的关键是要保证商务活动过程中系统的安全性，即应保证在向基于Internet的电子交易转变的过程中与传统交易的方式一样安全可靠。
　　虽然Internet以开放性著称，在安全方面具有脆弱性。但是，随着Internet的发展和电子商务时代的到来，人们在Internet安全上所进行的努力已改变了这种情况。今天电子商务中采用的安全技术已成为一种成熟的、实用的安全技术。
　　电子商务的主要特征是在线支付。为了保证在线支付的安全，需要采用数据加密和身份认证技术，以便营造一种可信赖的电子交易环境。在线交易首先要验证或识别参与交易活动的各个主体，如持卡消费者、商家、受卡银行和支付网关的身份（身份用数字证书表示），以及保证持卡人的信用卡号不会被盗用，这样客户才可以放心地在网上购物。
　　目前有两种安全在线支付协议被广泛采用，即安全套接层SSL（Secure Sockets Layer）协议和安全电子交易SET（Secure Electronic Transaction）协议。关键在于图形试题的存储格式是否合理，题库的查询、维护是否方便，自动组卷能否满足规定条件，排版打印是否符合要求等，对这些问题我们在题库的开发过程中进行了较为深入的研究和探讨。众所周知，Socket只是一个编程界面，并不提供任何安全措施。SSL则不仅提供编程界面，而且还向上层应用提供安全服务。
　　矢量图形的存储空间远远小于点阵图形，而且可以在绘图软件(如Auto CAD)中进行编辑修改，因而采用这种图形格式的题库可以设计成开放型和可扩充型，随时修改试题和增加试题。在用数字证书对双方的身份验证后，双方就可以用保密密钥进行安全的会话了。Microsoft SQL Server的强大功能还表现在其保证数据的完整性，有了服务器维护数据的完整性，就没有再必要依赖各个部门的程序员，他们能力各异，编写的应用程序也很难统一，然可以在应用程序内部努力保证完整性，但是没有必要完全寄希望于此，因为有了Microsoft SQL Server，就可以在整个LAN内部保证数据库信息的完整性和一致性。
　　SSL协议在应用层收发数据前，协商加密算法、连接密钥并认证通信双方，从而为应用层提供了安全的传输通道；在该通道上可透明加载任何高层应用协议（如HTTP、FTP、TELNET等）以保证应用层数据传输的安全性。SSL协议实现简单，并且独立于应用层协议，因此，在电子交易中被用来安全传送信用卡号码。
　　SSL协议握手流程由两个阶段组成：服务器认证和用户认证（可选）。
　　服务器认证阶段
　　* 客户端向服务器发送一个“Hello”信息，以便开始一个新的会话连接；
　　* 服务器根据客户的信息确定是否需要生成新的主密钥，如需要则服务器在响应客户的“Hello”信息时将包含生成主密钥所需的信息；
　　* 客户根据收到的服务器响应信息，产生一个主密钥，并用服务器的公开密钥加密后传给服务器；
　　* 服务器恢复该主密钥，并返回给客户一个用主密钥认证的信息，以此让客户认证服务器。
　　这样通过主密钥引出的密钥对一系列数据进行加密来认证服务器，从而建立安全的通信通道。
　　用户认证阶段（可选）
　　在此之前，服务器已经过了客户认证，这一阶段主要完成对客户的认证。
　　经认证的服务器发送一个提问给客户，客户则返回（数字）签名后的提问和其公开密钥，从而向服务器提供认证。
　　SSL支持各种加密算法。在“握手”过程中，使用RSA公开密钥系统。题库的维护和使用都很方便 。公开密钥认证遵循X.509标准。
　　SSL协议实现简单，独立于应用层协议，且被大部分的浏览器和Web服务器所内置，便于在电子交易中应用，国际著名的CyberCash信用卡支付系统就支持这种简单加密模式，IBM等公司也提供这种简单加密模式的支付系统。
　　.其他还有多种形式，但大多数是以上几种形式的变体。　　
2　SET协议
　　SET协议是针对开放网络上安全、有效的银行卡交易，由Visa和Mastercard联合研制的，为Internet上卡支付交易提供高层的安全和反欺诈保证。现在SET已作为开放的工业标准发布，软件厂家可用来研制自己的应用软件。
2.1　SET协议为电子交易提供的安全措施
　　SET协议保证了电子交易的机密性、数据完整性、身份的合法性和防抵赖性。
　　题库选择目前最流行的可视化编程语言Visual Basic 6.o进行编程，使用OLE控件，可以同步将与Access数据库连接Auto CAD图形试题在VB程序中显示。
　　以上是服务器镜象备份，也称为双机热备份，另外还有硬盘镜象备份，(最好有二个相同的硬盘)，因出于成本或其他原因考虑，尤其是双机热备份(单独专门使用一个与服务器配置一样的计算机作为备份服务器)采用者较少，因此我们提出了异机备份的策略，这也是最好最经济的备份方式，特别是当服务器崩溃或Microsoft SQL Sever系统崩溃时，因为此时除了双热备份可以启用备份服务器直接使用外，通过其他的各种备份策略(不包括异机备份策略)必须重装服务器操作系统(Microsoft Windows NT)或重装Microsoft SQL Sever，采用异机备份策略，则不必担心，这时候只需待装好Microsoft SQL Sever时，从异机传送数据恢复即可，具体做法是：
　　在局域网内的任何一台工作站计算机上安装Microsoft Windows NT及Microsoft SQL Server，并在该机上建立一个与服务器中的数据库同名的数据库，利用Microsoft SQL Server系统本身提供的异机传送工具(在Microsof SQL Enterprise Manager中的Tools菜单下的Database/Object Transfer)通过设置定时(可以是每周、每月、每日或每时)由计算机自动的把服务器中数据库的数据传送到该工作站机的数据库中，这样一旦服务器(操作系统)崩溃或Microsoft SQL Server系统崩溃时，只要重装服务器操作系统(Microsoft Windows NT)或重装Microsoft SQL Server仍然可以采用异机传送工具来通过该工作站机把数据传回至服务器的Microsoft SQL Server数据库中，以确保数据的安全恢复，上海宏士达公司就是使用这一方法才在恶劣环境下也保证数据不丢失。
　　SET协议也可通过双重签名的方法将信用卡信息直接从客户方透过商家发送到商家的开户行，而不容许商家访问客户的帐号信息，这样客户在消费时可以确信其信用卡号没有在传输过程中被窥探，而接收SET交易的商家因为没有访问信用卡信息，故免去了在其数据库中保存信用卡号的责任。
　　* 数据完整性（Data Integrity）
　　通过SET协议发送的所有报文加密后，将为之产生一个唯一的报文摘要值（message digest），一旦有人企图篡改报文中包含的数据，该数值就会改变，从而被检测到，这就保证了信息的完整性。
　　* 身份验证（Verification of Identity）
　　SET协议可使用数字证书来确认交易涉及的各方（包括商家、持卡客户、受卡行和支付网关）的身份，为在线交易提供一个完整的可信赖的环境。
　　* 防抵赖性（Non-repudiation of Disputed Charges）
　　SET交易中数字证书的发布过程也包含了商家和客户在交易中存在的信息。
　　此外，定期的把某些数据，某些表或全部数据备份到光盘，软盘中，放于保险的安全处，也不失为一种好方法。
2.2　电子交易的主体对象
　　电子交易涉及的主要主体对象有：
　　客户或持卡人（Cardholder）： 电子交易中的持卡消费者；
　　发卡机构（Issuer）： 信用卡的发卡金融机构，它将为客户建立帐号，发出信用卡，它必须保证该信用卡组织的有关规定（包括安全、支付授权等）；
　　商家（Merchant）： 服务提供者；
　　受卡行（Acquirer）： 商家的开户银行，处理信用卡的授权和支付；
　　支付网关（Payment gateway）： 是一个由受卡行（或指定的第三方机构）操作的设备，是金融网与Internet的接口，用来处理商家的支付信息（包括客户的支付命令等）。
2.3　基于SET的电子交易流程
　　基于SET的标准电子交易流程如图1所示。


图1　SET交易流程图

2.3.1　浏览
　　客户通过浏览器从商家的商品目录寻找所需商品。
2.3.2　发送购买请求
　　a） 客户（cardholder）初始化请求
　　客户发送初始化请求给商家（在发送SET报文之前，客户需拥有支付网关交换密钥的私人密钥）。
　　b） 商家发送证书
　　商家收到客户的初始化请求后，为请求报文分配一个唯一的交易标识号，并用商家的私人密钥进行数字签名，然后将初始化响应报文与商家和支付网关的证书一起传给客户。
　　c) 客户接收初始化响应并发送请求
　　客户收到初始化响应后，遍历信任链，验证商家和支付网关的证书，确认商家和支付网关的身份，再根据商家的公开密钥确认初始化响应上商家的签名；
　　客户产生订单信息（Ordering Information）和支付命令（Payment Instruction）；
　　客户用私人密钥对订单信息和支付命令进行双重签名；
　　客户产生一个随机的对称密钥，并用它对双重签名后的支付命令加密，然后再用支付网关交换密钥的公开密钥（public key-exchange key）对客户帐号和对称密钥加密；
　　客户将加密后的订单信息和支付命令发给商家。
　　d） 商家处理请求报文
　　商家遍历信任链以确认客户证书；
　　商家用客户的公开密钥对订单信息上的双重签名解密，以确保订单在传输过程中未被篡改，其上的签名是客户的；
　　商家处理订单信息请求，同时将支付命令传给支付网关并请求授权；
　　商家产生一个购买响应报文（其中包括商家的签名证书，指明客户的订单已被接收），并对该报文数字签名后发给客户；
　　如果交易被授权，商家将执行订单上规定的送货等服务。
　　e） 客户接收购买响应
　　客户遍历信任链确认商家的签名证书；
　　客户用商家的公开密钥来证实购买响应上的签名是商家的；
　　客户保存收到的购买响应。
2.3.3　支付认证
　　a） 商家请求授权
　　商家产生授权请求，并对它进行数字签名；
　　商家用随机产生的对称密钥对授权请求加密，然后再用支付网关交换密钥的私人密钥对该对称密钥加密；
　　商家将加密的授权请求和来自客户的加密支付命令一起送支付网关。但由于一般数据库管理系统不支持矢量图形，使矢量图形的管理比较困难。
　　c) 商家处理授权响应
　　商家遍历信任链确认支付网关的证书；
　　商家用商家交换密钥的私人密钥对对称密钥解密，然后再用对称密钥对授权响应解密；
　　商家用支付网关的公开密钥确认授权响应上支付网关的签名；
　　商家保存加密后的付款标志和授权响应，以便付款处理用；
　　商家完成购买请求后，执行订单。
2.3.4　付款
　　a） 商家请求付款
　　商家产生付款请求；
　　商家将其证书嵌入付款请求中，并用商家的私人密钥对付款请求签名；
　　商家用对称密钥对请求加密，并用支付网关交换密钥的公开密钥对该密钥加密；
　　商家将加密后的付款请求和以前保存的来自授权响应的加密付款标志送给支付网关。
　　b） 支付网关处理付款请求
　　网关遍历信任链确认商家证书；
　　网关用网关交换密钥的私人密钥对对称密钥解密，然后用该对称密钥对付款请求解密；
　　网关用商家的公开密钥确认付款请求上商家的签名；
　　网关用网关交换密钥的私人密钥对对称密钥解密，然后再用对称密钥对付款标志解密；
　　网关确认商家的付款请求与付款标志一致；
　　网关通过金融网络向客户金融机构发付款请求；
　　网关产生付款响应报文（包括网关签名证书），并用网关的私人密钥加密；
　　网关用随机产生的对称密钥对付款响应加密，再用商家交换密钥的公开密钥对该对称密钥加密；
　　网关将加密后的付款响应送商家。
　　c） 商家接收付款响应
　　商家遍历信任链确认支付网关证书；
　　商家用商家交换密钥的私人密钥对对称密钥解密，然后再用该对称密钥对付款响应解密；
　　商家用支付网关的公开密钥确认付款响应上支付网关的签名；
　　商家保存付款响应，以便今后与来自受卡机构支付对帐。
2.4　小结
　　通过上面的分析可以看到，SET定义了一个完备的电子交易流程，它较好地解决了电子交易中各方间复杂的信任关系和安全连接，确保了电子交易中信息的真实性、保密性、防抵赖性和不可更改性。与此同时，SET协议庞大而又复杂，银行、商家和客户均需要改造系统才能实现互操作，因此，SET协议被普遍使用尚有一个过程。但是，与SSL相比，SET协议具有许多优点：
　　* SET对商家提供了保护自己的手段，使商家免受欺诈的困扰，并使商家的运营成本降低；
　　* 对消费者而言，SET保证了商家的合法性，并且用户的信用卡号不会被窃取，SET替消费者保守了更多的秘密使其在线购物更加轻松；
　　* 银行和发卡机构以及各种信用卡组织非常喜爱SET协议，因为SET帮助它们将业务扩展到Internet这个广阔的空间中，从而使得信用卡网上支付具有更低的欺诈概率，这使得它比其它支付方式具有更大的竞争力；
　　* SET对于参与交易的各方定义了互操作接口，一个系统可以由不同厂商的产品构筑。
　　.备份存储的空间是否防窃、防磁干扰、防火。　　
3　结束语
　　本文详细分析了目前电子交易中的主流协议SSL协议和SET协议。
　　.自然灾害，地震、水灾，火灾或其他原因造成的严重故障。只是两协议所处的网络层次不同，出发点不同，为电子交易提供的安全级别和手段也不同，在实际应用中可根据需求单独使用一个协议或组合使用两个协议。
　　刘卫宁　博士，副教授。主要研究方向：计算机网络及通信、智能交通系统。
　　宋　伟　硕士，讲师。主要研究方向：电子商务、数据库技术、智能交通系统。人工组卷时，只要匹配这些查询条件，就可以迅速选到所需的相应试题