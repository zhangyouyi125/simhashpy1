计算机工程
COMPUTER ENGINEERING
1999年  第25卷 第7期 Vol.25 No.5 1999



关于建立WWW电子地图库的探讨
李乔 罗敏
摘要 随着Internet技术的发展和社会对地理空间信息需求的增加，建立WWW电子地图库已经成为必然。讲座了有关建立WWW电子地图库存的技术支持和工作模式，并详细介绍了WWW电子地图库存的3种基本类型。
　　本文介绍了一种与路由器无关的基于代理服务的计费思想，并已在一些单位正式运行，取得了很好效果。在这本不丰富的中文信息中，绝大多数又是文字信息，而与国民经济和日常生活密切相关的地理空间信息在网上就更难寻觅了。
　　电子地图以地图学为基本原理，借助现代化技术和设备产生，是地理信息系统中必不可少的基础数据。
3　计费系统的实现
3.1　实现的环境
　　图4是一个典型的代理计费网络结构,在该图中,装有计费软件代理服务器这台计算机配置二个100M的网卡，一块要与Router连接，网卡置为正规的IP地址，另一块配企业自己定义的内部IP地址跟企业网的主干线连接。与传统地图相比，电子地图信息量大，可通过数据库进行管理，具备丰富的查询检索功能；灵活性强，数据更新方便；并可利用GIS进行统计分析。随着计算机网络技术的发展，电子地图可以方便地进行传输，用户利用万维网浏览和查询电子地图及其它地理信息，也是利用Internet进行电子出版的新趋势。目前电子地图作为一种信息商品，日益受到各界青睐。常见的电子地图产品有：卫星影象图--地球资源卫星获得的地表景观影象数据；电子地形图--通过分层技术将多种地理要素分成独立的信息层，每层具有同一属性的地理要素，如等高线、行政界线、道路、水系等；专题电子地图，如土壤类型图、人口专题图等。
　　GIS专业人员，他们能够熟练地使用GIS进行制图和数据分析，他们需要的电子地图是一些包含基础地理信息的普通地图，建立规范、统一的WWW电子地图库，可以利用Internet资源实现数据和信息的共享，充分使用现有基础电子地图数据，避免重复劳动与重复投资(重新制作电子地图需花费大量人力物力)。而绝大多数的普通用户，他们没有使用过GIS，又缺乏制图经验，但这些用户对电子地图的需求量却在不断地增加。例如，历史学家需要研究区域的历史地图；社会学家和经济学家需要本地区的人口、就业、投资等专题地图；司机需要交通图；普通居民出门旅游需要旅游图等等。然而，这大量的用图需求却由于软硬件条件的限制常常得不到满足。
　　建立WWW电子地图库的另一重要功能就是信息发布，无论是公共图书馆，还是测绘、规划、环保和资源管理等政府部门都需要通过WWW广泛地传播政府信息。WWW电子地图库作为国家空间数据基础设施的重要组成部分，是发展地理信息产业的基础。各政府部门建立专业性的WWW电子地图库不仅可以方便相互之间的数据传递，实现信息共享，还可以向企业和公众及时传达政府的政策导向，帮助他们进行决策，使他们也有机会参与有关的政府决策。
3.2　系统软件的构成和功能
　　在代理服务器这台计算机中需要安装如下软件：
　　. Window NT4.0 Server版操作系统（附加 Pack 3包）。万维网GIS是GIS与万维网的有机结合，GIS通过万维网使功能得到扩展，并真正成为一种大众使用的工具。
2　程序实现
　　下面以实现以下报表为例，讲述程序的具体编制。开发基于万维网的开放式GIS，所需的技术支持主要包括Internet技术、数据库管理技术(DBNS)、面向对象方法、客户机/服务器模式(Client/Server)、插件技术和嵌入技术、分布计算平台、多媒体数据(包括空间数据)操作标准和地理数据目录服务技术。
　　如图1所示，WWW电子地图库的构成主要有4大部分：

图1 WWW电子地图的构成模型
　　(1)用户界面
　　同其它类型的Web站点一样，WWW电子地图库也有一个可视化的界面，能为用户提供一种交互性的查询方式。例如，在可这个数据库中建立一个用户表（Proxyuser），该表是由用户名，用户上网日期，用户上网时间，用户上网数据，目标IP地址等构成，当某个用户上网，Proxy就实时地把相关的数据写到这个表中。利用HTML格式的界面，用户可以选择自己熟悉的Web浏览器、菜单和工具箱浏览电子地图和查阅其它地理数据。数据由CGI(公共网关接口)传送，CGI程序可以把用户的选择转换为电子地图库管理器能够识别的指令，并将最终结果显示在用户界面上。例如，用户在界面上单击鼠标，会很快发出一个HTTP请求，服务器在接受HTTP请求后进行答复。
　　用户在浏览地图的同时可以通过缩放明确地定义出查询区域，也可对地图上的有关内容以动态链接的方式继续查询(包括文字、图片，甚至声音、录象)。这时，用户界面应该引导用户选择自己所需的电子地图，这就需要有良好的地理数据目录服务系统。
　　(2)目录管理
　　WWW电子地图库的目录管理系统使用户可以将他们的信息要求映射到电子地图库的大多数设备上，而一个传统的按作者、篇名、科目分类的图书馆目录系统则不能适应电子地图库的管理。由于地理空间数据管理的特殊性，我们必须采用新的按空间位置和特征性质分类的目录管理系统，这种目录管理系统允许按地名索引进行查询。所谓地名索引，是指地图上各种地物的地名特征及其空间位置的相互联系，也包括一些简单的描述，如城市、河流、山脉等。地名索引被保存在目录数据库中，其检索方式应该与图书馆的传统检索方式相一致。由于空间特征的模糊性(如上海是指上海市区还是整个上海市域)，即使用户不能准确地写出特征名称，地名索引也应该给出每一个特征的位置，甚至是包含它们的更大范围，而不仅是地图上的一点。
　　一个单位或企业的网络要想与Internet连接，可以采用两种连接方式，第一种方式，根据自己企业网中计算机数向ISP商申请IP，然后给每一台计算机都配置相应的IP，这样这个企业网中的计算机都可以上Internet，这种企业网络结构如图1所示。例如，存在两个同名的地物，但查询结果应该只是包含在地图浏览器窗口内的那一个地物。
　　我国现有的地理信息分类标准有：地理网格、国土基础信息数据分类与代码、林业资源数据分类与代码、矿产资源数据分类与代码；全国河流名称代码和城市地理信息系统标准化指南正在制定中。WWW电子地图库的目录应与国际标准ISO的TC211相衔接，并支持传统图书馆目录的标准网上协议，即Z39.50界面。针对这种计费的网络结构，我们用VB5.0开发的计费软件可以以多种方式统计出用户上网的数据量和费用。大多数的网上图象都是以GIF格式存储的，GIF格式的图象可以在网上任意地浏览、下载或打印。
　　由于VB中的窗体及图像框皆可做为其他对象的容器，并且可将自身直接输出至打印机，所以一方面我们可以在窗体上加上一个图像框，利用图像框的Print 、Circle等方法，在图像框上实现用户报表的输出，然后再利用图像框的Paintpicture方法实现报表的打印；另一方面，我们可以将一个窗体设置为无边框无控制象标的样式，然后再利用其Print、Circle等方法在其上输出文字和简单的几何图形，亦可放上Label、Image等控件，引入文字或图像，还可利用VB的网格控件实现用户要求的报表，然后利用窗体的Printform方法实现所编辑报表至打印机的输出。由于HTML还不能支持矢量数据的显示，所以必须先将按矢量格式存储的电子地图转换为GIF图象后，才能显示在用户界面上。对于专业GIS用户，则可直接下载矢量格式的电子地图，然后再利用GIS软件进行处理。
　　(4)数据获取
　　电子地图的来源是多种多样的：可以将现有的纸质地图数字化；也可以通过数字测量方法直接得到。所用VB版本为：Visual Basic 4.0-32专业版。目前，国内许多地图出版社也开始出版光盘的电子地图，如深圳市电子地图集。这些电子地图产品都可以直接存放在WWW电子地图库中，向社会提供电子地图的网络服务。
　　为了提高电子地图的实时性，电子地图数据库应及时进行更新，这就要求政府部门，特别是测绘部门应及时地提供最新的电子地图数据。各部门、各行业间应加强电子地图数据的交流，在各自的WWW电子地图库之间相互传递信息、及时更新数据。
3　WWW电子地图库的工作模式
　　用户通过普通的Web浏览器，可以在任何地方操纵WWW电子地图库，享用地理空间信息服务。与数据库之类的事务处理相比，多用户环境中的地理分析是一个相当长的时间的事务，称为"巨事务"。一个地理分析事务，可能在几秒钟内完成，也可能需要几十分钟。为了适应地理分析"巨事务"，可以使用HTML主页技术和Push技术，即将地理分析结果存储在特制的主页中，并通过Push机制，将结果送到客户端(见图2)。

图2 WWW电子地图库的工作模式
　　WWW电子地图库的工作过程如下：用户首先通过Web服务器在主页界面上向电子地图库的服务器发出用图请求和选择，这些请求被翻译为目录管理系统的特定查询语言(即结构化查询语言)；服务器根据查询命令从电子地图数据库中读取地图数据，并按用户的选择进行处理，处理结果保存在新生成的HTML主页中。用户在网上浏览新生成的主页，并决定是否下载查询结果。当用户完成这次请求后，服务器将删除该主页。若使用Push技术，服务器可在事务处理完成后，将结果自动传送给用户。
　　由于服务对象和功能的不同，WWW电子地图库可分为3种基本类型：
　　(1)简易型
　　这种WWW电子地图库针对大众用户设计，其地图数据库中只存储GIF格式的光栅图象，结构简单，不需要进行格式转换。用户通过Web浏览器直接阅读电子地图，并可进行平移、缩放、分层显示和信息查询，还可结合声音、图片、动画等制作多媒体信息系统。但由于磁盘容量的限制，电子地图数据库中不可能存储太多的光栅地图，这就限制了它的使用范围。　　　
作者简介：高欣婷　助理工程师。
　　如果是建立专门的遥感电子地图库，就只能采取这种形式。如美国加利福尼亚大学的亚历山大电子图书馆(http://alexandria.sdc.ucsb.edu)，他们存储了大量的航空相片和卫星相片，并可通过一系列的影象变换对这些相片裁剪、分层和分析。
　　(2)制图型
　　无论多么庞大的电子地图数据库都不可能拥有用户所需的全部地图，因此，建立制图型的电子地图库可以满足多方面的需求，特别是那些专业人员制作专题地图的需要。附源程序如下：
Private Sub MDIForm―Load()
frmprint.Show
End Sub

Private Sub Form―DblClick()
frmprint.PrintForm
Unload frmprint
End Sub

Private Sub Form―Load()

Rem变量high、leftsize、jiange用以定位
Dim high, leftsize, jiange,i As Integer,j As Integer
Dim grdhigh As Integer, grdwide As Integer
′分别表示网格的高、宽
jiange = 100：high = 0： grdhigh = 0： grdwide = 0

Rem 确定网格的大小
Grddisp.Cols = 6： Grddisp.Rows = 7

Rem设置窗体大小为打印纸宽度
frmprint.Width = Printer.Width：
frmprint.Height = Printer.Height
frmprint.Left = 0：frmprint.Top = 0

lblheading.FontSize = 16： lblheading.FontBold = -1
lblheading.Top = 500
lblheading.Left = (frmprint.ScaleWidth
- TextWidth(lblheading.Caption))/2
high = lblheading.Top + TextHeight(lblheading.Caption)

lbldata.Top = high + jiange
lbldata.Caption = Format(Now, "yyyy.mm.dd")
high = lbldata.Top + TextHeight(lbldata.Caption)

…
′在此进行行高、列宽以及对齐方式等项的设置
For i = 0 To Grddisp.Cols - 1
grdwide = grdwide + Grddisp.ColWidth(i)
+ Screen.TwipsPerPixelX
Next i
For i = 0 To Grddisp.Rows - 1
grdhigh = grdhigh + Grddisp.RowHeight(i)
+ Screen.TwipsPerPixelY
Next i
grdwide = grdwide + Screen.TwipsPerPixelX
grdhigh = grdhigh + Screen.TwipsPerPixelY
Grddisp.Width = grdwide：Grddisp.Height = grdhigh
Grddisp.Top = high + jiange * 3
Grddisp.Left=(frmprint.ScaleWidth-Grddisp.Width)/2
lbldata.Left=frmprint.ScaleWidth/2+Grddisp.Width/2
-TextWidth(lbldata.Caption) - 450
high = high + Grddisp.Height + jiange

…
′在此进行字体、字号设置及网格内容的填充
lblsign.top=high+jiange
lblsign.Left = frmprint.ScaleWidth / 2 + Grddisp.Width / 2 - TextWidth(lblsign.Caption) - 450

End Sub
　　本文程序在简体中文Windows 3.2、Windows 9x下调试通过。
　　(3)插入型
　　常用的Web浏览只提供一些最基本的浏览和网络导航功能，缺乏显示、处理地理空间数据的能力。解决这个问题的一种方案就是研制能和Web浏览器直接交换数据的专门GIS软件，这种由Netscape公司发明的增加Web浏览器功能的方法就叫插入法(Plug-in)。
　　这种方法的特点是速度快，可以处理矢量地图数据，因此，在专业部门内部建立基于Intranet的电子地图库就应该选用插入型。这样既可以方便数据的传递和信息资源的共享，又使专业的GIS人员能够充分利用插入Web浏览器中的新增功能。但它和传统的应用软件类似，也需要先安装、再使用，对交互网用户来讲，甚为不便。而且传统软件不同版本之间的兼容性及版本管理问题依然存在。
4　结束语
　　WWW电子地图库是国家空间信息基础设施(NSII)的重要组成部分，信息高速公路的建设和地理信息产业发展需要WWW电子地图库。
雇员情况一览表　1998.12.21

员工编号姓名性别出生年月职称工龄

制表人：　
　　新建一项目并在项目中插入一父窗体Mdiform1，在Form1上加入一个网格及三个标签，按照下表设置各对象的属性。我国的空间信息基础设施计划也已正式批准，我们应加紧建立WWW电子地图库，开辟新的网络服务领域，推动我国地理信息产业的发展。
作者简介：李乔 男，24岁，研究生，主要研究方向为地图制图与地理信息工程
作者单位：同济大学测量与国土信息工程系 上海 200092
参考文献
1　Lamont M，Bowles G I.Advancing the Digital Map Library.Information Technology and Libraries，1997，16(3)：121～124
2　Smith T R.A Digital Library for Geographically Referenced Materials．Computer，1996，(5)：54～60
3　孔云峰，林珲.基于万维网的地理信息系统集成研究.遥感学报，1998，2(2)：143～147
收稿日期：1998-08-31
