微型机与应用
WEIXINGJI YU YINGYONG
2000　Vol.19　No.5　P.24-25




语音拨号电话的研究与开发
宋志辉徐劲飞周兵
摘 要：美国Sensory公司的语音识别芯片RSC－164，介绍了主控芯片和RSC－164间的通信接口以及在此基础上研制的能进行语音拨号的多功能电话。
1 设计思路
　　本方法不采用EPROM存放监控程序，而是将监控程序放在CPU内，即采用内含ROM的8751、8752、89C51、89C52等作调试用CPU。语音识别技术就是其中一例。
　　现有的语音识别DSP芯片已经应用在电话机、身份识别、自动控制等多个领域中。
　　（5）代码调试成功后，将系统断电，在ROM座上插上EPROM，将JP1、JP2断开，JP3短接，找一电源，将其调至EPROM所需的编程电压，关掉该电源，将正极接至JP1的靠VPP一端的桩上，负极接系统地。此时，系统将从微机中逐段取得代码并将其固化在EPROM中。目前，还没有具有这种功能的通用芯片，一般需要自行编写单片机软件来完成。笔者所在的单位，从事各种电话机的设计工作多年，针对市场需要，在开发具有本公司特色的电话拨号MCU过程中，加入了对语音识别DSP的控制部分，开发出了语音拨号电话。
1 系统结构
　　本系统将美国Sensory公司的语音识别芯片RSC－164（以下简称164）应用到自行编写的电话MCU上，成功地开发出了语音拨号电话，系统结构如图1所示。

图1 语音拨号电话结构图
　　在普通电话机上，用户只能通过手柄和键盘与电话进行交互。而在本系统中，用户还可以通过手柄或机座上的话筒与系统进行交互，即：用户通过话筒输入指令信息，164识别、解释出语音指令并将其传送到MCU，MCU再根据该指令将控制信号发送到其它器件（也包括164）以完成相应的动作。
　　同时，用户也可通过键盘向MCU发出动作请求，MCU将用户的请求以相应指令的形式发送给164，164即开始进入工作状态，通过话筒与用户进行交互以完成训练或识别等功能。
2 语音识别芯片介绍
　　Sensory的RSC－164是一种高性能的语音识别芯片，其结构如图2所示。包结构为：固化起址、代码长度、代码数据块。另外1组是开发人员根据电话机的型号可以加入的提示信息，包括用户进行语音训练、识别、浏览和删除等操作的提示信息及数字0～9等（可合成电话号码）共102条。
　　164将人名和对应的电话号码以记录的形式存放在RAM中，1Mb的RAM可存放30条记录（也可扩充至2Mb，存放60条记录）。每条记录由4个部分组成：
　　（1）与人名有关的语音识别模板；
　　（2）人名的语音录音；
　　（3）相关的电话号码（可达30位）；
　　（4）属性信息。
　　语音拨号电话机系统主要运用了164的语音训练和识别功能。同时，由于系统具有自我固化的能力，使其真正摆脱了对专用开发工具的依赖，不但能被专业开发者使用，也为业余开发者提供了一个方便途径。按训练键，系统提示用户说2遍人名，系统可自动提取话音中的特征信息，将它们转换成2个独立的语音识别模板，并比较这2个模板。如果2个模板的差异在允许的范围内，则将其中的1个模板和对应的语音录音存入记录中（否则，提示用户2次输入差别太大，重新进行训练），提示用户从键盘上输入对应的电话号码后完成训练过程。系统会将每次训练过程中产生的识别模板与所有已经存在的模板进行比较，如果非常相近，系统会提示用户重新通过话筒输入人名。
关键词：直接调试 自编程 自举 可重定位 PC机
　　贵刊1999年第8期登载的一篇“用PC机直接调试单片机系统的实现”的文章很有新意，拓宽了单片机开发的思路，但仍存在少许不足之处，其不足之处有：
　　（1）要求目标系统既要有外部ROM又要有外部RAM，不适合仅有外部ROM或仅有外部RAM的系统；
　　（2）要求使用地址浮动技术进行目标机程序设计，若不小心，则易出错；
　　（3）不适合ROM大、RAM小的目标系统，因为在这种情况下，系统RAM装不下被调试的代码；
　　（4）系统不具有自编程功能，仍依赖专用开发装置，限制了其应用范围。这时，MCU可发出不同的命令，如读出对应的人名供用户确认是否识别正确、获得对应的电话号码并拨打出去等。
　　8751的特点是：当EA脚接高电平时，若指令指针IP未超过内含ROM容量，指令将从片内取得；当EA脚接低电平或IP值已超过内含ROM容量时，指令将从外部ROM中取得。它们之间的这些协调过程都是以实时通信为基础的，通信功能由164的串行接口完成，它是由3根线组成的同步串行接口，如图2所示，即双向数据线（DATA）、MCU握手信号（MHS-Master Handshake）和164握手信号（SHS-Slave Handshake）。由于监控程序在高端地址，故被调试的程序可从0000H开始放置，但这要求目标系统采用合并代码、数据空间模式。信号通信时的时序如图3所示。
表1 串行接口在通信时的状态定义
信号线方向作用:164→MCU作用:MCU→164
DATA双向数据线SHS=0,数据有效MHS=0时,数据有效
MHSMCU→164=0时,数据位被接收=0时,数据位有效
SHS164→MCU=0时,数据位有效=0时,数据位被接收


图3 数据在MCU和164之间的传送方式
　　数据在MCU和164的1个握手周期中传送1位，可对照表1和图3来进行说明： 
　　（1）当MCU要向164传送1位数据时，MCU将DATA线置成相应的值，确认SHS为高，则将MHS置为低以请求发送；
　　（2）164检测到MHS的低电平后，从数据线上获得该数据位，并将SHS置为低，用来通知MCU164已接收了该数据位；
　　（3）MCU检测到SHS的低电平后，将MHS置为高以表示数据位已无效，并释放数据线的控制权（将数据线置为高）；
　　（4）164把SHS置为高，以通知MCU1个数据位传送过程结束，双方准备好进行下1个数据位的通信。
　　164接收完MCU指令的最后1位时，将SHS一直保持为低电平以表示164正在执行该条指令。这个期间，双方一般不进行信息传递（但用户可通过MCU给164发送中断指令，取消正在执行的指令），直到164执行完该条指令后，才将SHS置为高，并开始向MCU发送执行结果。该过程与MCU向164发送指令过程相似，表1和图3已做了说明。
　　双方之间的通信总是以8位（1个字节）为1个数据进行的，而且规定从高位到低位进行传送。每次通信的数据总和称为1个数据包，1个数据包由4部分组成：同步字（FFH，即由8个1组成）、长度字、数据字（数据字个数＝长度字减1）、校验字（长度字与所有数据字的和）。
　　164能够识别30组指令，并进行相应的操作。如02H是训练指令，03H是识别指令等。

图2 单片机部分监控程序流程图
3 开发过程
　　（1）设计制作目标系统的软硬件。
4 总 结
　　根据本文提出的方法，我们已经成功开发出语音拨号电话的样机。设计时，将EPROM当作相同容量的RAM看待，即把整个系统的存储器都设计成既可存取数据又可存取指令的形式。同时，由于充分利用了RSC－164的语音识别功能，语音拨号功能稳定、可靠，在办公室、家庭等较安静的环境中，识别率可达95％以上。
　　在RSC－164的基础上，Sensory公司又推出了RSC－364芯片，其纠错能力更强，并加进了多种噪声处理技术，使其在各种环境中的平均识别率达到95．1％。电话机厂商运用RSC－364芯片，自行编写电话MCU，将能够开发出更加实用的语音拨号电话。
宋志辉（广东佛山东宝电器有限公司528000）
徐劲飞（广东佛山东宝电器有限公司528000）
周兵（广东佛山东宝电器有限公司528000）
参考文献
［1］孙涵芳，徐爱卿．MCS－51／96系列单片机原理 及应用修订版．北京：北京航空航天大学出版社，1996
［2］吕桂森．无绳电话机原理与维修．北京：人民邮电 出版社，1998
［3］Sensory Inc．Voice Dialer Data Book．19984 Holtek Inc．HT
［4］8CX0 8－Bit Microcontroller Series User′s Manual．1998
收稿日期：1999－12－28
