微型机与应用
MICROCOMPUTER & ITS APPLICATIONS
2000 Vol.19 No.2 P.48-49




机械手关节运动的微机控制
石东　袁国干　张桔苹
摘 要： 机械结构不相同的机械手要求控制系统的控制过程也不相同。本文介绍1种与人手运动相近的机械手微机控制原理及软件编程的技巧。
关键词： 微机控制 机械手 控制脉冲
　　简单常用的1种机械手的机械结构是在水平面上由2台步进电动机控制机械臂作横向和纵向运动。加工刀头若要完成曲线运动，是将曲线的横坐标和纵坐标分成若干个小段，在每个小段上由阶梯形线代替曲线。分段的数目越多梯形线就越接近实际曲线。刀头加工的精度也就越高。我们设计的这种玻璃刻花机械手与上述方案不同。在水平面上是2个转动副。这2个转动副都以垂直方向为轴转动来带动刀具作曲线运动。


1．4 IC卡写卡编程
　　写IC卡编程，依照以下步骤进行操作：
　　定义引用的外部函数，检查串口是否联好，检查是否插卡，给卡上电，初始化各区及其密码或核对卡主安全密码，核对所选区的读密码、写密码，写卡，熔断，给卡下电。小臂以肘为轴运动，手以腕为轴转动，二部分同时转动完成人手的各种动作。 
　　人员管理：设置操作人员权限。它要求2个转动副运动时必须同时进行，这就增加了软件编程的难度。
1 机械及微机系统硬件结构
1．1 机械部分
　　机械主要有刀具、小臂、大臂和机身4大部分。IC卡经熔断后，读写密码只能进行验证，不能再读出来显示。加工时必须时刻与加工曲线相切。故刀具应能以垂直方向为轴转动。转角为θ3。小臂与大臂动配合，以配合点的垂线为轴转动。转角为θ1。
　　IC卡是一种集成电路卡，它是随着半导体技术的发展以及社会对信息的安全性和存储容量要求的日益提高应运而生的。
1．3 IC卡读卡编程
　　要读出IC卡存储的内容，需要通过调用接口函数库提供的相应函数，依照下列步骤进行操作：定义引用的外部函数，检查串口是否联好，检查是否插卡，给卡上电，核对卡安全密码，核对所选区的读密码，读卡，给卡下电。转角为θ2。机身还能带动整个机械手臂作垂直升降运动。此机械手共有4个自由度。
1．2 微机控制部分
　　控制系统采用单片机控制的工业控制总线即STD总线。以广州市工商企业IC卡系统为例，我们建立起以1台双CPU的Dell机作服务器，12台微机作工作站的基于Client／Server模式的计算机网络系统，网络操作系统选用Windows NT 4．0，数据库管理系统选用MS SQL Server 6．5／7．0，开发工具采用Visual Basic，Visual Foxpro等。使机械作4个自由度运动。采用这种系统可使机械体积比较小，运行起来也比较可靠。 
　　统计：按企业类型、时间范围、操作人员等类别对制卡信息进行统计。
2 微机控制软件的原理与编程方法
2．1 控制刀具完成整体花型的数据结构
　　刀具各个自由度运动都有二种情况。一种是快速运动到指定地点。在不加工工件即玻璃时，进行空行程，各自由度运动速度可以快一些以减少加工时间。另一种是慢速运动。刀具加工的工作是玻璃，因此速度不能过快。否则将损坏产品。二种工作不同采用数据结构也不同。快速运动时每次发出的控制脉冲数很多。数据占用3个字节，第1个字节为快速标志。该字节中最高位D7表示步进电动机转动方向。次高位D6、D5从00到11 四种情况分别对应4个自由度。低5位全是1。因此，如果某类IC卡内有4个应用区，则共有9个密码。检测到这样的数据，在它下面的2个字节为脉冲数。所以快速脉冲数量最大可到65535个。
　　为改善行政执行手段，实现工商企业信息的自动化处理、传递、共享和交流，1996年，国家工商局决定进行发行工商企业IC卡的试点工作，制定IC卡全国统一标准，将企业登记注册的基本资料、年检信息、违法违章情况写入IC卡中，由企业自己持有。
　　慢速运动每次θ3、θ2、θ1各发1回，且脉冲数比较少。因此1个自由度占用1个字节。在数据区内慢速运动各个自由度依θ3―θ1―θ2次序排列，如图1所示。为了便于编写程序，慢速运行数据字节中高3位D7、D6、D5与快速标志的高3位含义相同。低5位是要发出的脉冲数。去掉快速标志1FH，则每次1个自由度发脉冲数最多为30个。

图1　花型数据库图

图2　双臂联动部分程序框图
2．2 双臂联动部分程序设计思想
　　程序框图如图2所示。首先从花型数据库中读1个数据。这个数据可能是快速标志，也可能是θ3的数据。这要判断数据中低5位是否全为1。若是则为快速运行某个自由度，转快速部分。否则按读进来的数低5位大小发脉冲，控制θ3步进电动机转1个角度，以调整刀具与曲线的位置。跟着这个读进来的数下面的2个数一定是θ1和θ2的脉冲数。

图3　脉冲波形图
　　将θ1和θ2数据同时读出来，判断θ1和θ2的最高位D7来控制步进电动机正转还是反转。然后程序对θ1和θ2角度进行位置跟踪。目的是使程序一直对应各自由度实际位置，使机械能自动控制各自由度恢复到起始位置。
　　接下来的程序是处理θ1和θ2同时发脉冲控制2台步进电动机联动的工作过程。按其内部封装的芯片的种类和功能可分为智能卡（SMART CARD）和存储卡（MEMORY CARD）。而双臂联动就是要在相同的时间内将控制2臂不相同的转角对应的脉冲数同时发完。这样2臂同时转动完成实际曲线运动。图3用脉冲波形图表示联动的脉冲情况。从图3中看出θ1和θ2应是2个频率不相同的方波，或者说是2个周期不相同的方波。随着发脉冲数的不同，方波周期也要变化。因此在程序中要随时计算变化的脉冲周期。将脉冲数对应的定时数放入定时器作为初始值，就可连续发一串脉冲。θ3、θ1、θ2 3个自由度都有发1串脉冲的过程，可编写1个子程序随时调用。
2．3 方波的产生和周期的计算
　　机械的小臂和大臂同时发出不同的脉冲，需要产生2个周期不同的方波。这要用到2个定时器。在51系列单片机内部正好有2个定时器CT0和CT1。让2个定时器都工作在中断定时状态，来完成θ1和θ2 2脉冲波的产生。玻璃刻花工艺要求刀具加工速度不能过快，小臂和大臂控制脉冲方波周期不同，则小臂和大臂加工速度都可能是变化的。为了满足工艺要求，我们设计2臂之中发脉冲多的那个臂脉冲周期固定。另1个臂的加工速度一定小于这个臂的加工速度。
　　在程序中首先找出脉冲数大的那个臂。将控制它动作的定时器设为CT0，并且根据下面方法确定定时器初始值。由公式

　　计算出步进电动机的角频率。式中K为大臂或小臂转动角频率与步进电动机的角频率的机械传动比。2臂的传动比相等，K＝150。V为刀具刻花的线速度。由工艺要求设定为V＝1．3mm／s。R为大、小臂长度，也为相等值R＝132mm，则步进电动机角频率ω＝84．6°／s。步进电动机的步距角β＝0．75°。可求出控制脉冲频率

则脉冲宽度为TW＝1／2f＝4．43ms。
　　MCS－51单片机晶体振荡频率f0＝11．0592×106Hz。时钟频率为晶体振荡频率的一半，且机器周期是时钟周期的6倍。所以机器周期Tm＝2×6／f0＝1．085μs。由此得到定时器初始值

　　单片机定时器采用工作方式1，它为溢出定时，实际送入定时器的初始值应为10000H－1000H＝F000H。
　　上面计算的定时器初始值为一定值。控制脉冲数大的那个臂以确定速度运动。另1个臂的脉冲周期是1个变化的数值。随着每次发脉冲的个数不同而变化，以保证2臂的不同脉冲个数在相同时间内输出给步进电动机。因此另一定时器计时初始值应由程序每次计算。计算方法如下。因2臂发的脉冲数比等于2定时器初始值的反比，则：

式中R3为2臂中脉冲数大的那个方波的脉冲数。R4是小的那1个。因CT0＝1000H，则R3乘以1000H再除以R4就可算出CT1，再求补即为CT1定时器的初始值。每次发一串脉冲前用此初始值付给第2个定时器。
　　利用上述控制过程，可作到机械手双臂联动。而使刀具行走出与实际曲线无偏差的路径。提高机械控制精度。若将硬件和软件稍加改动还可实现机械手的多自由度的联动，使机械手控制更加完善。
石东（天津轻工业学院自动化系96号信箱300222）
袁国干（天津轻工业学院自动化系96号信箱300222）
张桔苹（天津轻工业学院自动化系96号信箱300222）
参考文献
1，何立民．单片机应用系统设计．北京：北京航空航天大学出版社，1990
2，魏庆福．STD总线工业控制机的设计与应用．北京：科学出版社，1992
3，袁国干．微机在自动玻璃刻花机中的应用．微型机与应用， 1996；15（7）
收稿日期：1999－08－27
