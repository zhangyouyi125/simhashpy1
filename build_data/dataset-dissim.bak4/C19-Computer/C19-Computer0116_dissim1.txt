计算机应用
COMPUTER APPLICATIONS
1999年 第19卷 第9期 Vol.19 No.9 1999



基于ASP/ADO的NT网络数据库解决方案
向坚持　林亚平
　　摘　要　本文介绍了在NT的Web服务器上，利用IIS所内含的ASP和ADO，将ASP与ADO技术相结合，实现NT网络数据库访问的方法。
　　如何使数据库也能记载历史数据呢。并对如何设计这些触发器进行了探讨。
2　ASP与ADO数据库设计方法
　　ASP是动态服务器主页的缩写，内含于Microsoft公司的IIS 3.0及其以上版本中，是Microsoft公司为它的Web服务器开发的一个开放的、独立于浏览器、不需要编译的Web应用环境。ASP 提供了一个服务器端的脚本编写环境，它可以组合HTML页、脚本命令和ActiveX服务器组件，创建和运行动态、交互的基于Web 服务器的功能强大的应用程序。（见图3）

图3　中间作为不同应用系统间的数据接口
　　要注意的一点是：图示应用系统间的数据是单向流动的（即数据传递）；如果数据需要双向流动（即数据交换），那么在触发器设计中应有退出机制，以避免发生触发器的递归。它提供了开放的数据操作对象模型，允许开发人员使用任何语言和统一的编程模式操作各种与ODBC和OLE-DB兼容的数据库，如Access 、SQL、Oracle、Informix、FoxPro等。ASP与ADO技术相结合，建立和提供包含数据库信息的主页内容，通过执行SQL命令，让用户在浏览器中进行数据的查询、输入、修改、删除和更新等操作。并可利用VBScript或JScript等脚本语言来控制数据库的访问，实现查询结果的输出显示等功能。
　　ASP与ADO技术相结合，实现NT网络数据库访问的这种B/S结构，实际上也是三层模式C/S的一种。其访问数据库的基本过程如图1所示。
　　ASP与ADO技术相结合，实现数据库访问的具体方法如下：
　　首先，选择一种支持ODBC的数据库，如Access等，建立数据库和相应的数据表。
　　建立这类触发器的步骤是：建立数据表后，再建立对应的历史表（一般而言，历史表在字段组成上是数据表的超集，即在原数据表字段上再增加有关时间的字段），然后在两者之间设立触发器（见图2）。操作如下：选择“控制面板”中的ODBC选项，再选择一种DSN（如System DSN），然后单击“添加”按钮，选择相应数据库的驱动程序。
　　在这种情况下，触发器可以是一种较好的解决方式：建立中间表，中间表的设计符合需方应用系统的设计格式，而它的数据又与供方应用系统的数据保持一致。DSN是应用程序和数据库之间的桥梁，在程序中访问数据库时，将DSN传输给系统，通过DSN访问实际数据库。

NT网络数据库访问的基本过程
　　接着，创建数据库链接，并打开数据库。即使用“Set MyConn = Server.CreateObject ("ADODB.Connection")”语句创建链接，使用“MyConn.Open "数据源名"”语句打开数据库，并可同时指定访问该数据库的用户姓名和密码。方法如下：“MyConn.Open "数据源名" "username","password"”。
　　然后，执行数据库的访问操作。对于简单的SQL命令，可以直接使用语句“Set RS = MyConn.Execute("SQL命令")”实现；对于复杂的SQL命令串，可以通过连字符“&”连接起来，也可以用存贮过程来实现。
　　最后，是数据库的关闭和链接的关闭。分别通过两个简单的命令实现：RS.Close和MyConn.Close。
3　实例
　　利用Internet和WWW开展远程教育(Distance Education)是当今计算机发展的一个全新的课题，是对传统教育的重大革新和补充。远程教育技术涉及到许多重要的技术如协同工作、交互式技术等。它的特点是：一旦被定义，就存在于后台数据库系统（server，服务器方）中，并会在相应条件下自动地隐式执行，从而使得它的设计既与前台（client，客户机方）的平台无关，又免除了前台相关的数据操作设计。下面，以在线报名为例，简要介绍该设计方法。
3　结语
　　触发器对数据库开发过程中遇到的问题，往往会有独到的解决方法。
　　在这种情况下，如果不使用触发器的话，数据库设计就存在困难：
　　. 如果为每个部门都建立一个表，显然难以得到汇总的数据（在这种情况下，无法利用视图机制）；
　　. 如果所有的部门都共享一个表的话（这时，这张表中的数据实际就是汇总的数据），因为每个部门需要维护数据，所以都对这个表有修改权，因此在数据安全上难以控制。
　　关键词　触发器，数据分散―集中模型，历史数据导出，数据接口
1　引言
　　在大型数据库设计中，会经常用到触发器。
　　bmxt.asp的部分源程序如下:
<!但在很多情况下，历史数据的记载与分析反而比现实数据更有意义（这也正是数据仓库与数据库的区别之一），比如学校中学号的变动，工厂定额的更改，公司产品和原材料价格的变化、股票的升跌等等，它们都需要记录历史数据! -- Web服务器端处理 -- >
<%
if request.form("xm")<>"" and request.form("xb")<>"" and request.form("nl") <　>"" and request.form("bmzy")　<　>""
and request.form("lxdz")<>"" then
set MyConn=Server.CreateObject("ADODB.Connection")
MyConn.Open "Students","",""
SQL="insert into bmb(xm,xb,nl,bmzy,byxx,lxdz,bmrq) 
values(′"&request.form ("xm")&"′,
′"&request.form("xb")&"′ ,
′"&request.form("nl")&"′,
′"&request.form("bmzy")&"′,′"&request.form("byxx")&"′,′"&request.form("lxdz")&"′, 
′"&request.form("&date()")&"′)"
set RS=MyConn.Execute(SQL)
response.write("您的报名号是："&RS("ID1"))
Response.write("您的报名工作已结束!")
RS.close
MyConn.close
else
Response.write("您填写的信息不完全,请重新填写!")
Response.end
end if
%>
</body>
</html>
作者简介：向坚持　在职硕士研究生，讲师。主要研究方向：计算机网络及远程教育技术。
林亚平　教授。主要研究方向：计算机网络。
作者单位：向坚持　湖南师范大学计算机教学部　湖南.长沙 (410081）
林亚平　湖南大学计算机系　湖南.长沙 （410082）
参考文献
［1］　周世雄. NT动态站点设计.大连：大连理工大学出版社，1997
［2］　刘艳梅，等.基于B/S结构的跨平台异构型数据库系统.计算机系统应用，1998;(8)
收稿日期:1999-06-28(修改稿)
