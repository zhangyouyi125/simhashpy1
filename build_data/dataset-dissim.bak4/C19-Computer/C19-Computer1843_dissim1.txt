微型机与应用
MICROCOMPUTER & ITS APPLICATIONS
2000 Vol.19 No.2 P.48-49




机械手关节运动的微机控制
石东　袁国干　张桔苹
摘 要： 机械结构不相同的机械手要求控制系统的控制过程也不相同。本文介绍1种与人手运动相近的机械手微机控制原理及软件编程的技巧。
　　考虑3种基本更新：
　　1．insert（N1，N2）：将N2的OID加入到value（N1），N1必须是集合类型，更新完成后N2成为N1的儿子。它使得同一视图定义语句能从不同结构的数据源导出实视图，提高了地图应用系统的适应性，缺点是需要额外的模型转换工作。分段的数目越多梯形线就越接近实际曲线。刀头加工的精度也就越高。我们设计的这种玻璃刻花机械手与上述方案不同。在水平面上是2个转动副。这2个转动副都以垂直方向为轴转动来带动刀具作曲线运动。当没有对象满足该条件时返回 。小臂以肘为轴运动，手以腕为轴转动，二部分同时转动完成人手的各种动作。这种结构的控制过程与作直线运动的机械手控制过程完全不同。
　　定义1：一条路径（path）是零个或多个标注（label）和点号交替排列的序列：p＝l1．l2…ln。
1 机械及微机系统硬件结构
1．1 机械部分
　　机械主要有刀具、小臂、大臂和机身4大部分。刀具固定在小臂的前端，是1个片状砂轮。加工时必须时刻与加工曲线相切。故刀具应能以垂直方向为轴转动。转角为θ3。小臂与大臂动配合，以配合点的垂线为轴转动。转角为θ1。大臂与机身也是动配合。
　　假设例1数据库中执行更新inser（M1，M13），这时M13只是个空对象，对实体视图没有影响。转角为θ2。机身还能带动整个机械手臂作垂直升降运动。此机械手共有4个自由度。
1．2 微机控制部分
　　控制系统采用单片机控制的工业控制总线即STD总线。通过驱动电源控制4台步进电动机。使机械作4个自由度运动。采用这种系统可使机械体积比较小，运行起来也比较可靠。如果N2∈N1．p，则N1是N2的祖先（ancestor），N2是N1的1个后代（descendent），p中的第一个标注是N1的儿子，最后一个标注则与N2的标注相同。
2 微机控制软件的原理与编程方法
2．1 控制刀具完成整体花型的数据结构
　　刀具各个自由度运动都有二种情况。一种是快速运动到指定地点。在不加工工件即玻璃时，进行空行程，各自由度运动速度可以快一些以减少加工时间。另一种是慢速运动。刀具加工的工作是玻璃，因此速度不能过快。否则将损坏产品。二种工作不同采用数据结构也不同。快速运动时每次发出的控制脉冲数很多。数据占用3个字节，第1个字节为快速标志。该字节中最高位D7表示步进电动机转动方向。次高位D6、D5从00到11 四种情况分别对应4个自由度。低5位全是1。如图1所示。检测到这样的数据，在它下面的2个字节为脉冲数。所以快速脉冲数量最大可到65535个。这足以满足手臂完成整个行程。
　　慢速运动每次θ3、θ2、θ1各发1回，且脉冲数比较少。因此1个自由度占用1个字节。在数据区内慢速运动各个自由度依θ3―θ1―θ2次序排列，如图1所示。为了便于编写程序，慢速运行数据字节中高3位D7、D6、D5与快速标志的高3位含义相同。低5位是要发出的脉冲数。去掉快速标志1FH，则每次1个自由度发脉冲数最多为30个。这种实视图定义语句局限于特定的数据模型。首先从花型数据库中读1个数据。这个数据可能是快速标志，也可能是θ3的数据。这要判断数据中低5位是否全为1。若是则为快速运行某个自由度，转快速部分。否则按读进来的数低5位大小发脉冲，控制θ3步进电动机转1个角度，以调整刀具与曲线的位置。跟着这个读进来的数下面的2个数一定是θ1和θ2的脉冲数。

图3　脉冲波形图
　　将θ1和θ2数据同时读出来，判断θ1和θ2的最高位D7来控制步进电动机正转还是反转。然后程序对θ1和θ2角度进行位置跟踪。目的是使程序一直对应各自由度实际位置，使机械能自动控制各自由度恢复到起始位置。
　　接下来的程序是处理θ1和θ2同时发脉冲控制2台步进电动机联动的工作过程。在刀具行走1个曲线时，小臂θ1和大臂θ2的转角往往是不一样的。而双臂联动就是要在相同的时间内将控制2臂不相同的转角对应的脉冲数同时发完。这样2臂同时转动完成实际曲线运动。
关键词： GIS 实视图 对象交换模型 层次－关系模型 增量维护
　　地理信息系统（GIS）的核心是地理数据库，它要保存描述地图上实体的属性数据和描述地物空间特性的空间数据。从图3中看出θ1和θ2应是2个频率不相同的方波，或者说是2个周期不相同的方波。随着发脉冲数的不同，方波周期也要变化。因此在程序中要随时计算变化的脉冲周期。将脉冲数对应的定时数放入定时器作为初始值，就可连续发一串脉冲。例如river．R2就是一条路径。
2．3 方波的产生和周期的计算
　　机械的小臂和大臂同时发出不同的脉冲，需要产生2个周期不同的方波。这要用到2个定时器。在51系列单片机内部正好有2个定时器CT0和CT1。让2个定时器都工作在中断定时状态，来完成θ1和θ2 2脉冲波的产生。玻璃刻花工艺要求刀具加工速度不能过快，小臂和大臂控制脉冲方波周期不同，则小臂和大臂加工速度都可能是变化的。为了满足工艺要求，我们设计2臂之中发脉冲多的那个臂脉冲周期固定。本文我们将采用对象交换模型（OEM）为中间模型，讨论层次－关系数据库上的实视图机制和它的增量维护算法。
　　在程序中首先找出脉冲数大的那个臂。将控制它动作的定时器设为CT0，并且根据下面方法确定定时器初始值。由公式

　　计算出步进电动机的角频率。式中K为大臂或小臂转动角频率与步进电动机的角频率的机械传动比。2臂的传动比相等，K＝150。V为刀具刻花的线速度。由工艺要求设定为V＝1．3mm／s。R为大、小臂长度，也为相等值R＝132mm，则步进电动机角频率ω＝84．6°／s。步进电动机的步距角β＝0．75°。可求出控制脉冲频率

则脉冲宽度为TW＝1／2f＝4．43ms。
　　MCS－51单片机晶体振荡频率f0＝11．0592×106Hz。时钟频率为晶体振荡频率的一半，且机器周期是时钟周期的6倍。所以机器周期Tm＝2×6／f0＝1．085μs。由此得到定时器初始值

　　单片机定时器采用工作方式1，它为溢出定时，实际送入定时器的初始值应为10000H－1000H＝F000H。
　　上面计算的定时器初始值为一定值。控制脉冲数大的那个臂以确定速度运动。另1个臂的脉冲周期是1个变化的数值。随着每次发脉冲的个数不同而变化，以保证2臂的不同脉冲个数在相同时间内输出给步进电动机。因此另一定时器计时初始值应由程序每次计算。计算方法如下。因2臂发的脉冲数比等于2定时器初始值的反比，则：

式中R3为2臂中脉冲数大的那个方波的脉冲数。R4是小的那1个。因CT0＝1000H，则R3乘以1000H再除以R4就可算出CT1，再求补即为CT1定时器的初始值。每次发一串脉冲前用此初始值付给第2个定时器。
　　利用上述控制过程，可作到机械手双臂联动。而使刀具行走出与实际曲线无偏差的路径。提高机械控制精度。若将硬件和软件稍加改动还可实现机械手的多自由度的联动，使机械手控制更加完善。
石东（天津轻工业学院自动化系96号信箱300222）
袁国干（天津轻工业学院自动化系96号信箱300222）
张桔苹（天津轻工业学院自动化系96号信箱300222）
参考文献
1，何立民．单片机应用系统设计．北京：北京航空航天大学出版社，1990
2，魏庆福．STD总线工业控制机的设计与应用．北京：科学出版社，1992
3，袁国干．微机在自动玻璃刻花机中的应用．微型机与应用， 1996；15（7）
收稿日期：1999－08－27
