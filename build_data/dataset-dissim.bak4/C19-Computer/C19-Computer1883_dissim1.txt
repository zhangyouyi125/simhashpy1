微型机与应用
MICROCOMPUTER & ITS APPLICATIONS
2000　Vol.19　No.4　P.21-23



基于单片机控制的高精度电缆自动测试仪
于秋瑛 顾炳永 于国桥 程春耕 段雪松 王然伟
摘 要： 一种基于单片机控制的高精度电缆自动测试仪。该测试仪能实现多芯电缆的绝缘电阻值、芯线电阻值和分布电容值的自动检测。
关键词： 多芯电缆 单片机控制 继电器分组和隔离 快速线性化 绝缘测试
　　目前国内一些公司研制的电缆检测仪在技术上虽然采用单片机控制或STD总线工业控制机控制，但检测精度不高、检测速度低、体积较大、操作使用复杂、可靠性差。我们采用8031单片机、继电器分组和隔离技术、先进的抗干扰技术、先进的数值快速线性化技术及独特的预充电技术，研制了一种新型电缆自动测试仪。
1　系统主要功能及测量理
　　本系统可对少于198芯的多芯电缆进行芯线电阻、芯线间绝缘电阻及芯线间分布电容值的快速自动检测，在0.5～2s内完成单线测试；能准确地测出电缆芯线的断点和短路位置，并能对不合格的测试结果进行保存和查询；操作使用方便，更换测试档位及量程时，无需任何人工校准。此外，芯片内部含有16Kb的StandbySRAM，也可以构造成8位或16位数据宽度，存取时间为90ns，包括地址锁存与译码PLD时间。测试中，给被测电缆施加电压、产生电流，由采样电阻把信号取出，再经过放大、线性化、模数转换，经串行口送给单片机进行数据处理，最后由单片机把处理结果送显示和控制。整个过程全部智能化和自动化。
2　系统硬件结构设计
　　本系统硬件由控制器、测试电路、继电器、转换矩阵、面板显示和操作电路及电源等部分组成。

图1　使用PSD5XX前、后原理框图比较
　　基于PSD芯片的硬件设计方法采用PSDsoft开发工具，利用其中的PSDabel软件生成符合PSD芯片要求，在电路结构上可行的数字逻辑，再采用PSDconfiguration软件来构造总线接口与I／O端口，借助PSD编程器生成的目标文件对芯片编程，从而完成1次设计。

图1　系统硬件原理图
2.1　控制器
　　控制器由CPU、EPROM、EEPROM、SRM、缓冲器、光电耦合器及WDT组成。CPU为8031，完成本测试仪的控制和计算。27C256为32KB EPROM，完成程序的存储。2864为8KB EEPROM，完成预置参数的存储，并能使在起启电时参数复现。6264为8KB SRAM，作为外部存储器。4251芯片作为CPU监视定时器（WDT），CPU每隔0.1s将WDT清1次零，当程序出错或死循环时，WDT在0.125s将CPU复位，程序从头开始。以上器件以8031为中心组成系统，是整个测试仪的控制中心。
　　5．替换功能输入模式
　　用户在模式下能定义端口E的引脚，以执行替换功能，主要是计数器／定时器的输入，构造方法如下：
　　（1）在PSDsoft软件中选择输入功能；
　　（2）PSD编译器为选定的功能指定引脚。为此要求用户：在应用软件中对某些端口构造寄存器进行初始化；在PSDsoft软件中构造PSD5XX，并把未用的输入引脚拉到VCC或GND。由RC充放电电路、脉冲产生器、A/D模数转换器等电路组成电容测试电路。
器件存储器空间存储器页面
EPROM块00000H～7FFFH页面0
EPROM块10000H～7FFFH页面1
EPROM块20000H～7FFFH页面2
SRAM8000H～8FFFH所有页面
I/O设备D000H～D0FFH所有页面

3．2 I／O端口的配置
　　PSD5XX的端口具有多种工作模式，某些基本功能为ZPLD和计数器／定时器提供输入／输出，或者用作标准I／O端口，每1根端口引线都可以单独构造。
　　2．PLD I／O模式此模式使端口能构造为ZPLD输入，或作为GPLD的输出，并能使输出为三态，控制信号由来自GPLD的乘积项定义，构造方法如下：
　　（1）在ABEL文件中命名引脚或信号；
　　（2）在ABEL文件中写逻辑方程；
　　（3）用PSD编译器给PSD配置PLD功能。将继电器触点分成20组，每组有5只继电器触点并联在测试回路中，减少了测试误差。通过中间插入21只隔离继电器，解决了连接和隔离问题，保证了测试电路的高绝缘状态。
2.4　显示电路
　　显示电路由2只MAX7219集成块、14只LED数码管和8只LED指示灯组成。MAX7219为串行接口8位数字LED显示驱动器，每只MAX7219带7只LED数码管和4只LED指示灯，2只MAX7219串联，串行送数据。CPU 8031通过串行口，每隔0.1s给NAX7219的RAM存储器送显示数据，MAX7219根据初始化的要求，将RAM中的数据自动扫描显示。
2.5　操作电路
　　操作电路由1只74LS165和8只薄膜按钮开关组成。74LS165为并行输入、串行输出的8位移位寄存器。各端口及控制寄存器地址由基地址CSIOP＋偏移量确定，其中的基地址由PSD软件配置。CPU 8031通过串行口，每隔0.1s取1次按钮开关的状态数据并及时进行处理，同时把结果送显示或输出相应的控制信号。
3　系统软件
　　本系统软件用MCS-51汇编语言生成，采用模块化结构和子程序嵌套技术，可节省内存，便于程序的编制、修改、扩充和联调。整套程序由主程序、25个子程序和2个中断服务程序构成，共2500条指令。下面介绍几个比较重要的程序模块。
3.1　主程序
　　主程序框图如图2所示。主要完成初始化和0.1s环检查。具体的ABEL文件如下：MODULE 80C196KCTITLE “example of 80C196KC using PLD5XX”A15，A14，A13，A12，A11，A10，A9，A8 PIN；Pgr3，Pgr1，Pgr2，Pgr0 NODE；CSIOP，RS0，ES0，ES1，ES2 NODE；BUSWIDTH，READY，RESET＿OUT，CSOUT PIN 30，31，33，36；RESET＿IN PIN；X ＝．X．；PE＝Pgr3，Pgr1，Pgr2，Pgr0；ADDRESS＝A15，AAG14，A13，A12，A11，A10，A9，A8，X，X，X，X，X，X，X，X，；EQUATIONSCSIOP＝ADDRESS＞＝＾HD000＆ADDRESS＜＝＾HD0FF；RS0＝ADDRESS＞＝＾H8000＆ADDRESS＜＝＾H87FF；ES0＝ADDRESS＞＝＾H0000＆ADDRESS＜＝＾H7FFF＆PAGE＝＝0；ES1＝ADDRESS＞＝＾H0000＆ADDRESS＜＝＾H7FFF＆PAGE＝＝1；ES2＝ADDRESS＞＝＾H0000＆ADDRESS＜＝＾H7FFF＆PAGE＝＝2；CSOUT＝ADDRESS＞＝＾HC000＆ADDRESS＜＝＾HCFFFBUSWIDTH＝CSIOP＋RS0；READY＝RS0；RESET＿OUT＝RESET＿IN；END 80C196KC；上述文件经过仿真、编译后，即可用PSDsoft软件生成的目标文件对PSD5XX芯片编程，从而完成PSD5XX芯片的最后设计。如果P3.5是高电平，则进行初始化工作，对有关寄存器清零。从EEPROM取出断电前存储的数据，送到有关寄存器。对7219显示驱动器初始化，送显示初始值。定时器T0初始化，开T0和串行口中断，然后进入循环查询计数器1是否为0.1s。如果有干扰使程序出错，进入循环后WDT将CPU复位，则程序从头开始。这样就要求将EPROM块指定到3个不同的页面中，分配表如表1所示。

图2　主程序框图
3.2子程序
　　子程序主要有0.1s工作子程序、按钮处理子程序、判测试项目子程序、电源测试子程序、电容测试子程序、通路测试子程序、绝缘测试子程序、取A/D转换数据及运算子程序、查询子程序、送显示数据子程序等。
　　“0.1s工作子程序”为0.1s工作1次，主要完成以下任务：判断在什么工作状态，并进入该状态；判断在测试状态中的各种状态，并作出各种反应及操作；对不合格芯线号及其测试值进行寄存；组织最新数据送显示；组织最新控制参量送控制操作；进行步进操作。
　　“按钮处理子程序”完成8个按钮的操作判断；每个按钮产生的某种状态的置位和某个指示灯的显示；预置操作中完成预置位的增减变化和闪亮送数显示；查询状态中完成查询操作和显示。
3.3　中断服务程序
　　中断服务程序由“T050ms中断服务程序”和“串行中断服务程序”组成。另外，页面逻辑连接到ZPLD零功率PLD，便能够扩展具有有限地址空间的单片机的地址空间，最大可扩展到16个页面。

图3　T050ms中断服务程序

图4　串行中断服务程序
　　“T050ms中断服务程序”主要完成#个工作。当T0定时器计满后产生溢出，使T0中断标志置1，产生中断，进入中断服务程序：①将计数器1+1，为主程序检查计数器1作准备；②给T0定时器送底数3CB0H为T0计数器产生)50ms溢出作准备；③中断标志置零，为下次中断作准备。
　　“串行中断服务程序”完成串行送数工作。计数器6存有发送和接收数据的字节数，进入中断后，首先将计数器6减1，如计数器6为零，则串行送数完毕关串行中断；如计数器6不为零，则检查T1是否为1，是1为发送状态，则将发送数据输SBUF，数据被发送出去；当T1为0，为接收状态，将接收数据存入指定位置。最后将T1、R1置0，为下次中断作准备。
4　结束语
　　本测试仪已试用于实际检测，适用于武器装备的地面电缆网、舰船电缆网、飞机电缆网、工业电缆网以及通信电缆网的检测，是一种很有推广前景的现代测量仪器。
收稿日期：1999－11－24
