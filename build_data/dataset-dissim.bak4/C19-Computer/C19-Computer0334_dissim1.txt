计算机应用
Computer Applications
1999年 第19卷　第8期 Vol.19　No.8 1999



企业网计费系统的设计与实现
张　庄
　　摘　要　本文提出一种投资少、效果好的网络结构和计费方法，并且已经运行。
　　关键词　网络结构，网络连接
1　引言
　　随着Internet的普及，越来越多的单位或企业纷纷将自己的企业网与Internet网连接，这样就给企业网络管理带来了许多问题：安全问题，配置管理，计费管理等。创建索引时，包括索引对象变量，设置主索引及唯一性，创建索引的字段，最后将索引字段和索引分别添加到字段集合和索引集合中。
　　其中DC最简单，配合数据绑定(Bounding)控件，通过JET达到不用编写任何代码即可实现显示或更新数据库的目的，但在功能上受到很大限制，比如不能用程序进行控制、信息的检索无法实现等，一般情况下仅适用于初级人员使用。
2　系统设计原理
　　Internet目前采用TCP/IP协议进行网络通信，在Internet网中的每一台计算机都必须拥有唯一的一个只属于自己的IP作为主机地址，这样所有Internet网上的计算机都可以通过这个IP地址找到这台主机与其通讯交换信息。因此，计费软件只要对每一个这样的IP地址的通讯数据进行统计，就可以得到上网用户使用的准确纪录。
　　一个单位或企业的网络要想与Internet连接，可以采用两种连接方式，第一种方式，根据自己企业网中计算机数向ISP商申请IP，然后给每一台计算机都配置相应的IP，这样这个企业网中的计算机都可以上Internet，这种企业网络结构如图1所示。


图1
　　在图1网络结构中要想实现对每一台计算机进行计费可以有两种方法，第一种将装有计费软件的计算机接到主干线，该计费软件主要特点必须定时到Router中取各个IP包数据，然后把各IP包数据贮放到本机中。结构如图2所示：


图2
　　第二种将装有计费软件的计算机接在Router与主干线之间，结构如图3所示：


图3
　　在这个结构图中所有计算机首先必须通过这台计费计算机后才能上Internet，所以计费软件不是到Router中取IP包数据而是自动纪录下各个通过它的IP包数据。它们的区别在于第一种的Router必须要有IP Accounting功能，否则计费软件不能工作。第二种的Router就可以不要 IP Accounting功能，计费软件也可以工作。
　　第二种连接方式，向ISP商申请2个IP采用代理服务的方法，企业网的所有计算机都用自己定义的内部IP地址，当内部网的计算机想上Internet时，必须通过代理服务方式把内部IP转成正规的IP然后进入Inernet，如图4：


图4
　　在以上两种方式（图1、图4）中，第一种计费是对每台计算机的IP进行统计然后打印出各台计算机使用的情况，对使用者来讲所有Internet功能都能实现，没有限制。但对企业，首先它要对这么多的IP交IP租用费，还有因无限制使用，故数据量很大，费用也大，不能区分出哪个用户使用的情况。
　　到此为止，数据库结构基本上建立好了，以后可使用RecordSet对象的MoveFirst，MoveLast，MovePrevious，MoveNext，FindFirst，FindLast，FindPrevious，FindNext等方法访问数据库了。因此，对企业来讲，代理计费方式经济实用，管理和使用都方便。
3　计费系统的实现
3.1　实现的环境
　　图4是一个典型的代理计费网络结构,在该图中,装有计费软件代理服务器这台计算机配置二个100M的网卡，一块要与Router连接，网卡置为正规的IP地址，另一块配企业自己定义的内部IP地址跟企业网的主干线连接。
　　JET引擎的数据类型除常见的外，还包括二进制型（图像处理），OLE型（对象链接及嵌入）。
3　使用DAO创建数据库
3.1　创建数据库
　　包括定义数据库对象变量，建立一个数据库，把创建的数据库对象赋给数据库对象变量。
　　为了便于对上网用户的管理，我们利用NT设置一个用户组，属于这个组的成员都允许它们上Internet，企业网的系统管理员只要对该组的成员进行增加、删除、更改。因此，管理十分方便。
　　. Proxy Server 2.0代理软件。
　　代理服务Proxy 2.0把属于允许进入Internet组中的成员“送”到Internet，同时纪录这个成员上网的数据量等其它信息。Proxy 2.0还可以限制用户上网的功能，例如，企业只允许它们的员工游览Internet（即HTTP）不能Oline聊天（或游戏），那末它可以通过Proxy 2.0的设置定义用户只能HTTP，这样帮助企业减少许多无用数据，节约了开支。
　　. SQL Server 6.5数据库服务软件。
　　SQL Server数据库服务软件为Proxy 2.0创建一个数据库,这个数据库贮放Proxy纪录下来的所有上网用户的信息,计费软件就是从该库中读取数据进行统计。例如，在可这个数据库中建立一个用户表（Proxyuser），该表是由用户名，用户上网日期，用户上网时间，用户上网数据，目标IP地址等构成，当某个用户上网，Proxy就实时地把相关的数据写到这个表中。
Dim TableObjVar As TableDef
′定义表对象变量
Set TableObjVar=DataBaseObjVar.CreateTableDef(TableName)
′创建表，并赋给表对象变量
DatabaseObjVar.TableDefs.Append TableObjVar 
′将表添加到表集合中
　　TableObjVar为访问创建表的对象变量，TableName为创建的表名，TableDef为表对象，CreateTableDef为创建表的方法，Append为添加表到表集合中的方法，使建立的表成为数据库中的一员。FieldObjVar为访问创建字段的对象变量，可用数组表示，因一个表可有多个字段；数值0为第一个字段，字段的索引值从0开始；FieldNName为字段名，FieldType为该字段的类型(如整型、字符型)；FieldLength为该字段的长度。
　　使用Append方法，添加创建的字段到字段集合中，不能省略。例如，单个用户的表和总表

姓名：日期：计算机名：
开始时间：结束时间：上机时间：
数据流量：单价：总费用：



日期： xxxx.xx.xx到 xxxx.xx.xx　
计算机名数据量金额（元）
计算机1xxxxxxxxxx
…　　
计算机nxxxxxxxxxx
总　计xxxxxxxxxxxxxx 

　　除了上面安装的软件外，这台计算机还要在安装Microsoft Internet Information server 2.0 和TCP/IP。


图1
　　ISAM(索引顺序访问方法Indexed Sequential Access Method)用以处理数据库、表、索引、数据类型，JET需要使用ISAM驱动程序。这种计费方法投资少，很适合在中、小企业的使用。
3.4　创建索引
　　数据库中一个表可有一个或多个索引，也可没有索引。主要从事网络设计和管理、计算机应用开发。
作者单位:张　庄　福建省经济信息中心　福建*福州（350003）
收稿日期:1999-02-10
