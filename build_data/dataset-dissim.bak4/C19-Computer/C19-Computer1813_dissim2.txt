微型机与应用
MICROCOMPUTER & ITS APPLICATIONS
2000　No.19　No.1　P.42，45




一种微电机实时测速方法
姜卫东
摘要： 一种新的微电机实时测速方法以及基于这种方法实现的测速设备的设计思想、系统结构及功能。将来题库扩充时也仅需将新题答案依次加在原题库答案之后，而无需改动源程序。程序段为：//时间显示线程
　　public void start()
　　{
　　　　if(time＿thread＝＝null) {
　　　　time＿thread＝new Thread(this)；
　　　　time＿thread．start()；　//开始考试
　　　　}
　　}
　　public void run()　　　//线程运行
　　{
　　　　while(time＿thread。这种方法存在潜在的缺点。其中，答案的记录可通过输出流完成：
　　public void output＿record()
　　{　　try
　　　　{
　　　　answer＿record＿file＝new DataOutputStream(new FileOutputStream(″
　　　　Record．Txt″))；//创建记录文件
　　　　for(i＝1；i＜＝35；i＋＋)
　　　　{
　　　　answer＿record＿file．writeChars(″Right Answer″＋ i＋″Is：″＋ranswer[i]
　　　　＋″＼n″)；
　　　　answer＿record＿file．writeChars(″Your Answer″＋i＋″ Is：″＋answer[i]＋″
　　　　＼n″)； //将答案写入文件
　　　　}
　　　　answer＿record＿file．close()；
　　　　}
　　　　catch (IOException e)
　　　　{　}
　　　　catch (SecurityException se)
　　　　{　}
　　}
2 结束语
　　从上述介绍读者可以看到，采用Internet进行远程考试可以大大缩短考试时间，节省人力物力，具有事半功倍的效果。程序段如下。
1 系统结构及功能
　　针对传统测速系统的缺点，本文提出如下方案：在传统方法的第2步对方波进行一定速率采样，通过接口电路，把采样数据送入计算机，计算机对数据进行处理、分析，得出时间－速度曲线、时间－电流曲线以及有关的参数信息，自动确定微电机质量合格情况，并把相关的信息存入已建立的数据库中，为以后的质量分析提供详尽的数据资源。系统结构如图1所示。系统工作流程如下：
　　微电机通过多功能转换头与微电机转速光电转换器相连接，电机每转动1转则产生1个一定宽度的脉冲，因此，微电机转速光电转换器输出1组与电机转速对应的脉冲串，脉冲串被AD采集卡按给定的速率采集，同时被采集的还有微电机电流，采集的数字量通过接口电路传送到计算机，计算机根据采样速率和每个方波的采样点数计算微电机每1转的转速和与此对应的工作电流，并给出转速时间曲线和电流时间曲线。
1.4 答案的记录与报送
　　若为正式考试，可将考生所选答案和正确答案一同输出保存在文件中，待考试结束后由专人将文件通过Internet传送回考试中心，考试中心审核后再将官方成绩送至各个地区的各个考点。同时，计算机开始读取采集的数据，当满足设定要求（如采集时间控制、采集数据长度控制、微电机稳定转速平稳控制、电流稳定控制等）时计算机停止读取数据，并发送停止信号给光电转换器以断开微电机电源，测量结束。读者可以从中看出这段程序很方便地实现了从题库中随机调取题目的功能。笔者采用了图片式建立题库的方法，这样做的好处在于可以很方便地将大量的书面材料通过扫描仪快速输入计算机，再经过简单的编辑制成图片题库。系统主要完成以下功能：（1）实时测量转速；（2）实时测量电流；（3）可变精度测量；（4）系统的显示、打印、统计、分析等。
2 设计思想
2.1 可变速率AD采集卡
　　AD卡为双通道可变速率采集卡，采集芯片采用多通道复用芯片，以实现对转速方波和电流信号交叉采集（即奇数点采集转速信号，偶数点采集电流信号），这样采集的好处是保证微电机的转速和电流在同一时刻是一一对应的。通道间转换由外部数据指定。由于采集芯片以2通道交叉方式工作，因此采样速率为系统时钟的一半。能不能将考试也移植到Internet上，用网络来完成传统考试繁琐的全过程已成为人们所思考的问题。AD卡的可变采样速率是通过改变时钟频率来实现的；晶体振荡器输出的脉冲通过16进制计数器分频，输出2、4、8、16 4路分频结果，把这4路分频结果与时钟信号输入至模拟开关，模拟开通断情况由寄存器控制，模拟开关的输出与采集芯片的时钟引脚连接。采集卡的结构框图如图2所示。

图2 2路变速率采集卡框图
2.2 接口电路
　　接口电路与采集卡同在1块电路板上，由于采集卡的采集速率不高（不超过30KB／s），接口采样ISA总线，系统采用查询方式通过接口访问缓存。接口电路主要完成地址选择，数据的出入以及发送控制命令。其结构框图如图3所示。

图3 接口电路框图时钟
2.3 软件设计
　　微电机测速系统软件包括5个部分，分别为：系统设置、数据处理、报表统计、打印输出、帮助信息。
　　系统设置：包括采集数据长度设置、采集时间设置、触发方式设置、数据处理结果显示设置、图形显示方式及种类设置等。
　　数据处理：包括对本次测量结果分析和本次前多个测量结果的统计分析，以得出关心的参数（稳定转速、稳定转速方差、前多个测量结果分布图等）。为了适应网上教学的需要，软件设计了2个版本，1个为在线考试版，用于模拟真实考试；另1个为测试练习版，带有答案校验、复习改错功能。如1天或1个月检验情况报表输出。
　　打印输出：完成某1次测量分析结果的参数和图、表输出及报表输出。通过Java的Runnable接口可以很容易地控制考试的全部进程，不仅可以随时知晓考试的时间，而且能做到准时开始，准时结束，没有监考老师也同样能严格把握考试。
　　本文提出的微电机实时测速方法不但克服了传统微电机测速的缺点，而且具有功能完善、结构简单、设备成本低、使用灵活方便等特点。实际应用表明，该设备达到预定技术指标，且大大提高了检验效率。
姜卫东（长沙国防科技大学电子工程学院ATR室410073）
收稿日期：1999－08－27
