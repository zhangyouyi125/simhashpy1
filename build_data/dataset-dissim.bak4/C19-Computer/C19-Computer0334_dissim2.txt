计算机应用
Computer Applications
1999年 第19卷　第8期 Vol.19　No.8 1999



企业网计费系统的设计与实现
张　庄
　　摘　要　本文提出一种投资少、效果好的网络结构和计费方法，并且已经运行。
　　大坝模型、地下厂房模型的建立　大坝和地下厂房的工程图均属于精确的施工图纸，其建模方法类似。


图3　虚拟环境发生程序的结构框图
　　由于大坝模型组成部分众多(如图2所示)，若将全部模型调入，数据量巨大，运行速度慢，视觉感官不甚流畅，所以我们提供了可选择性地调入所需三维模型的功能，用户可根据需要调入模型，例如，用户可只调入大坝的模块，而无须将地下厂房和地形模块调入。
　　解决以上问题最有效的措施是采用计费机制约束入网用户，谁能上网谁不能上网，对每位上网用户详细纪录他们的使用情况，因此用户只有需要时才上Internet，这样才能达到企业网与Internet网连接的真正目的。
2　系统设计原理
　　Internet目前采用TCP/IP协议进行网络通信，在Internet网中的每一台计算机都必须拥有唯一的一个只属于自己的IP作为主机地址，这样所有Internet网上的计算机都可以通过这个IP地址找到这台主机与其通讯交换信息。因此，计费软件只要对每一个这样的IP地址的通讯数据进行统计，就可以得到上网用户使用的准确纪录。
　　一个单位或企业的网络要想与Internet连接，可以采用两种连接方式，第一种方式，根据自己企业网中计算机数向ISP商申请IP，然后给每一台计算机都配置相应的IP，这样这个企业网中的计算机都可以上Internet，这种企业网络结构如图1所示。


图1
　　在图1网络结构中要想实现对每一台计算机进行计费可以有两种方法，第一种将装有计费软件的计算机接到主干线，该计费软件主要特点必须定时到Router中取各个IP包数据，然后把各IP包数据贮放到本机中。
　　d) 矢量化(将图形文件格式转化为等高线数据文件)，将等高线的图形文件转化为坐标的数据文件。它们的区别在于第一种的Router必须要有IP Accounting功能，否则计费软件不能工作。第二种的Router就可以不要 IP Accounting功能，计费软件也可以工作。
2.2　三维建模
　　由于项目并未购买昂贵的SGI工作站建模软件，故我们利用PC机上较常见的Autocad和3DS软件进行建模。但对企业，首先它要对这么多的IP交IP租用费，还有因无限制使用，故数据量很大，费用也大，不能区分出哪个用户使用的情况。第二种方式的计费是在代理服务的作用下对每个允许进入Internet网的用户进行统计然后打印出这些使用者的使用情况，该方式可以限制企业上网的人数，限制上网的功能，例如，只允许用户HTTP、FTP，而不能Oline交谈，Oline游戏。因此，对企业来讲，代理计费方式经济实用，管理和使用都方便。
3　计费系统的实现
3.1　实现的环境
　　图4是一个典型的代理计费网络结构,在该图中,装有计费软件代理服务器这台计算机配置二个100M的网卡，一块要与Router连接，网卡置为正规的IP地址，另一块配企业自己定义的内部IP地址跟企业网的主干线连接。这样这台服务器就象“桥”一样使内部网可以跟外部Internet网接通，所有内部计算机与Internet交换的数据都记录在这台服务器的硬盘中了。
3.2　系统软件的构成和功能
　　在代理服务器这台计算机中需要安装如下软件：
　　. Window NT4.0 Server版操作系统（附加 Pack 3包）。
　　为了便于对上网用户的管理，我们利用NT设置一个用户组，属于这个组的成员都允许它们上Internet，企业网的系统管理员只要对该组的成员进行增加、删除、更改。因此，管理十分方便。最后，将3DS模型数据和材料属性转化成SGI工作站所能使用的SuperView格式文件。
　　代理服务Proxy 2.0把属于允许进入Internet组中的成员“送”到Internet，同时纪录这个成员上网的数据量等其它信息。
　　细线化过程：对目标像素集R，确定骨架像素和R的轮廓像素，然后，移去所有不是骨架的轮廓像素，并且用这样求出的集代替R；重复这一过程，直至剩下仅由骨架像素所组成的集为止。虚拟环境的特征是交互性和浸入性。只要输入三维模型文件，便可生成虚拟现实世界。例如，在可这个数据库中建立一个用户表（Proxyuser），该表是由用户名，用户上网日期，用户上网时间，用户上网数据，目标IP地址等构成，当某个用户上网，Proxy就实时地把相关的数据写到这个表中。
　　. 计费软件（VB5.0开发）。故必须以256灰度方式扫入，经处理后转化成二值图象。针对这种计费的网络结构，我们用VB5.0开发的计费软件可以以多种方式统计出用户上网的数据量和费用。例如，单个用户的表和总表

姓名：日期：计算机名：
开始时间：结束时间：上机时间：
数据流量：单价：总费用：



日期： xxxx.xx.xx到 xxxx.xx.xx　
计算机名数据量金额（元）
计算机1xxxxxxxxxx
…　　
计算机nxxxxxxxxxx
总　计xxxxxxxxxxxxxx 

　　除了上面安装的软件外，这台计算机还要在安装Microsoft Internet Information server 2.0 和TCP/IP。
　　本文介绍了一种与路由器无关的基于代理服务的计费思想，并已在一些单位正式运行，取得了很好效果。这种计费方法投资少，很适合在中、小企业的使用。Performance还支持第三方厂家的数据文件。主要从事网络设计和管理、计算机应用开发。
作者单位:张　庄　福建省经济信息中心　福建*福州（350003）
收稿日期:1999-02-10
