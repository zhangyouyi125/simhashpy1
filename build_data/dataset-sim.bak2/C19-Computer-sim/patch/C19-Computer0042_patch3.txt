计算机应用
Computer Applications
1999年 第19卷 第7期  Vol.19 No.7 1999



集散式能源测控系统的实现
吴　琳　李　锐　谭南邻　韩　松

　　摘　要　本文结合一个卷烟厂电力监控系统的具体实例，说明能源测控系统的整体设计思想与实现方法，详细描述了系统的集散式体系结构，概括了系统通信网络的设计思想和系统可靠性的实现策略。
　　关键词　能源测控,集散系统,体系结构,可靠性

　　典型的卷烟企业是连续制造流程型传统产业，其生产流程耗气和耗水量较大，用量波动也较大，而生产设备对供电质量有越来越高的要求。能源测控系统针对企业的上述情况，从能源站、生产车间到主要设备进行能耗的多级管理，通过对能源的合理调度和主要指标的控制，达到稳定生产工艺、规范管理、节能降耗的效果。
　　根据对能源测控系统用户需求的分析，制定了分散控制、集中操作、分级管理、综合协调的设计原则，它应具有典型集散式系统的体系结构特征。在具体设计中，考虑在线实时检测与控制的可靠性和稳定性，我们运用了工控机与可编程控制器相结合的方式。实际运行的系统效果良好，保障了企业的生产和产品质量创造了显著的效益。
　　对于一个能源测控和管理系统，主要应完成：工业现场各类能源信号的自动采集和转换；重要的能源设备和参数的在线闭环控制；实时数据采集处理和各类统计报表制作；合理的网络结构与层次，提供高效、可靠的数据通道；较好的可扩充性、灵活性和互操作性。VMM和VxDs共同构成了Windows Ring 0层的系统内核。
1　系统的体系结构


　　集散控制系统将计算机技术、控制技术、通讯技术和图形显示技术融为一体，其主要特性是集中管理和分散控制的统一。随着网络技术的成熟，集散控制系统又进一步向着集成管理的方向发展，即实现管控一体化，以适应生产综合自动化的要求。
　　在本系统设计中，考虑能源系统要易于扩展和升级的需求，在集散系统的总体结构上兼具分布式的特征。
五、结束语
　　由于本软件采用windows98系统平台，网络环境设计，所以非常适合于校园网中运行，同时该软件涉及面广，实用价值强，再加上强大的查询功能，友好的人机界面，具备一定的推广价值。
1.1　现场控制级
　　现场控制级是能源测控系统的基础，具体承担现场各类模拟信号、开关信号和脉冲信号的输入、变换、运算和输出。
　　在能源系统中，由于需要处理的数据量大，涉及的信号种类多，因此，在系统构造时采取的是分散和集中处理相结合的设计思想。1#和2#智能工作站处理精度要求较高的电度累计脉冲信号，3#智能工作站单独处理开关量和瞬时模拟信号。两台PLC控制器通过RS485与3#站相连,由PLC控制器实现有载调压功能。该设计在实际应用中取得了非常好的效果，兼顾了系统的可扩展性和可维护性。
1.2　控制管理级
　　能源测控系统中的主要功能如流程显示、控制调节、数据存储、报表打印、报警提示、趋势分析、数据通信、系统维护等均在控制管理级实现，因此该级是测控管理的中心环节，也是系统网络的核心部分。与这些基于类似软件中断的方法相比，基于硬件中断的方法占据了主导地位，并在绝大多数的实时系统中得到了应用，因为它保证了对实时控制系统至关重要的可靠性。工控机A和工控机B在网络中以对等方式运行，其数据一致性策略分为主动刷新和被动刷新两种方式。主动刷新是工控机A（或B）故障后重新启动时，自动拷贝工控机B（或A）的数据库，用B（或A）的数据刷新自己的数据；被动刷新是工控机A（或B）通过邮件槽发送消息，通知对方刷新数据库。目前基于Windows平台的相关产品已经占据了市场份额的90%。
1.3　系统管理级
　　现场控制级和控制管理级实现了能源信号的实时采集、参数与状态的优化控制和集中的操作，而系统管理级则使企业决策者远程了解能源系统的运行状况，查询各级设备状态和能耗数据，从而实施实时指挥调度的中心。
　　系统管理级通过网络接口与全厂的企业内部网相连，成为企业管理信息系统的一个节点，又是全厂CMIS中能源部分的一个基础组成。
2　系统的通信网络
　　通信网络将物理上分散配置的现场控制单元、智能I/O站、控制管理计算机和系统管理计算机通过高速数据线连接起来，构成完整的运行体系，它是集散式能源测控系统的神经中枢。
　　工业测控系统中通信网络主要要求实时性和可靠性，为此，在设计该电力监控系统时，上层网络选用标准以太网（Ethernet），而其底层网络则采用了国际标准中具有更高可靠性的工业现场总线――控制器局域网CAN（Controller Area Network）组网技术。本文将对Ring 0和Ring 3两层软件的设计加以说明。
　　7.团费管理
　　包括季度开户，收支处理，季团费查询，年团费查询。利用Delphi3.0软件开发平台中提供的网络构件，可以很容易地实现这一层的数据通信。实际应用中我们选用的是TCP/IP协议。
　　在集散式系统中，控制管理级和现场控制级之间的数据通信是一个需要认真解决的难题，以往曾采用过RS-485协议和其他总线技术，在工业现场实际运行中其抗干扰能力和数据速率、数据误码率等主要指标均难以满足要求，本系统采用CAN总线技术。CAN是一种多主总线，具有简化的网络结构和开放性、实时性的特点，是一种有效支持分布式控制或实时控制的串行通信网络。在本系统的应用中，着重对其应用层作了必要扩充，具体特点将另文介绍。经过近两年的实际应用证明，它可以为工业控制级的数据通信提供比较有效的运行支持。■
作者单位：张春生(内蒙古民族师院数学系 通辽 028043)
参考文献：
［1］Michael Antonovich著《Visual FoxPro5开发使用手册》机械工业出版社　1997
［2］瓮正科著《FoxPro2.5实用教程》清华大学出版社　1995
［3］Griffith Kadnier著《Windows NT 4使用详解》机械工业出版社　1998
［4］巴亚东　继续教育管理信息系统的设计　《微型电脑应用》　1998年第6期
收稿日期：1999-09-06
。就系统本身的构建而言，最重要的是其可靠性设计。如果一个系统设备维护简单、控制操作自如、应有的功能齐全且灵活方便，管理人员和操作人员对系统有很高的信任度，这样的系统必能有长久的生命力和在生产中充分发挥作用。为了达到这个目标，我们在设计和实施能源系统中主要采取以下可靠性措施。
3.1　数据采集通道的抗干扰措施
　　* 系统中4～20mA的模拟输入信号通过一个低通滤波器，并且采用差分方式输入，以抑制共模干扰噪声；开关信号和脉冲信号则通过光耦或隔离继电器隔离后再输入系统接口。这些消息的处理函数通过以下VxD的实现代码加以说明：
#include<vtoolscp.h>
#include"winioctl.h"
#define DEVICE-CLASS IrqtestDevice
#define IRQTEST-DeviceID UNDEFINED-DEVICE-ID
#define IRQTEST-Init-Order UNDEFINED-INIT-ORDER
#define IRQTEST-Major　1
#define IRQTEST-Minor　0
#define w32IF-PASS-EVENT CTL-CODE
(FILE-DEVICE-UNKNOWN, 1,METHOD-NEITHER,FILE-ANY-ACCESS)
#define RTC-IRQ8//实时时钟使用的IRQ
#define STATREG-A 0xA
#define STATREG-B 0xB
#define STATREG-C 0xC
#defing ENABLE-INTERRUPT 0x40
#define WM-MY-MESSAGE 0x0410//自定义消息
BOOL -stdcall RTCInt-Handler(VMHANDLE hVM,IRQHANDLE hIRQ);//时钟中断服务程序
VOID WriteCMOS(BYTE reg,BYTE value);
BYTE ReadCMOS(BYTE reg);
class IrqtestDevice:public VDevice｛
prblic;
virtual BOOL OnSysDynamicDeviceInit();
virtual BOOL OnSysDynamicDeviceExit();
virtual DWORD OnW32DeviceIoControl(PIOCTLPARAMS pDIOCParams);｝;
class IrqtestVM:public VVirtualMachine｛
public;
IrqtestVM(VMHANDLE hVM);｝;
class IrqtestThread:public VThread｛
public:
IrqtestThread(THREADHANDLE hThread);｝;
//IRQTEST.cpp-main module for VxD IRQTEST
#define DEVICE-MAIN
#include"irqtest.h"
#undefDEVICE-MAIn
Declare-Virtual-Device(IRQTEST)
VPICD-HWInt-THUNK RTCInt-Thunk;handler//中断Thunk
EVENTHANDLE hEvent;//Handle of timer event
IRQHANDLE RTCIRQHandle；//Handle for virtual IRQ
BYTE SavedStatusRegisterA;
BYTE SavedStatusRegisterB;//保存RTC设置寄存器
DWORD TickCounter;//中断计数器
DWORD*PostMsghWnd;//Ring3层应用程序的hWnd
HANDLE hWnd;
IrqtestVM::IrqtestVM(VMHANDLE hVM)
VVirtualMachine(hVM)｛｝
IrqtestThread::IrqtestThread(THREADHANDLE hThread)
VThread(hThread)｛｝
BOOL IrqtestDevice::OnSyaDynamicDeviceInit()｛
VMHANDLE hVM;
hVM=Get-Cur-VM-Handle();
BYTE statreg;
DWORD status;
DWORD RTClockFreqIndex;
//挂接硬件中断需要调用虚拟可编程中断控制器(VPICD)来通知Windows此VxD负责处理此IRQ。此外，在当今的计算机控制领域中，控制软件是否基于Windows平台已经成为产品是否有竞争力的重要标准之一［1］。
3.2　供电系统的净化
　　能源测控系统使用不间断的，独立的供电系统，设置可切换的双稳压电源，其中一台工作，另一台备用。选用有高频滤波、稳压、隔离、无触点切换等措施的UPS，以确保在外围电网有事故发生瞬间系统仍能有效地监测。
3.3　提高系统级可靠性
　　在集散式测控系统中，各单元部件的高可靠性是整个系统可靠性的前提，但是如果只注重单元的可靠性是不够的，必须采用系统工程的方法，从整个系统的角度进行可靠性分析和设计。我们在该系统中采用多级的冗余与容错措施，取得了明显效果。
　　现场控制级，智能工作站1# 和2# 同时采集功率变送器输出的脉冲信号，即使其中一台工作站出现故障，另一台仍能保证累计数据的准确不丢失。
　　同理，在控制管理级采用了双机热备份系统，两台工控机执行相同的程序从现场控制级读取数据，最上层的系统管理级只需从其中一台工控机采数，若提供数据的工控机发生故障，则切换到另一台工控机采数。双机在工作过程中，定时比较本地硬盘与网络硬盘上参数文件的时标，并以最新时标的文件覆盖本地硬盘上的文件。这样控制管理级的双工控机就能保持所采集的各种电量参数的一致性。
　　综上所述，将集散式体系结构具体应用在能源测控与管理系统的设计与构建，它使该系统在各层次上形成开放系统，实现了企业能源的集中管理、准确计量和合理调度，它将为保障企业生产运行，稳定产品质量产生显著的效益和长远的影响。
　　吴　琳　工程师。从事工业控制和计算机应用开发工作。
　　2.系团委数据录入
　　该模块完成各系团组织数据录入，修改等，包括：系团总支机构，各系各班团支部信息，系学生会，系级社团，系志愿者服务队，系团总支获奖情况。
　　4.院团委信息查询
　　针对于院团委各项信息(第1项)的各种信息查询。
　　例如：组成分工查询，院团校查询，文件目录查询，获奖情况查询，人才库查询，院学生会查询，社会实践团体查询，志愿者服务队查询等