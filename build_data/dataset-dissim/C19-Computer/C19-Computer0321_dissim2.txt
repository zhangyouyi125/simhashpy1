计算机应用
Computer Applications
1999年 第19卷 第7期  Vol.19 No.7 1999



交换式以太网数据采集和分析软件
刘　莉　叶高英

　　摘　要　交换式以太网数据采集系统以交换式、高速、宽带以太网为基础,CAMAC系统直接与网络接口，避免了为单个计算机系统重写CAMAC驱动程序，保证了网络上CAMAC系统和主机之间较高的数据传输率。利用其中的数据采集和分析软件，用户不必写任何代码就可以建立一个完整的数据采集通道，获取并处理数据。
　　关键词　DAS, CAMAC, 交换式,以太网

　　目前，在聚变领域用于实验的数据采集系统(DAS)几乎都是分布式系统。这些系统［1,2,3,4,5］主要由计算机和瞬态记录器（通常为CAMAC系统）组成，CAMAC系统按层次原则设计,并分别与各计算机接口连接，各计算机连接组成局域网络。这样的系统结构使从CAMAC系统传输数据到一台计算机成为DAS的瓶颈；驱动CAMAC系统的软件依赖于特定的计算机系统。由于需要为新的计算机系统重写CAMAC驱动程序，系统升级非常困难；分布式分量越多，合并实验数据到一个统一的数据记录文件就越困难。
　　交换式以太网数据采集系统（TDAS）［6］即是为克服这些困难而研制的。它采用以太网CAMAC控制器ECC 1365 MK Ⅲ作为CAMAC系统与网络之间的接口设备，选用网络交换机Link Switch 1000 作为以太网连接设备，其系统结构如图1所示。　　


图1　交换式以太网数据采集系统
　　这样的系统结构较之以往的分布式数据采集系统有了质的提高：建立了高速交换式以太网，保证了网络上CAMAC 系统和主机之间较高的数据传输率；CAMAC机箱直接连到网络上，避免了麻烦的专用CAMAC计算机接口及驱动问题，永久地消除了CAMAC系统对特定的计算机系统的依赖性。
　　TDAS的数据采集和分析软件以模块数据系统MDS［7］为基础，结合交换式以太网数据采集系统的新特点进行了某些部分的重新设计和修改，主要集中在标准CAMAC模块的驱动程序、关于CAMAC模块操作的命令等。该软件系统运行在VAX/VMS操作系统中，由数据采集、驱动软件、绘图、数据管理等模块组成，很多应用环境作为DCL（Digital Command Language） 命令执行，很象VMS操作系统的一部分，非常容易使用，用户不必写任何代码，就可以建立一个包括数据采集、分析、显示的完整诊断数据采集通道。下面介绍其中主要的子系统。由于我们构造发型所用的弯曲体纹理都是四棱的,所以,头发造型的第1项工作便是头皮的四边化。其中，ESONE/DOE是以太网CAMAC控制器ECC 1365 MK Ⅲ提供的CAMAC子程序，用于访问ECC 1365模块，执行管理CAMAC模块的操作；，而CAMAC模块驱动程序即是调用ESONE/DOE子程序对CAMAC模块(包括CAMAC 硬件模块和非CAMAC 软件模块)进行初始化、存储等操作；CSV环境用于模块采集频率、通道名称等信息的设置，供初始化、存储模块所用；scanner负责在共享程序中寻找相应的模块支持子程序，并执行相应的初始化或存储动作；所有数据的存储借用MDS提供的数据库；利用IDL和PCL访问、分析和显示MDS数据库中的数据。


图2　TDAS的数据采集和分析软件系统结构
1．1　模块驱动软件
　　TDAS的数据采集和分析软件系统中包括CAMAC 硬件模块和软件模块，驱动它们的程序都由三个子程序组成：“设置”子程序,提供显示用户交互输入采集频率、通道名称等信息的格式，由TDMS格式包支持；“初始化”子程序，负责解释“设置”子程序中记录的信息，并执行合适的初始化模块的功能；“存储”子程序，数字化结束后从模块存储中取回数据。
Key words　Texel,volumetric texture,Bézier curve,Bézier volume,subdivision。
　　以L8212 CAMAC模块为例，典型的驱动子程序结构如图3所示。用FORTRAN语言编写的L8212初始化、存储、设置子程序的代码加起来不足300条语句，相比于CAMAC机箱与计算机系统直接相连，驱动CAMAC模块的程序代码要短得多。况且，无论该数据采集和分析软件系统移植到什么样的计算机系统，驱动CAMAC模块的程序代码都不必重写。　　


图3　L8212模块驱动程序

1．2　数据采集
　　模块逻辑名　在TDAS的数据采集和分析软件系统中，所有模块是由VMS的逻辑名表示的。VMS所提供的逻辑名服务把一个名字与CAMAC模块的站号、机箱号联系起来。采用这种方法可以在系统中分配模块到任何位置，而在数据采集和分析软件系统中不必修改任何模块。现在使用的插值只是在方阵中各四边形顶点的头发始向间进行的（如图3所示）,而各棱线的造型利用的是如图2所示的模型,由于所有头发使用同一模型和相同的缩放变换,所以弯曲体纹理的整体分布的均匀性、连续性以及必要的分布断续性（如头发的分界线）得以保持。Annjyo［12］,Rosenblum［13］和Shih［14］应用力学原理描述每根头发的形状。虽然绘制时间的开销较大,但这种方法产生了最有说服力的毛绒物体图形。
　　CSVSCAN环境　当发出一个CSVSCAN命令时，扫描器就开始工作。从一个初始化过程开始，读scan表中的每个记录，以用户为表中的每个入口定义的“init”时序号为顺序。对表中每个记录，调用该记录中模块对应的“init”子程序，并传递设置信息到“init”子程序。当初始化过程完成后，执行存储过程，调用“store”子程序。重复上述过程完成多通道大规模采集任务。
1．3　数据存储
　　所有采集到的数据都存储在MDS提供的数据库中，该数据库包括数据库定义文件、放电序号确认文件和数据文件集合。我们的任务是，将每个组的四边形排列成一个矩形阵列或者一个二维数组,使得数组各元素的排列关系等同于几何邻接关系,同时也将头皮组中所有顶点按几何关系重新组织。一个数据库中的数据由三条信息确认：放电序号、数据项名称和位于数据库哪一级。
　　在本系统中我们定义了一个名为HL1M的数据库，所采集的数据都存入该数据库中。Then the head surface is processed and converted to a polyhedron of quadrilaterals of neighboring relationships,and the simple modeling method is modified and developed with interpolation method。MDS提供的接口软件使IDL可直接进入MDS数据库交互地操作和显示数据，在大多数情况下不必写数据分析子程序。GP4是一个图形库，可以为大量的绘图设备提供有效的图形输出。 PCL（Plot Command Language）环境即是使用GP4为图解数据库中的数据提供的一个简单的显示工具。可用的绘图设备包括VT125、VT240、VT241、VT640、TK终端等。
陈彦云，1971年生，博士生，主要研究领域为真实感图形生成。所有这些子程序遵从VMS子程序调用标准，只要坚持该标准，用户可用任何编程语言书写分析程序。排列方法如下：
　　(1) 将每一个顶点中使用它的所有四边形的序号记录在这个顶点中（称这个顶点包含这些四边形）；
　　(2) 找出一个组中所有四边形所用到的所有顶点,记录在该组中；
　　(3) 对于任意一个给定的组而言,判断每一个顶点包含的所有四边形中有几个在该组中,因而决定出位于该组的顶点在组中处于组的角部、边部和内部,把这个位置信息记录在所有顶点中,角点共有4个；
　　(4) 由任意一个角点所包含的那个四边形出发,不断寻找一个方向上的下一个四边形,直到遇到一个顶四边形（即包括角点的四边形）为止,这样就得到一行四边形,并且记下这行的四边形数目；
　　(5) 重复第4部分,只要每1行的四边形数目与第1行相同,因而得到一个四边形阵列,除非这个组中的四边形在几何上并没有构成方形阵列,然后记录下四边形阵列信息；
　　(6) 利用四边形阵列,将这个组的所有顶点也排成阵列,记录下顶点阵列信息。其数据采集和分析软件系统有以下特点：用户可以通过产生包括他自己的模块支持子程序的更多的共享程序增加新模块到该数据采集和分析软件系统中；提供一套包括数据采集、分析和显示的完整工具，最大限度地减少了用户所要做的工作；许多应用环境作为DCL命令执行，很象是VMS操作系统的一部分，对于已经熟悉VMS操作系统的用户来说，可以大大缩短学习周期。
　　刘　莉　硕士研究生。因此,发型的制作方法是：将头皮分成多个块,每块头皮上的所有头发具有近似的形状；对于普通长型头发来说,不同块的边沿处的头发具有近似的形状,而对于普通烫型头发来说,不同块的边沿处的头发具有差异明显的形状