计算机应用
Computer Applications
1999年 第19卷　第8期 Vol.19　No.8 1999



企业网计费系统的设计与实现
张　庄
　　摘　要　本文提出一种投资少、效果好的网络结构和计费方法，并且已经运行。
　　关键词　网络结构，网络连接
1　引言
　　随着Internet的普及，越来越多的单位或企业纷纷将自己的企业网与Internet网连接，这样就给企业网络管理带来了许多问题：安全问题，配置管理，计费管理等。而对于企业来讲，计费管理是尤为重要的，因为，目前单位或企业要想进入Internet都是向电信局租用X.25或DDN专线入网,其有效带宽从9600-128K不等，并且带宽越宽租用费越贵，还有如果让人们无限制地访问Internet必造成以下问题：
　　企业网出口拥挤，数据传送速度变慢；
　　使急需访问Internet用户得不到保障；
　　费用大量增加。
　　解决以上问题最有效的措施是采用计费机制约束入网用户，谁能上网谁不能上网，对每位上网用户详细纪录他们的使用情况，因此用户只有需要时才上Internet，这样才能达到企业网与Internet网连接的真正目的。
2　系统设计原理
　　Internet目前采用TCP/IP协议进行网络通信，在Internet网中的每一台计算机都必须拥有唯一的一个只属于自己的IP作为主机地址，这样所有Internet网上的计算机都可以通过这个IP地址找到这台主机与其通讯交换信息。因此，计费软件只要对每一个这样的IP地址的通讯数据进行统计，就可以得到上网用户使用的准确纪录。
　　一个单位或企业的网络要想与Internet连接，可以采用两种连接方式，第一种方式，根据自己企业网中计算机数向ISP商申请IP，然后给每一台计算机都配置相应的IP，这样这个企业网中的计算机都可以上Internet，这种企业网络结构如图1所示。
3.5　创建记录集
　　多数情况下，操作数据库时不外乎是记录的插入、删除与修改，因此在数据库、表、字段及索引等诸对象建立完毕后，最后要创建记录集对象。
　　使用Append方法，添加创建的字段到字段集合中，不能省略。它们的区别在于第一种的Router必须要有IP Accounting功能，否则计费软件不能工作。


图1
　　ISAM(索引顺序访问方法Indexed Sequential Access Method)用以处理数据库、表、索引、数据类型，JET需要使用ISAM驱动程序。
　　第二种连接方式，向ISP商申请2个IP采用代理服务的方法，企业网的所有计算机都用自己定义的内部IP地址，当内部网的计算机想上Internet时，必须通过代理服务方式把内部IP转成正规的IP然后进入Inernet，如图4：


图4
　　在以上两种方式（图1、图4）中，第一种计费是对每台计算机的IP进行统计然后打印出各台计算机使用的情况，对使用者来讲所有Internet功能都能实现，没有限制。但对企业，首先它要对这么多的IP交IP租用费，还有因无限制使用，故数据量很大，费用也大，不能区分出哪个用户使用的情况。第二种方式的计费是在代理服务的作用下对每个允许进入Internet网的用户进行统计然后打印出这些使用者的使用情况，该方式可以限制企业上网的人数，限制上网的功能，例如，只允许用户HTTP、FTP，而不能Oline交谈，Oline游戏。
Dim TableObjVar As TableDef
′定义表对象变量
Set TableObjVar=DataBaseObjVar.CreateTableDef(TableName)
′创建表，并赋给表对象变量
DatabaseObjVar.TableDefs.Append TableObjVar 
′将表添加到表集合中
　　TableObjVar为访问创建表的对象变量，TableName为创建的表名，TableDef为表对象，CreateTableDef为创建表的方法，Append为添加表到表集合中的方法，使建立的表成为数据库中的一员。
　　此外，在CreateDatabase方法中，还包含有多个参数，如版本信息、国别、口令、是否加密等，多数情况下可省略，联机帮助有详细介绍。下面的语句用于创建第一个字段(索引为0)。
3.2　系统软件的构成和功能
　　在代理服务器这台计算机中需要安装如下软件：
　　. Window NT4.0 Server版操作系统（附加 Pack 3包）。
　　为了便于对上网用户的管理，我们利用NT设置一个用户组，属于这个组的成员都允许它们上Internet，企业网的系统管理员只要对该组的成员进行增加、删除、更改。因此，管理十分方便。
　　此外，在CreateDatabase方法中，还包含有多个参数，如版本信息、国别、口令、是否加密等，多数情况下可省略，联机帮助有详细介绍。
　　代理服务Proxy 2.0把属于允许进入Internet组中的成员“送”到Internet，同时纪录这个成员上网的数据量等其它信息。Proxy 2.0还可以限制用户上网的功能，例如，企业只允许它们的员工游览Internet（即HTTP）不能Oline聊天（或游戏），那末它可以通过Proxy 2.0的设置定义用户只能HTTP，这样帮助企业减少许多无用数据，节约了开支。
　　. SQL Server 6.5数据库服务软件。创建索引时，包括索引对象变量，设置主索引及唯一性，创建索引的字段，最后将索引字段和索引分别添加到字段集合和索引集合中。例如，在可这个数据库中建立一个用户表（Proxyuser），该表是由用户名，用户上网日期，用户上网时间，用户上网数据，目标IP地址等构成，当某个用户上网，Proxy就实时地把相关的数据写到这个表中。
　　. 计费软件（VB5.0开发）。
　　程序设计语言Visual Basic 5.0是一种功能非常完善的嵌入式智能工具，它能使你的编程工作取得事半功倍的效果，特别是VB 5.0的数据访问可以使用户的程序十分轻松方便地读取SQL Server 6.5数据库中的数据。针对这种计费的网络结构，我们用VB5.0开发的计费软件可以以多种方式统计出用户上网的数据量和费用。例如，单个用户的表和总表

姓名：日期：计算机名：
开始时间：结束时间：上机时间：
数据流量：单价：总费用：



日期： xxxx.xx.xx到 xxxx.xx.xx　
计算机名数据量金额（元）
计算机1xxxxxxxxxx
…　　
计算机nxxxxxxxxxx
总　计xxxxxxxxxxxxxx 

　　除了上面安装的软件外，这台计算机还要在安装Microsoft Internet Information server 2.0 和TCP/IP。
　　使用Inedx对象的CreateField方法所建立的索引字段，必须是TableDef对象中已存在的字段。这种计费方法投资少，很适合在中、小企业的使用。 
作者简介:张　庄　高级工程师。FieldObjVar为访问创建字段的对象变量，可用数组表示，因一个表可有多个字段；数值0为第一个字段，字段的索引值从0开始；FieldNName为字段名，FieldType为该字段的类型(如整型、字符型)；FieldLength为该字段的长度。
作者单位:张　庄　福建省经济信息中心　福建*福州（350003）
收稿日期:1999-02-10
