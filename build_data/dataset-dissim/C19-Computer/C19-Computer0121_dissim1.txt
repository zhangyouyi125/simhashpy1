计算机工程
Computer Engineering
1999年　第25卷　第9期　Vol.25 No.9  1999



并行光线跟踪中的数据划分策略
刘　敏　董玉宇　张延国　胡正国
　　摘　要：提出了一种新的场景数据分割方法，以待计算的象素点来决定场景数据的有效分割，克服了以往盲目分割数据所带来的光线在处理机间的频繁交换，从而减小了通信开销．
　　关键词：并行光线跟踪；并行效率；数据分割
Data Partition Strategy for Parallel Ray Tracing
Liu Min Dong Yuyu Zhang Yanyuan Hu Zhengguo
(Software Engineering Center, Northwestern Polytechnical University, Xi＇an 710072)
　　Abstract　For the purpose of improving the efficiency of parallel ray tracing, the authors proposed a new strategy for scene data distribution according to the traced pixel. This method lowered the frequency of data exchanges between processors, and then reducced communication overhead.
　　Key words　Parallel ray tracing; Parallel efficiency; Data partition
　　光线跟踪作为一种真实感图形的绘制技术，能够生成传统图形学算法难以模拟的整体光照明效果，而且算法简单，易于实现。由于上载的文件数据量大，因而在FORM的标记中，METHOD为POST，而不是GET。80年代中期，随着并行处理技术的飞速发展，无论从软件还是从硬件上都为图形生成的并行处理技术提供了强有力的支持。光线跟踪算法的并行化就是并行处理与真实感图形生成这两项技术相结合的产物。
　　MathML 有3种类型标记：①表达标记描述了数学符号结构，如<mrow> …</mrow>标记，表示其中的字符串是水平显示。因此其研究重点在于如何优化象素点、场景数据在并行机各节点上的分配策略，以大幅度提高并行效率。它提供一个Browse按钮和一个文本编辑框，通过Browse按钮查找到所要上载的文件，把文件名及其路径显示在文本编辑框中，也可手工输入文件名及其路径(URL)。
　　Didier与Kadi等人于1994年提出的面向控制的并行光线跟踪算法中，描述场景空间的数据仅被均衡地分配给所有的处理机，而无其它特殊约束条件。这样，当某处理机所要访问的数据不在本机的局存上时，就必须远程访问存于其它处理机上的数据。Didier虽然引入了Cache机制以减少远程访问的代价，但还是存在着一个明显的缺陷，即数据分割的盲目性。如果分割得不好，在极端条件下，可能会造成严重的抖动现象：处理机之间频繁地交换数据，长时间得不到稳定。这就增大了系统的通信开销。
　　本文通过研究待计算的象素点与所需场景数据之间的内在关系，采用一种新的数据划分策略，它确保一处理机处理的光线要么一定落在本处理机局存中的场景数据所覆盖的子空间中，要么射出场景空间。
1　新的数据划分策略
　　图1展示了待计算的象素点与场景数据之间的空间关系。

图1　待计算象素点与场景数据的空间关系

图2　场景空间的层状分割
　　显而易见，由视点发出的第一级光线经过屏幕阴影区中任意一象素点投射入世界坐标系空间中，只有两种可能，要么落在场景空间中的阴影带上，要么射出场景空间。这里可以有两个结论：
　　(1)是光线连续的特性：从视点射出的两根光线，当穿过屏幕上两个相邻的象素点时，将很可能与场景中同一物体相交。
　　(2)如某处理机具有屏幕中阴影带象素点的计算量，在其局存中，就必须拥有场景空间中阴影带所属的那层场景数据空间来支持象素点的光线跟踪计算。
由此，可得到这一数据划分策略：将屏幕象素点与场景空间依第二个结论所述的对应关系进行层状分割，然后把各个层顺序分配给各处理机。
　　在实际应用中，视点、屏幕及场景空间三者的相对位置关系并不象图1所示的那样有规律。视点可以位于世界坐标系中的任意一点，屏幕位置和方位也是任意的。一般为了具有实际价值，屏幕位于视点的正前方。因此，同一场景仅因视点位置的不同而在屏幕上呈现不同的画面。如果浏览器收到某一插件支持的MIME类型文件，它就加载此插件并将这个文件交给该插件处理，当离开该页面或关闭该浏览器窗口时，就结束该插件的运行。本文为了便于场景空间的层状分割，场景空间的外壳方位将随视点位置的不同而不同。其次，图片在浏览器上显示时，其下载速度相对文字要慢很多，占用更多的网络资源，较长时间的等待对用户有时是难以容忍的。这时，视点、屏幕及场景空间2的相对位置关系就与图1相同，可以方便地对场景空间进行层状分割。
　　这时，可具体地实现前述的数据划分策略∶先对屏幕象素点以行为单位进行条形划分，视参与并行处理的处理机数n把屏幕划分成n份，自上而下依次把象素点集分配给顺序编号的处理机。在Web 页面上显示时与背景和上下文很难溶为一体，欠美观。如果浏览器收到某一插件支持的MIME类型文件，它就加载此插件并将这个文件交给该插件处理，当离开该页面或关闭该浏览器窗口时，就结束该插件的运行。这样处理场景数据分割与分配，使得本机上分配的象素点射出的一级光线在进行计算时所需访问的数据一定存于本机的局存中，可以进行局部访问，而非远程访问。
　　(3)插件只能解决公式的表示，当遇到数学图表或物理化学图表时，插件也无能为力，只能借助图片的方式。
　　虽然MathML也能用插件方式实现，但不如使用HTML中本身就有的插件标记方便，最好的实现方式是结合在浏览器内部实现，成为HTML的一部分。但必须对自然语言加以规范，使得它明确、易懂、简洁，并且不产生歧义，有一定的语法规则，易于计算机程序的实现。如果抛开处理机的其他硬、软件，只考虑其上存储的场景子空间的话，将这些处理机按其编号顺序层叠起来，就构成了整个场景空间。因此：
　　(1)当光线射出第i号处理机数据空间的上表面时，该光线要么射出整个场景空间（对于第1号处理机而言），要么进入第i-1号处理机中所存储的那部分场景数据空间；
　　(2)当光线射出第i号处理机数据空间的下表面时，则要么射出整个场景空间（对于第n号处理机而言），要么进入第i+1号处理机中所存储的那部分场景数据空间；
　　(3)当光线射出本处理机上场景数据空间的其他表面时（如前、后、左、右表面），则一定是射出场景空间了。
根据以上3点，当派生光线射出场景数据空间时，将此光线传递给哪个处理机继续跟踪这一问题便迎刃而解了。
2　结束语
　　本文提出的场景数据划分策略是在研究了待计算的象素点与所需场景数据之间的内在关系的基础上提出来的，它克服了以往盲目分割场景数据所带来的光线在处理机之间的频繁交换，减小了并行光线跟踪算法中的通信开销。这一策略应用在一些简单的并行图形处理系统中，效果很好。但由于系统还不成熟，还可以进一步改进它对不同拓扑结构的并行计算机的适应能力，这样，它的通用性将会得到提高。
作者简介：刘　敏(1970～)，女，讲师，主要研究方向：并行处理、软件工程
作者单位：西北工业大学软件工程中心，西安　710072
参考文献
1 Didier B. Distributing Data and Control for Ray Racing in Parallel. IEEE CG&A, 1994, (7):69-77
2 Chuang Junghong. A New Space Subdivision for Ray Tracing CSG Solids. IEEE CG&A , 1995, (11):56-62
3 Scott W. Recent Developments in Parallel Rendering. IEEE CG& A, 1994,(7):21-22
收稿日期：1998-12-15
