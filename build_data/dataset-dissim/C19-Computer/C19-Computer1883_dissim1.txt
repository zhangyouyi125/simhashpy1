微型机与应用
MICROCOMPUTER & ITS APPLICATIONS
2000　Vol.19　No.4　P.21-23



基于单片机控制的高精度电缆自动测试仪
于秋瑛 顾炳永 于国桥 程春耕 段雪松 王然伟
摘 要： 一种基于单片机控制的高精度电缆自动测试仪。该测试仪能实现多芯电缆的绝缘电阻值、芯线电阻值和分布电容值的自动检测。PPLD产生4个中断，可以由用户定义，从端口D输入；其它4个中断由计数器／定时器终止计数标志产生。我们采用8031单片机、继电器分组和隔离技术、先进的抗干扰技术、先进的数值快速线性化技术及独特的预充电技术，研制了一种新型电缆自动测试仪。
1　系统主要功能及测量理
　　本系统可对少于198芯的多芯电缆进行芯线电阻、芯线间绝缘电阻及芯线间分布电容值的快速自动检测，在0.5～2s内完成单线测试；能准确地测出电缆芯线的断点和短路位置，并能对不合格的测试结果进行保存和查询；操作使用方便，更换测试档位及量程时，无需任何人工校准。
1．4 可编程逻辑PLD
　　PSD5XX系列的核心是能执行以下功能的ZPLD：
　　（1）译码ZPLDDPLD，执行对内部I／O、外围芯片、4个EPROM块、SRAM和端口A外围模式的地址空间译码；
　　（2）通用功能ZPLDGPLD，用来实现状态机和其它一般逻辑，具有多达61个输入，118个乘积项，连接到端口A、B、E的24根I／O引脚。测试中，给被测电缆施加电压、产生电流，由采样电阻把信号取出，再经过放大、线性化、模数转换，经串行口送给单片机进行数据处理，最后由单片机把处理结果送显示和控制。
　　1．标准I／O模式
　　此模式为单片机提供附加的I／O功能，本例中，将端口A、B构造成标准I／O口，构造方法如下：
　　（1）在ABEL文件中命名用作I／O引脚或信号；
　　（2）将控制寄存器相应位置为“1”；
　　（3）如作为输入端口，设置方向寄存器为输入模式，从数据输入寄存器读数据；
　　（4）如作为输出端口，设置方向寄存器为输出模式，将数据写到数据输出寄存器。
2　系统硬件结构设计
　　本系统硬件由控制器、测试电路、继电器、转换矩阵、面板显示和操作电路及电源等部分组成。其原理框图如图1所示。

图1　系统硬件原理图
2.1　控制器
　　控制器由CPU、EPROM、EEPROM、SRM、缓冲器、光电耦合器及WDT组成。CPU为8031，完成本测试仪的控制和计算。27C256为32KB EPROM，完成程序的存储。2864为8KB EEPROM，完成预置参数的存储，并能使在起启电时参数复现。6264为8KB SRAM，作为外部存储器。4251芯片作为CPU监视定时器（WDT），CPU每隔0.1s将WDT清1次零，当程序出错或死循环时，WDT在0.125s将CPU复位，程序从头开始。以上器件以8031为中心组成系统，是整个测试仪的控制中心。
2.2　测试电路
　　测试电路由高输入阻抗、高精度的运算放大器和12位积分模数转换器组成，完成高精度测量。由采样电路、放大电路、线性化电路和模数转换电路组成绝缘测试电路和通路测试电路。具体的ABEL文件如下：MODULE 80C196KCTITLE “example of 80C196KC using PLD5XX”A15，A14，A13，A12，A11，A10，A9，A8 PIN；Pgr3，Pgr1，Pgr2，Pgr0 NODE；CSIOP，RS0，ES0，ES1，ES2 NODE；BUSWIDTH，READY，RESET＿OUT，CSOUT PIN 30，31，33，36；RESET＿IN PIN；X ＝．X．；PE＝Pgr3，Pgr1，Pgr2，Pgr0；ADDRESS＝A15，AAG14，A13，A12，A11，A10，A9，A8，X，X，X，X，X，X，X，X，；EQUATIONSCSIOP＝ADDRESS＞＝＾HD000＆ADDRESS＜＝＾HD0FF；RS0＝ADDRESS＞＝＾H8000＆ADDRESS＜＝＾H87FF；ES0＝ADDRESS＞＝＾H0000＆ADDRESS＜＝＾H7FFF＆PAGE＝＝0；ES1＝ADDRESS＞＝＾H0000＆ADDRESS＜＝＾H7FFF＆PAGE＝＝1；ES2＝ADDRESS＞＝＾H0000＆ADDRESS＜＝＾H7FFF＆PAGE＝＝2；CSOUT＝ADDRESS＞＝＾HC000＆ADDRESS＜＝＾HCFFFBUSWIDTH＝CSIOP＋RS0；READY＝RS0；RESET＿OUT＝RESET＿IN；END 80C196KC；上述文件经过仿真、编译后，即可用PSDsoft软件生成的目标文件对PSD5XX芯片编程，从而完成PSD5XX芯片的最后设计。调试时，可以不改变电路板而直接通过软件配置进行现场编程，修改极为方便。继电器为双触点继电器，用50只继电器能转接100根芯线到测试电路，其中“00”号芯线为标校用接线柱，这样实际能转接99根芯线。将继电器触点分成20组，每组有5只继电器触点并联在测试回路中，减少了测试误差。通过中间插入21只隔离继电器，解决了连接和隔离问题，保证了测试电路的高绝缘状态。
2.4　显示电路
　　显示电路由2只MAX7219集成块、14只LED数码管和8只LED指示灯组成。MAX7219为串行接口8位数字LED显示驱动器，每只MAX7219带7只LED数码管和4只LED指示灯，2只MAX7219串联，串行送数据。CPU 8031通过串行口，每隔0.1s给NAX7219的RAM存储器送显示数据，MAX7219根据初始化的要求，将RAM中的数据自动扫描显示。
2.5　操作电路
　　操作电路由1只74LS165和8只薄膜按钮开关组成。为此要求用户：在应用软件中对某些端口构造寄存器进行初始化；在PSDsoft软件中构造PSD5XX，并把未用的输入引脚拉到VCC或GND。74LS165随时将8只薄膜按钮开关的状态存储起来。CPU 8031通过串行口，每隔0.1s取1次按钮开关的状态数据并及时进行处理，同时把结果送显示或输出相应的控制信号。
3　系统软件
　　本系统软件用MCS-51汇编语言生成，采用模块化结构和子程序嵌套技术，可节省内存，便于程序的编制、修改、扩充和联调。整套程序由主程序、25个子程序和2个中断服务程序构成，共2500条指令。下面介绍几个比较重要的程序模块。
3.1　主程序
　　主程序框图如图2所示。主要完成初始化和0.1s环检查。另外，页面逻辑连接到ZPLD零功率PLD，便能够扩展具有有限地址空间的单片机的地址空间，最大可扩展到16个页面。具体的ABEL文件如下：MODULE 80C196KCTITLE “example of 80C196KC using PLD5XX”A15，A14，A13，A12，A11，A10，A9，A8 PIN；Pgr3，Pgr1，Pgr2，Pgr0 NODE；CSIOP，RS0，ES0，ES1，ES2 NODE；BUSWIDTH，READY，RESET＿OUT，CSOUT PIN 30，31，33，36；RESET＿IN PIN；X ＝．X．；PE＝Pgr3，Pgr1，Pgr2，Pgr0；ADDRESS＝A15，AAG14，A13，A12，A11，A10，A9，A8，X，X，X，X，X，X，X，X，；EQUATIONSCSIOP＝ADDRESS＞＝＾HD000＆ADDRESS＜＝＾HD0FF；RS0＝ADDRESS＞＝＾H8000＆ADDRESS＜＝＾H87FF；ES0＝ADDRESS＞＝＾H0000＆ADDRESS＜＝＾H7FFF＆PAGE＝＝0；ES1＝ADDRESS＞＝＾H0000＆ADDRESS＜＝＾H7FFF＆PAGE＝＝1；ES2＝ADDRESS＞＝＾H0000＆ADDRESS＜＝＾H7FFF＆PAGE＝＝2；CSOUT＝ADDRESS＞＝＾HC000＆ADDRESS＜＝＾HCFFFBUSWIDTH＝CSIOP＋RS0；READY＝RS0；RESET＿OUT＝RESET＿IN；END 80C196KC；上述文件经过仿真、编译后，即可用PSDsoft软件生成的目标文件对PSD5XX芯片编程，从而完成PSD5XX芯片的最后设计。从EEPROM取出断电前存储的数据，送到有关寄存器。对7219显示驱动器初始化，送显示初始值。定时器T0初始化，开T0和串行口中断，然后进入循环查询计数器1是否为0.1s。如果有干扰使程序出错，进入循环后WDT将CPU复位，则程序从头开始。为此要求用户：在应用软件中对某些端口构造寄存器进行初始化；在PSDsoft软件中构造PSD5XX，并把未用的输入引脚拉到VCC或GND。

图2　主程序框图
3.2子程序
　　子程序主要有0.1s工作子程序、按钮处理子程序、判测试项目子程序、电源测试子程序、电容测试子程序、通路测试子程序、绝缘测试子程序、取A/D转换数据及运算子程序、查询子程序、送显示数据子程序等。EPROM被分成4个相等部分，可以分配给不同的地址空间，存取时间为90ns，包括地址锁存与译码PLD时间。
1．6 计数器／定时器
　　PSD5XX有4个16位的计数器／定时器，都有5种操作模式，分别为脉冲、波形、时间捕捉、事件计数和看门狗定时器，由PPLD宏单元控制。
3.3　中断服务程序
　　中断服务程序由“T050ms中断服务程序”和“串行中断服务程序”组成。如图3、图4所示。

图3　T050ms中断服务程序

图4　串行中断服务程序
　　“T050ms中断服务程序”主要完成#个工作。当T0定时器计满后产生溢出，使T0中断标志置1，产生中断，进入中断服务程序：①将计数器1+1，为主程序检查计数器1作准备；②给T0定时器送底数3CB0H为T0计数器产生)50ms溢出作准备；③中断标志置零，为下次中断作准备。
　　“串行中断服务程序”完成串行送数工作。计数器6存有发送和接收数据的字节数，进入中断后，首先将计数器6减1，如计数器6为零，则串行送数完毕关串行中断；如计数器6不为零，则检查T1是否为1，是1为发送状态，则将发送数据输SBUF，数据被发送出去；当T1为0，为接收状态，将接收数据存入指定位置。最后将T1、R1置0，为下次中断作准备。
4　结束语
　　本测试仪已试用于实际检测，适用于武器装备的地面电缆网、舰船电缆网、飞机电缆网、工业电缆网以及通信电缆网的检测，是一种很有推广前景的现代测量仪器。
收稿日期：1999－11－24
