微型机与应用
WEIXINGJI YU YINGYONG
2000　Vol.19　No.5　P.28-30,31




CISCO“标记交换”机制的探讨和研究
胡泳张志浩陈福民
摘 要：对CISCO公司提出的一种新颖的网络层数据包传送技术--标记交换作了比较深入的探讨。
关键词：交换 路由 标记 标记交换
　　Internet规模的持续扩大与多媒体应用的增加，要求Internet服务提供商有更高的带宽。高带宽也意味着路由器对单点和多点传送的高传输性能（每秒包数）。
　　Internet的普及也需要Internet路由系统增强缩放性。从单个路由器获得路由信息，创建1个路由知识组织的能力对支持高质量、可缩放路由系统是非常必要的。
　　在增加路由功能以支持多点发送、路由路径的控制以及提供创建路由信息能力的同时，增强传输性能是非常重要的。不仅如此，创建一个可以满足新需求的路由系统也是很关键的。
　　标记交换是解决这些问题的高效技术。标记交换把网络层路由提供的灵活、丰富的功能和由标记交换传送规范带来的简单性结合在一起。标记交换的简单机制在支持高性能价格比的同时也增强了传输性能。MAX539是单电源、低功耗、电压输出、12位串行DAC，具有8引脚DIP／SO封装。最后，简单传送、大范围的传送间隙和维持同一个传送范围的同时，参与路由功能三者的结合可以使路由系统适应新的需求。
1 标记交换的组成
　　标记交换由传送和控制二部分组成。传送部分使用数据包携带的标记信息和标记交换机支持的标记传输信息进行数据包传输。控制部分负责在1组互连的标记交换机中维持正确的标记传输信息。标记交换机制可以保持IP的缩放性质、增强IP网络的弹性。
1．1 传送部分
　　标记交换使用的基本的传送规范是基于标签交换概念的。当1个标记交换机接收到1个携带标记的数据包时，它把这个标记作为自己的标记信息表（TIB）中的1个索引。TIB中的每1个条目由1个进入标记和1个或者多个子条目（输出标记、输出接口、输出链路层信息）组成。如果标记交换机发现1个条目的进入标记与收到的数据报所携带的标记相匹配，那么交换机用输出标记代替数据包中的标记，用输出链路层信息代替数据报中的链路层信息（如MAC地址），然后把该数据包向输出接口发送。
　　从上面的描述中可以发现：（1）传送策略取决于一个确定的匹配算法，该算法使用1个定长、相当短的标记作为索引，这样就简化了传送过程并且增强了传输性能，而且可以直接由硬件实现。（2）传送策略不依靠标记的传送间隙。例如，同1个传送算法既适用于单点发送，又适用于多点发送，1个单点发送的条目只包含1个子条目，而1个多点发送的条目包含1个或多个子条目（对于多点访问链路，输出链路层信息包括多点发送MAC地址）。这说明了相同的传送算法怎样利用标记交换支持不同的路由算法。本文介绍利用WIN95下的通信函数和PC机并行口（打印机口）的连接，通过VC编程，实现串行DAC与WIN95环境通信的方法。可以在不干预传送算法的情况下使用新的路由（控制）功能。这意味着在增加新路由功能的同时，没必要重新优化传送性能（通过修改软硬件）。数据包携带标记信息有多种方法：
　　（1）作为1个小的标记头插入到第2层与网络层头部信息之间；
　　（2）如果第2层头部信息提供充分的语义（例如ATM）作为第2层头部信息的一部分；
　　（3）作为网络层头部信息的一部分（例如使用IPV6中的FLOW LABEL域）。
　　 因此，可以在任何媒质上虚拟地实现标记交换，包括点到点链路、多点访问链路和ATM。
　　另外，标记传送部分与网络层是无关的。但在高速应用时，则须考虑PC系统的中断时间对串行传送的影响。
1．2 控制部分
　　标记交换的关键是标记与网络层路由的绑定。为了提供良好的缩放特性，适应不同的路由功能，标记交换支持许多传送间隙。一方面，1个标记可以绑定到1组路由上（取决于路由上网络层能达到的信息）；另一方面，它可以绑定到1个独立的应用流（例如，RSVP流）；标记也可以绑定到1个多点播送生成树上。在的上升沿，最低12位有效数据被送入DAC寄存器，并更新DAC的输出数据。但在高速应用时，则须考虑PC系统的中断时间对串行传送的影响。若增加新的路由功能，只需要增添新的模型即可。下面是一些模型的介绍。
1．2．1 基于目的的路由
　　在基于目的的路由中，路由器通过数据报携带的目的地址和传送信息表（FIB）中的信息来确定传送路径。路由器通过它从路由协议（如OSPF，BGP）中得到的信息来构造它的FIB。
　　为了支持标记交换基于目的的路由，1个标记交换机像路由器一样，参与路由协议，并且用从这些协议中得到的信息构造它的FIB。
　　有三种方式进行标记配置和TIB的管理：（1）下游标记指派；（2）根据需求的下游标记指派；（3）上游标记指派。所有方式中，1个交换机指派1个标记并且把它与FIB中的地址前缀结合。在下游指派中，数据包中的标记生成后由链路下游的交换机（以数据流方向为参考）与前缀绑定。而下游指派则由上游的交换机完成。

图4 硬件连接
　　由于WIN95下并行口输出的位周期小于MAX538／MAX539的最小位周期，即发送波特率大于接收波特率，使产生的SCLK信号为一窄尖脉冲。方式（2）和（3）在ATM网络中很有用。在下游标记指派中，交换机负责创建与输入数据包的标记结合，同时接收从其邻居来的输出数据包的标记绑定。本文介绍利用WIN95下的通信函数和PC机并行口（打印机口）的连接，通过VC编程，实现串行DAC与WIN95环境通信的方法。
　　下游标记指派的工作如下：对于FIB中的每1个路由，交换机指派1个标记，并且在它的TIB中创建1个条目，把进入标记设置为指派的标记，然后把这对路由与标记的绑定信息通知给相邻的标记交换机。这种通知可以通过把绑定放在已有的网络层协议之上，或者通过独立的标记发布协议（TDP）来完成。当1个标记交换机接收到1个路由的标记绑定信息，并且该信息来自这条路由的下一驿站时，交换机就把绑定信息中携带的标记放到与这条路由相关联的TIB条目中的输出标记部分。这样就在输出标记与路由之间建立了绑定。可应用于电池供电的测试仪器、数位偏移和增益调节器、成组操作或远程工业控制、计算机和移动控制装置、便携式电话等领域引脚如图1所示，引脚功能如表1所示。因此，交换机能够向该路由的下一个驿站发送标记绑定请求。当下一个驿站收到请求时，它就指派1个标记，在它的TIB中创建1个条目，并把进入标记设置为指派的标记。此外，利用并行口及VC＋＋提供的＿inp（）函数也可实现串行ADC与WIN95环境的通信。当源交换机收到绑定信息时，便创建1个TIB条目，并把输出标记设置为绑定信息中的相应的部分。
　　上游标记指派的工作过程如下：如果1个标记交换机有1个或多个点到点的接口，那么对于FIB中的每1条路由（经过这些接口可以到达它的下一驿站），交换机就指派1个标记，在它的TIB中创建1个条目，并把输出标记设置为指派的标记。
　　在WIN95下可利用串行应用程序接口SAPI，通过串行口（RS－232口）与其它通信设备进行交互式串行通信。以下给出用VC编写的通信程序中用于产生各种波形的具体函数。
2 WIN95环境下的通信资源
　　WIN95的应用程序常需要具备同外围设备进行通信的能力。
　　当标记交换机绑定1个输出标记和1个路由时，它同时也利用绑定信息更新它的FIB，这样交换机就可以在先前没有携带标记的数据包中加入标记。
　　从上面的分析可以看出，基于目的路由的标记交换机支持的标记总数不能比FIB中的路由个数多，而且1个标记有时与多个路由链接。
　　一般来说，标记交换机利用它所能达到的路由的输入、输出标记维护它的TIB，因此，所有的数据包可以利用简单的标签交换传送。另外，标记的分配是通过路由，而不是通过数据流，即FIB条目的存在导致标记的指派，而不是数据包的到达。
　　使用与路由而不是与数据流相关的标记，也意味着没有必要为每个数据流执行级别检验程序而决定是否为这个数据流指派1个标记。
　　另外，标记交换机用于支持基于目的的路由时，也不能完全排除执行普通网络层传送的需要。首先，为了给1个事先没有标记的数据包指派标记时，需要普通网络层传送。这个功能可以由第1个驿站路由器实现，也可以由能够参与标记交换的路径上的第1个路由器实现。此外，利用并行口及VC＋＋提供的＿inp（）函数也可实现串行ADC与WIN95环境的通信。然而，以上这种1组路由与1个标记结合的情况远比利用普通网络层传送时做路由决定的几率小，而且，这种结合也只使用与交换机支持的路由的1个子集。所以，数据包的传输大部分时间还是利用标记交换算法。
1．2．2 路由知识的组织
　　IP路由体制是网络以路由域的模式存在。MAX539是单电源、低功耗、电压输出、12位串行DAC，具有8引脚DIP／SO封装。然而，域中所有的路由器必须维持内部路由和外部路由提供的信息，因此，带来了一些问题。首先，信息的数量不是重要的，它把额外的需要放到路由器需要的资源上；其次，路由信息的增加往往增加路由收敛时间，也就降低了系统的性能。具体硬件电路如图4所示。而其它处于域内部的交换机仅仅需要维持内部路由器提供的路由信息（这种信息比外部路由信息要少得多）。此外，利用并行口及VC＋＋提供的＿inp（）函数也可实现串行ADC与WIN95环境的通信。
　　为了支持这种功能，1个标记交换机允许数据包携带1个以上的标记，而且这些标记组织成栈的形式。标记交换机可以交换栈顶的标记，也可以弹栈、入栈。
　　当1个数据包在2个处于不同的域中的交换机之间传送时，其中的标记栈只包含1个标记，而在同1个域中传送的数据包的栈则包含2个标记（第2个标记是由域的扇入交换机压入的）。标记栈中的栈顶标记负责数据包向合适的扇出边缘交换机传送，第2个标记负责数据包在扇出交换机中的正确传送。
　　在这种方式下使用的控制成份和上面提到的基于目的的路由使用的控制成份大体上是相似的。但在高速应用时，则须考虑PC系统的中断时间对串行传送的影响。而MAX538／MAX539则需要接收16位串行数据，低12位为有效位，且按照先高位后低位的模式接收。多点播送的路由程序负责建立生成树，多点播送传送负责在生成树中传送数据包。
　　为了支持标记交换中的多点传送功能，每1个标记交换机必须按如下方式结合1个标记与1个多点播送树：当1个标记交换机创建1个多点播送条目和它的输出接口的同时，该交换机也创建本地标记集合（与每个输出接口一一对应）。此方法在WIN95下可以方便地控制实现数模转换，完成测控系统后向控制通道的接口，并且也同样适用于串行ADC与WIN95环境的通信。为了能够可靠传送数据，在程序中采用了输出延迟的方法，使SCLK信号恢复正常。交换机然后就通过和条目的相连的输出接口广播这些绑定信息。
　　当1个交换机接收到来自位于其上游（以多点播送树为参考）的另1个交换机的树和标记的绑定信息时，它就把它和这棵树相关的TIB条目中的输入标记设置为绑定信息中的标记。
　　当1组标记交换机通过1个多点访问子网相连时，多点播送的标记分配必须和交换机协同起来。其它情况与基于目的路由的标记分配一样。
1．2．4 灵活的路由
　　基于目的的路由其基本特点是：1个数据包中用于传送的信息是目的地址，虽然这个特点保证了高性能路由，但是同时也限制了利用数据包携带的路径进行路由的能力（源路由），不利于对低负荷路径的利用。对于支持不同类别服务的ISP而言，基于目的的路由也限制了它们结合不同类别服务与不同链路的能力。现在一些ISP利用FRAME RELAY和ATM克服这种限制，然而，标记交换由于使用了灵活的标记间隙，不需要使用FRAME RELAY和ATM就可以克服这些限制。
　　为了达到在不同与基于目的路由决定的路径上传输的目的，标记交换中的控制部分在标记交换机上安装了与基于目的路由的路径无关的标记绑定。
2 ATM中的标记交换
　　既然标记交换传送机制是基于标签交换的，而ATM也是基于标签交换的，所以通过标记交换中的控制部分，可以把标记交换用到ATM交换机中去。
　　标记交换所需要的标记信息可以放到VCI域中。如果需要2个层次的标记，可以利用VPI。虽然使用VPI限制了网络规模，但是一般情况1个层次的标记足够了。
　　为了获得必要的控制信息，交换机必须能够作为一个对等者参与到网络层的路由协议（如OSPF，BGP）中。
2 WIN95环境下的通信资源
　　WIN95的应用程序常需要具备同外围设备进行通信的能力。
　　为了支持基于目的路由的标记交换，1个ATM交换机可能需要多个或1个路由相关的标记（或者是具有同一个下一驿站的1组路由）。这对于避免来自于不同的标记交换机，却被发送到相同的下一驿站的数据包之间的冲突是必要的。但在高速应用时，则须考虑PC系统的中断时间对串行传送的影响。
　　因此，ATM交换机能支持标记交换，但是它至少能够实现网络层协议和标记交换中的控制部分。同时，它也需要支持一些网络层传送。
　　在ATM交换机上实现标记交换将简化ATM交换机和路由器间的连接--具有标记交换的ATM交换机将以一个路由器的形式出现。由于机遇目的传送机制是协议驱动的而并非数据驱动，所以这样便省去了ATM地址、路由和信号机制。
3 标记交换中的服务质量及实施战略
3．1 服务质量
　　为了获得通过路由器和标记交换机传送数据包的服务质量需要二种机制：第一，需要把数据包划分为不同的类别；第二，服务质量的参数（如带宽）要提供给每一类别。
　　标记交换提供了一个简单的途径使1个数据包属于特定的类别。类别的初始化将利用网络层或者更高层的头部信息实现。与该类别相关的标记将用于这个数据包中。这样，被标记的数据包可以被标记交换路由器灵活地控制，而不需要重新分类。
　　标记交换支持的服务质量依靠于QoS的定义。如果使用RSVP以获得一类数据包的QoS，那么必须为每1个RSVP会话分配1个标记。这可以通过TDP或RSVP扩展来实现。
3．2 实施战略
　　既然标记交换在2个相邻的标记交换机之间进行，而且标记的绑定信息可以在双绞线上发布，标记交换就可以用相当简单的语言描述。此方法在WIN95下可以方便地控制实现数模转换，完成测控系统后向控制通道的接口，并且也同样适用于串行ADC与WIN95环境的通信。
3 串行DAC与WIN95下的通信接口
　　利用PC机并行口和＿outp函数，通过程序控制，可以方便地实现WIN95环境与串行DAC的通信接口。事实上，1个连接到路由器上的标记交换机就像1个路由器一样。
　　随着越来越多的路由器升级为能够支持标记交换，标记交换机提供的功能也越来越多。例如，一旦1个域中的路由器都支持标记交换，使用路由知识的组织功能就成为可能。
　　本文对标记交换技术进行了探讨。标记交换并不限制在某一个特殊的网络层协议上，它是一个多协议解决方案。
师恩培（山东大学威海分校计算机系264200）
参考文献
［1］黄海容．在Windows95下实现PC机与单片机AT8951的 串行通信．微型机与应用，1999；(4)
［2］王金玉．在Win32环境下实现32位串行通信．中国计算 机用户，1997；(5)
收稿日期：1999－12－28
。12位串行DAC由写入2个8位字编程，16位串行数据位被时钟依次输入DAC的高位到低位。但在高速应用时，则须考虑PC系统的中断时间对串行传送的影响。传送间隙与不依靠传送部分的控制的结合，导致了可以使用新的路由功能去满足日益发展的网络需求。
胡泳（上海同济大学计算中心200092）
张志浩（上海同济大学计算中心200092）
陈福民（上海同济大学计算中心200092）
参考文献
［1］Rekhter Y，Davie B，Katz D，Rosen E，Swallow G．RFC(2105)Cisco Systems′ Tag Switching Architecture Overview．1997；(2)
收稿日期：1999－12－16


