软件学报
Journal of Software




一种基于形状的图像信息检索方法
刘继敏　史忠植
摘　要　该文把一幅图像看成是由一些区域构成的,这些区域在其内部有着颜色或纹理等方面的相似性,图像的形状由这些区域的边界线及其空间关系来描述。要根据图像中所包含的物体或场景在形状方面的特征进行检索,关键问题是形状相似性的度量及其空间关系的表示与匹配。文章应用变形模板匹配技术,提出了较为合理的简单形状相似性计算方法,而这些简单形状之间的空间关系则由二维集合串来表示。文章还给出了空间关系匹配算法,在检索方法上,将整个检索过程分为初级检索、检索求精与空间关系匹配3个阶段。
1.1　检测原理
　　一般地,在提取真实目标信息的过程中,设第i帧输入信号为Si,它包含若干组超过门限的量测记录,即

其中Rij是一个量测记录,含有距离、速度、方位、俯仰及幅度等参量;ni为第i帧输入的量测记录数,它在0与某一上限之间随机变化,故序列｛Si｝为一随机过程。然而,即便是一些最简单的情形,多任务的最优化分配调度问题也是NP难题［1］。
中图法分类号　TP311
A Shape-Based Image Information Retrieval Method
LIU Ji-min　SHI Zhong-zhi
(Institute of Computing Technology　The Chinese Academy of Sciences　Beijing　100080)
Abstract　An image can be considered as a combination of regions, which have some intrinsic homogeneities in color or texture, etc。 The shapes in an image are described by the boundaries of these regions and their spatial relations。 To retrieve image by shape, it is a key problem to measure the similarity among shapes and match their spatial relations。 Adopting template-matching technique, the authors present a computation method for simple shape similarity。 Based on the two-dimensional set string representation of the spatial relation of these simple shapes, a spatial relation match algorithm is also presented。 The whole retrieval process is divided in three stages, i。e。, the rough stage, the refining stage and the spatial relation matching stage。 The experiment shows this method is rapid and accurate。
Key words　Similarity, 2D set string, shape-based retrieval, image database。显然,对于不同的应用模型,采用这样的方法得到的估计精度是不一样的。目前,已有不少基于内容进行检索的实用系统,如QBIC,Photobook,VisualSeek等。这些系统在根据颜色与纹理等信息进行检索时,所得到的检索结果与所期待的结果较为接近。在根据形状信息进行检索时,它们是用形状所具有的特征,如周长、面积、矩不变量等来描述形状,并由此建立索引,进行检索。文献［1,2］也是采用类似的方法。对于Ⅱ类模型,SAA算法的任务夭折率介于25％～35％之间,PAA算法的结果则低于20％,比SAA降低了40％左右。但是,形状的特征描述仅仅是在一定的程度上体现了人们对形状的感知,给人感觉到完全不同的形状可能有相同的特征量,因而,这种方法的检索结果与用户想要得到的结果往往会相差很大。而且,在实际中,特征量的提取都会有不同程度的误差,这势必进一步影响到检索的精度。在分析了特定应用背景中的处理流程之后,抽象得到两类随机任务模型,针对这两类模型介绍了在分布式实时系统中已经得到应用的静态分配调度算法SAA(static allocation algorithms),进而提出了多任务分配调度的预测算法PAA(predicting allocation algorithm)。这一方法是直接把两个形状进行比较,而不是比较其特征量,因而有较高的精度。但是在检索时,由于是将模板与每一个图像进行匹配,而且每一次匹配都有很大的计算量,因而,这一方法的检索速度慢。
　　为了既提高检索速度,又保证较高的检索精度,我们的做法是：对每个存储在图形库中的图像,提取其具有显著形状特征的区域,每个区域的边缘是一个简单形状,或由几个简单形状构成(这里,简单形状是指平面上的简单闭曲线),图像的形状由这些区域的边界线及其空间关系来描述,如图1所示。


Simple shape 1, 2, 3 are boundaries of the regions that have notable features。 The shape of the original image is represented with the three simple shapes and their relationship。
简单形状1,2,3是从原始图像中提取的具有显著形状特征的区域的边界,我们用这3个简单形状及其空间关系来描述原始图像所具有的形状特征。
Fig.1　Shape representation
图1　形状的描述
　　我们将这些简单形状保存起来,同时将其周长、面积等形状特征存入特征库。可见,PAA算法与SAA算法在各项指标上均有显著改善。

为了从图像库中检索出图1中的原始图像,用户只要直接画出他所关心的1个或几个简单形状,作为其查询要求,如(a),(b),(c)。
Fig.2　The submission of the research query
图2　查询要求的提交
　　系统根据各简单形状的特征量,进行初次检索,检索出包含所有这些简单形状的图像,再用变形模板匹配技术［5］进行检索求精,排除相似度较小的图像,最后,如果用户提交的是多个简单形状,还要根据其隐含的空间关系,对检索出的图形进行空间关系匹配,排除空间关系不匹配的图像,并把最后剩下的图像按相似度从大到小返回给用户。系统流程图如图3所示。

Fig.3　System flow chatr
图3　系统流程图
　　本文第1节讨论形状相似性的度量。第2节讨论空间关系的表示及其匹配问题,提出了用二维集合串表示简单形状之间空间关系的方法,并给出了空间关系的匹配算法。第3节讨论基于形状的图像检索算法。在SAA算法中,我们即利用它来实现多任务的分配。 
1　形状相似性的度量
　　假设我们能计算出简单形状的n个特征量f1,f2,...,fn,这些特征量可以是面积、周长、矩等,具体计算方法本文不再叙述,可参考通常的图像处理方面的文献,如文献［6］。

Fig.3　Task run time for type Ⅰ
图3　Ⅰ类模型任务完成时间

Fig.4　Task run time for typeⅡ
图4　Ⅱ类模型任务完成时间

Fig.5　Performance of load balancing for type Ⅰ
图5　Ⅰ类模型负载均衡度

Fig.6　Performance of load balancing for typeⅡ
图6　Ⅱ类模型负载均衡度

Fig.7　Task response time for type Ⅰ
图7　Ⅰ类模型任务响应时间

Fig.8　Task response time for type Ⅱ
图8　Ⅱ类模型任务响应时间

Fig.9　Task time out ratio for type Ⅰ
图9　Ⅰ类模型任务夭折率

Fig.10　Task time out ratio for type Ⅱ
图10　Ⅱ类模型任务夭折率
5　结束语
　　分布式实时系统中很多未知因素会影响到系统的性能,如果能够比较准确地对这些未知量进行预测估计,便可以有效地进行任务分配和调度。对A=｛fA1,fAn,...,fAn｝与B=｛fB1,fBn,...,fBn｝而言,我们可以用如下的特征距离disf(A,B)来刻画相似度Similarf(A,B)：

其中ωi(i=1,...,n)为预先确定的常数,反映了每个特征量的重要程度。disf(A,B)越小,表示Similarf(A,B)越大。
　　我们认为,简单形状之间的相似性度量是形状相似性度量的关键。上述方法是用特征量之差来度量相似度。在分析了特定应用背景中的处理流程之后,抽象得到两类随机任务模型,针对这两类模型介绍了在分布式实时系统中已经得到应用的静态分配调度算法SAA(static allocation algorithms),进而提出了多任务分配调度的预测算法PAA(predicting allocation algorithm)。但是,我们很难找到刻画形状本质的特征量,在我们所选取的特征量中,不可避免地会出现不同的形状具有几乎相等的特征量的情况,因而上述度量方法有时会有较大的误差。为得到较为精确的Similarf(A,B),我们再提出基于模板形变的方法,该方法是对文献［5］中的方法的简化,其步骤如下：
　　(1) 将简单形状A用样条曲线来表示,并选取适当的能量公式。一个简单的方法是,将A等距分
割,将分割点作为样条曲线的控制点。假定其控制点为ck(k=1,2,...,l),记C=(c1,c2,...,ck),由C所决定的样条曲线相对弧长S的参数方程表示为Γ(C,S),其长度为L(C)。另一方面,我们可以将每一任务的完成视为对外部事件的一次响应,定义各个任务的等待时间之和为系统的总响应时间,当任务在系统中的分配确定以后,各个PN上进行合理调度的主要目的便是减小响应时间。这里,我们取Ext(C,S)=e-Kd2(C,S)其中d(C,S)为Γ(C,S)上的点到简单形状B的距离,K为预先确定的常数。显然,其值愈小,系统的潜力愈大。关于样条曲线,参见文献［8］。
　　由滤波-预测方程可知,各帧的滤波预测依赖于前一帧的预测结果,故在系统开始运行时,我们必须根据先验知识以及最初几个帧内的实际参数获得所需的预测数据,所以PAA算法分为初始阶段和正常阶段两个部分。
　　(1) 初始阶段
　　在系统开始工作后的前3帧中,以任务参量的均值作为参量估值,通过SAA算法,实现所有任务在系统中的分配调度。
　　(4) 把E3/L(C)作为匹配的相似度。详细算法及有关实验结果参见文献［5］。
2　空间关系的表示与匹配
　　为了描述简单形状集合Ω=｛A1,A2,...,An｝的空间关系,我们将各简单形状的重心向X轴与Y轴投影,在X轴与Y轴上分别得到两个集合串XΩ1XΩ2...XΩsΩ与YΩ1YΩ2...YΩtΩ,如图4所示。
　　XΩ1XΩ2...XΩsΩ有如下性质：
　　(1),这就是说,XΩi(i=1,2,...,sΩ)是集合｛A1,A2,...,An｝的一个划分。
　　(2) 如果｜(A1）x-（Aj）x｜＜ε,Ai∈XΩp,Aj∈XΩq,则XΩp＝XΩq,其中（Ai）x表示Ai的重心在X轴上的投影关于X轴的坐标,ε是预先确定的常数。这一性质表明,当两个形状的投影坐标相差不大时,应归为同一类,这主要是考虑到,在实际计算时,本身有误差的存在。
　　(3) 如果Ak∈XΩi,Al∈XΩj,i＜j,则（Ak）x＜（Al）x。
　　YΩ1YΩ2．．．YΩtΩ也有类似的性质。
　　用这两个集合串,我们可以方便地描述简单形状集合各元素之间的相对空间关系。
　　对两个形状集合Ω1＝｛A1,A2,．．．,An｝与Ω2＝｛B1,B2,．．．,Bn｝,如果存在对应,使得F（XΩ1i）＝XΩ2i,F（YΩ1i）＝YΩ2i,则称Ω1与Ω2有相同的相对空间关系。这时,我们还可以定义他们的结构距离为：disF（Ω1,Ω2）＝其中d（Ai,Aj）表示Ai与Aj的重心之间的距离。disF（Ω1,Ω2）可以看作是对Ω1与Ω2的绝对空间关系的相似度的一种度量方式,disF（Ω1,Ω2）越小,表明Ω1与Ω2的空间结构越相似。
　　现在,我们来看看空间关系的匹配问题,为明确起见,我们先以实际例子来进行说明。
　　假设用户在平面上画出A,B,C,D这4个简单形状,如图4所示,图像库中的某个图像所包含的简单形状如图5所示,并且,通过简单形状相似性计算,已确定匹配关系：A1,B2,3,C4,6,D5,我们的问题是：在图5中是否存在形状子集｛a,b,c,d｝｛1,2,3,4,5,6｝,使得Aa,Bb,Cc,Dd,并且｛a,b,c,d｝与｛A,B,C,D｝有相同的相对空间关系？由图5可见,这一问题的答案是a=1,b=2,c=4,d=5。可见,PAA算法与SAA算法在各项指标上均有显著改善。
　　已知: Ω1＝｛A1,A2,...,An｝,Ω2＝｛B1,B2,...,Bm｝,AiSi(i=1,2,...,n,Si力2),
　　求: ai(i=1,2,...,n),使其满足ai∈Si(i=1,2,...,n),并且在映射Aiai之下,｛a1,a2,...,an｝与｛A1,A2,...,An｝具有相同的相对空间关系。我们在多处理机模拟系统中实现了SAA和PAA算法,并针对Ⅰ类模型和Ⅱ类模型分别利用Monte Carlo方法进行了算法仿真。例如,在雷达信号和数据处理中,多对象、多层次的相关处理同时存在,使整个信息处理过程可被视为一系列相关处理的组合。
3　形状检索算法
　　由于关系型数据库提供了一些很好的检索方法,因此,我们将特征库、形状库、图像库直接用关系型数据库来管理,其结构分别是：

①特征库,②形状库,③图像库,④形状号,⑤特征量,⑥形状数据,⑦图号,⑧图形数据。
有关字段说明如下：我们把所有从图像库中提取的简单形状统一编号,给予每个简单形状给予一个唯一的形状号；为了加快检索速度,每个简单形状的特征量与其形状数据本身分开存放,形状数据可以是这个形状的BMP图形；所有图像也统一编号,给予每个图像一个唯一的图号；对每个简单形状,还要用一个图号标记它是从哪一个图像中提取出来的。
　　假设用户提供形状集为Ω1＝｛A1,A2,...,An｝,我们提出如下检索算法。
　　Step 0. 输入形状集Ω1＝｛A1,A2,...,An｝,确定常数ε0及ε1。
　　Step 1. 对每一个Ai(i=1,2,...,n):
　　　　Step  提取Ai的特征量。
　　　　Step  ShapeNoi←特征库中与Ai的特征量距离disf小于ε0的记录的形状号。进入稳态以后,预测曲线与实际曲线基本吻合,因为我们所考虑的是长时间工作的系统,因而系统初态出现的误差基本可以忽略,故这样的预测效果可以满足实际调度的要求。
　　　　Step 对ShapeNoi中的每个形状号Sj:
　　　　Step 用模板形变的方法确定其与Ai的相似度Similarf。
　　　　Step 如果Similarf大于ε1,则从图像库选取所有形状号为Sj的图像号,并将其并入集合ImageNoi,否则,从ShapeNoi中去掉Sj。
　　　　Step  标识映射Ai→ShapeNoi。
　　Step 3 ImageNo←ImageNo中与｛A1,A2,...,An｝具有相同的相对空间关系的图像。
　　Step 4 如果ImageNo为空集,适当增大ε0或减少ε1,转Step 1。
　　Step 5 对ImageNo中的每个图像,计算其与｛A1,A2,...,An｝的结构距离,并按结构距离从小到大的顺序输出一定数量的图像。
　　这一方法已用于基于形状的中草药图像检索实验系统,该系统已有400多幅图像,响应时间在2秒以内。整个检索过程分为3个阶段：Step 1。在分析了特定应用背景中的处理流程之后,抽象得到两类随机任务模型,针对这两类模型介绍了在分布式实时系统中已经得到应用的静态分配调度算法SAA(static allocation algorithms),进而提出了多任务分配调度的预测算法PAA(predicting allocation algorithm)。直观上,KPn与KBn具有相近的意义,我们将通过算法仿真对此
进行验证。扩充图像库,只影响Step 1。2,而这一阶段是根据索引进行检索,因而整体响应时间不会有太大的影响。
　　负载均衡系数――设在第n帧中首先完成所有任务的PN执行时间为Qn,则我们定义

为第n帧内的负载均衡系数。在SAA算法中,我们即利用它来实现多任务的分配。
　　在基于形状的检索中,如何有效地从图像中提取简单形状,哪些区域是具有显著形状特征的区域？在SAA算法中,我们即利用它来实现多任务的分配。在无约束的情况下,这是一个十分困难的问题。但是,对特定的应用领域,我们可以首先建立一个可能用于检索的标准形状库,当把一幅新的图像加入图像库时,先用边缘提取［9］或区域分割［10］等方法提取其轮廓,然后,把标准形状库中的形状看成模板,应用模板匹配方法［5］,找出其中所包含的可以用于检索的简单形状。这正是我们所采用的方法。
　　同时,我们认为,并非每一幅图像都可以用基于形状的方法进行检索。对一些形状特征不很明显的图形,就不好用基于形状的方法进行检索。要开发出一个真正实用的基于形状的图像信息检索系统或子系统,必须将认知科学、计算机视觉、数据库技术等有机地结合起来,这将是一个困难而有意义的问题［11,12］。
本文研究得到国家自然科学基金(No。69790080)和国家863高科技项目基金(No。863-317-9604-05)资助。
刘继敏（中国科学院计算技术研究所　北京　100080）
史忠植（中国科学院计算技术研究所　北京　100080）
参考文献

