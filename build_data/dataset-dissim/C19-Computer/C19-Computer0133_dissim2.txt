计算机应用
COMPUTER APPLICATIONS
1999年 第19卷 第10期 Vol.19 No.10 1999



轻度目录访问协议的分析
张军　颜凯
　　摘　要　本文详细阐述了轻度目录访问协议，包括该协议数据报的分析以及协议操作中服务器与客户端的处理过程等大量细节。联系类中的主控方法是工作流执行的“全权代表”，其过程包括调用发出成员的信息发送方法、调用接收成员的信息处理方法以及创建下一个联系对象等。工作流代号为1001的工作流由A、B、C三个成员协作完成，它们由联系类名为RelationObject的类对象协调控制，这个类所需的参数存放在联系对象参数表Table1001中，其控制参数除了发出成员、接收成员外还可根据需要设置任务开始时间、最后期限、任务完成指标、所要调用的任务处理方法名等（这里用参数1、2代表），协作顺序为A―B―D。
　　实现通用式目录服务的主要标准是1993年版ITU-T X.500系列建议标准。ISO接受此建议，把它作为ISO9594国际标准。此建议系列规定了信息模型，通信协议，安全认证等各个方面。然而不幸的是，X.500系列协议并不支持TCP/IP协议。
　　于是，IEIF下的ASID小组制定了轻度目录访问协议（Light Weight Directory Access Protocol，简称LDAP），其目标是用较小的代价在因特网上实现X.500大多数的功能。最终LDAP用相当于X.500标准10%的代价完成了其90%的功能。这使得LDAP成为了因特网目录服务的标准。
　　关键词　动态联盟，面向对象，信息系统，工作流管理，CORBA
MODEL FOR INFORMATION SYSTEM OF VIRTUAL AGILE ENTERPRISE BASED ON WORKFLOW MANAGEMENT
Wang kai　Bai qinghua
College of Economics & Management，Tongji University， Shanghai 200092
　　Abstract　This paper puts forward ideas of designing the Information System which support dynamic and cooperation by discussing the object′s classification and the workflow′s execution in object-oriented Workflow Management System and analyses the support of CORBA to the system′s distribution in implementation of system. At last the paper gives a system model , which is composed by process definition , process execute and management monitor.
　　Keywords　Virtual agile enterprise, Object-oriented, Information system, Workflow management , CORBA
1　动态联盟企业及其特点
　　随着世界统一市场的形成，市场竞争日益激烈。在这一模型中，自始至终都是客户处于主动，客户传送一个协议请求到服务器，服务器负责在目录中执行该请求必要的操作。执行完这些必要操作之后，服务器向发出请求的客户返回一个响应，响应中包含了执行请求所获得的任何结果或错误。成员类对象在工作流定义时生成，其具体的任务处理方法集成在可修改方法库中。

图1　LDAP协议模型示例
　　在LDAP版本1和版本2中，服务器如果发现了操作所需的参考节点，会继续跟踪执行协议操作，它只向客户返回最终结果。这种操作模式可能会带来性能上的问题。为了解决这一问题，在版本3中允许服务器向客户端返回指向其它服务器的参考指针。这就使得服务器可以不用联系其它服务器以继续其操作，而是把这个服务器指针返回给客户，由客户完成操作。这虽然增加了一些客户的复杂度，但是大大提高了性能和分布式应用的能力。从工程角度看还是值得的。
2.3　工作流动态协作机制的实现
　　下面我们以一个工作流为例来说明动态协作机制的实现（见图1）。一个目录信息树如图2所示：

图2　目录信息树示例
　　图2描述了一个目录信息树。目录信息树的根（root）是一个虚根，并没有实际意义。树中的任意一个节点都是目录信息树的一个入口（Entry）。由于不同的工作流可能需要不同类型或个数的控制参数来表示，因此允许定义不同的联系类，但所有联系类都应是基本联系类的子类，以保证联系类对象基本功能的实现。由此在构造信息系统时我们主要提取两大类对象：成员类和联系类。
　　例如从Cn=Zhang Jun这一特定入口一直到C=CN入口存在一条唯一的路径，路径上的所有入口组成一个序列，该序列的所有相关辨识名就构成了本人的辨识名：
　　Cn=Zhang Jun，Ou=people，O=UESTC，C=CN
　　下面是一些LDAP协议中关于目录信息树的基本概念：
　　目录信息树的入口属性
　　目录信息树入口是由一个属性集合组成的。属性是由一个类型描述以及该类型所具有的一个或多个值组成。联系类中的主控方法是工作流执行的“全权代表”，其过程包括调用发出成员的信息发送方法、调用接收成员的信息处理方法以及创建下一个联系对象等。子入口和子模式入口。
　　模式（Schema）是一个集合，其中包括了属性类型定义、对象类定义以及其它一些信息。由于不同的工作流可能需要不同类型或个数的控制参数来表示，因此允许定义不同的联系类，但所有联系类都应是基本联系类的子类，以保证联系类对象基本功能的实现。子模式入口用来管理与目录模式相关的信息。下述四个属性必须出现在所有子模式入口中：
　　. cn：这个属性被用来构成该子模式入口的RDN。
　　. objectClass：这个属性必须至少具有值“top”和“subschema”。
　　. objectClasses：这个属性的每一个值都定义了一种服务器知道的对象类。
　　. attributeTypes：这个属性的每一个值都定义了一种服务器知道的属性类型。
　　服务器特定数据要求
　　一个LDAP服务器必须提供关于它自己的信息和其它用来指定每一个服务器的信息。这种信息被称之为服务器特定数据。下面是一些服务器特定数据属性：
　　. namingContexts：命名上下文被保持在服务器中。
作者简介：王凯　硕士研究生。
　　. altServer：本服务器稍后将不可用时的替代服务器。
　　. supportedExtension：被支持的扩展操作列表。
　　. supportedControl：被支持的控制列表。
　　. supportedSASLMechanisms：被支持的SASL安全要素。
　　. supportedLDAPVersion：本服务器所实现的LDAP版本。
2.3　协议要素
2.3.1　公共要素
　　LDAP协议的公共要素主要包含了LDAPMessage封装协议数据单元（Protocol Data Unit，简称PDU）的格式，以及被用于协议操作的其它数据类型。
　　. 协议数据报封装
　　为了达到协议交换的目的，所有协议操作都被封装在一个公共的数据报中，这个数据报就是LDAPMessage。其包格式是一个队列，队列中每一个元素的定义如下：

messageIDprotocolOpcontrols

　　LDAPMessage的功能是提供一个协议封套，其中包含了所有协议交换所必须的公共域。现在仅有的公共域是数据报标识符Message ID和控制符controls。对动态联盟企业来说，运作中的不确定因素要求信息系统能随时修改工作流程并及时反映到正在执行的过程中，而传统的信息系统即便能随功能需求变化生成新的工作流程，也很难做到在流程执行中动态调整。对动态联盟企业来说，运作中的不确定因素要求信息系统能随时修改工作流程并及时反映到正在执行的过程中，而传统的信息系统即便能随功能需求变化生成新的工作流程，也很难做到在流程执行中动态调整。
2.1　工作流管理中的对象提取与定义
　　如果我们将工作流中的参与者定义为成员，那么工作流中的协作活动就可划分为成员的任务和成员间的联系。
　　动态联盟企业成员之间的协作（如生产计划、产品设计、文件传阅等）即是典型的工作流。其它的字节值则被用于形成任意字符的可变长度编码。
　　LDAPString：：= OCTET STRING
　　LDAPOID用于描述LDAP协议中的对象标识符。字符串的允许值是采用点分十进制数值表示法，它也是经过UTF-8编码的。
　　LDAPOID：：= OCTET STRING
　　例如：1.3.6.1.4.1.1466.1.2.3
　　. 结果数据报
　　LDAP协议使用LDAPResult结构从服务器向客户返回成功或失败的指示。为了响应多种请求，服务器返回的响应将包括LDAPResult类型字段以指示协议操作请求的最后状态。LDAPResult数据报是一个队列，队列中元素的格式如下：

resultCodematchedDNerrorMessagereferral

2.3.2　绑定操作
　　绑定操作的功能是允许在客户和服务器之间交换身份认证信息。使客户能够以服务器上一个合法对象的身份对目录进行合法操作。
　　. 绑定请求
　　绑定请求是一个请求队列，队列中元素的定义为：

versionnameauthentication

　　. 绑定响应
　　绑定请求也是一个请求队列，队列中元素的定义为：

请求结果 LDAPResultSASL证书 serverSaslCreds

2.3.3　解绑定操作
　　解绑定操作用于终止一个协议会晤。当一个LDAPMessage数据报的协议操作字段使用unbindRequest标签，并且其值为空值时执行解绑定操作。

3　系统分布性的技术支持
　　动态联盟企业的各成员企业地理位置上较为分散，各自又有独立的信息系统和不同的硬件平台，因此随动态联盟的组建而构造的信息系统既要满足这种分布性又要提供与外部系统的通用接口。
2.3.4　搜索操作
　　搜索操作允许客户端请求服务器代替她执行一个搜索。
　　工作流引擎可以是系统根据触发条件自动运行的程序，也可以是人工调用的独立程序。
　　搜索请求是一个队列，队列中的元素定义如下：

baseObjectscopederefAliasessizeLimit
timeLimittypesOnlyfilterattributes

　　参数说明如下：
　　基本对象baseObject――是一个辨识名，指明搜索被执行的目录对象。
　　搜索范围scope――搜索被执行的范围指针。
　　解别名参考DerefAliases――指示了别名对象在搜索中如何被处理。
　　大小限制sizeLimit――限制了搜索结果中返回的最大入口数。0值表示没有客户端请求的大小限制。
　　时间限制timeLimit――允许一个搜索执行的最大时间。0值表示没有客户端请求的时间限制。
　　只含类型typesOnly――指示搜索结果是包含属性类型和属性值，还是只包括属性类型。
白庆华　教授，博士生导师。成员类对象在工作流定义时生成，其具体的任务处理方法集成在可修改方法库中。不管此列表为空还是为“*”，都表示所有的用户属性被返回。
　　服务器在收到一个搜索请求之后，将执行搜索操作，并把结果放在搜索响应中返回。搜索响应是一些LDAPMessage数据报，每一个数据报中都包含了SearchResulEntry、SearchResultReference、ExtendedResponse或者SearchResultDone中的某一个数据类型。
　　SearchResultEntry是一个队列，其元素定义为：

objectNameattributes

　　参数说明如下：
　　对象名称objectName――与搜索条件匹配的目录对象名称。
　　属性attributes――返回的特定属性列表。
　　SearchResultReference也是一个队列，其中包含了一个或多个LDAPURL指向其它服务器。
　　SearchResultDone中包含一个LDAPResult包，给出搜索的最终状态。
　　如果LDAP会晤是在一个面向连接的传输协议上进行，则服务器将向客户返回一个响应队列，这个响应队列被封装在一些分开的LDAPMessage数据报中。在搜索返回的响应队列中可能存在0个或多个的SearchResultEntry和SearchResultReference，它们之间可以以任何顺序返回。在这些SearchResultEntry和SearchResultReference返回之后，服务器将返回一个包含SearchResultDone的响应，指示搜索操作是否成功和发生的错误详情。
　　下面为一个LDAP搜索示例：
　　图3是一个含有多个LDAP服务器的目录树实例。每个任务处理方法都有唯一的任务代号，这个任务代号和其对应的工作流代号、执行成员名、任务类型存在任务列表中。
　　修改请求的包格式为：

objectmodification

　　参数说明如下：
　　对象object――将被修改的对象，其值为一个LDAPDN类型的值。
　　修改modificatin――将在入口上执行的修改。其数据格式为：

operationmodification

　　其中操作operation是add、delete和replace中的一个。而此处的修改modification是一个属性类型/值对的列表，提供了入口将被修改成的新值。
2.3.6　增加操作
　　增加操作允许在目录中添加一个入口。对动态联盟企业来说，运作中的不确定因素要求信息系统能随时修改工作流程并及时反映到正在执行的过程中，而传统的信息系统即便能随功能需求变化生成新的工作流程，也很难做到在流程执行中动态调整。动态联盟企业信息系统模型构架(见图2)及说明如下：

图2
4.1　过程定义说明
　　成员对象描述就是选择适当的成员类生成成员对象，将真实联盟成员的具体信息保存在其中；成员选择则是根据伙伴选择策略平衡动态联盟的各项核心资源，决定联盟成员最优组合并存入联盟成员表（包含成员间相互联系的基本信息，如各从属系统所在主机IP地址等）；联系设置包括由用户为一特定工作流程设置一组联系，将联盟成员用有向线段连接起来，选择联系类型，设置各联系参数，并由系统生成该工作流的联系对象参数表；主从系统分离指的是将各成员对象和与之相关的方法库和任务列表从全局方法库和全局任务列表中复制出来集成在一起，配以用户接口、外部接口以及联盟成员表等分别构成若干从属系统交由各联盟成员在本地使用，盟主成员对象和系统主控部分集成为主系统。这个列表中必须包含入口的可辨识值（用于形成该入口的RDN），对象类属性以及对象类所强制包含的任何属性。
2.3.7　删除操作
　　删除操作允许客户请求在目录中删除一个入口。删除请求中包含了要删除入口的LDAPDN值。服务器在删除入口时不会解除别名参考，并且只有叶节点能够被删除。只要这些修改在（B，D）联系对象生成前进行，都可以实现动态调整。修改辨识名请求定义为：

entrynewrdndeleteoldrdnnewSuperior

参数说明如下：
　　入口entry――将被修改的入口的辨识名。
　　新的相关辨识名newrdn――用来构成入口新名字最左端成分的相关辨识名。
　　是否删除旧相关辨识名deleteoldrdn――决定是否删除入口的旧相关辨识名。
　　新优先级newSuperior――是可选项，其值为LDAPDN类型。如果存在，则表示优先级仅次于现有入口的入口。
　　在协议要素中还包括比较操作、丢弃操作和扩展操作等协议操作，由于篇幅所限，这里就不再作过多分析，其详情可以参见RFC2251。
2.4　协议要素的编码和传输
　　LDAP协议要素在交换时使用抽象语法规则1（ASN.1）中的基本编码规则（BER）进行编码。
　　LDAP协议被设计运行于面向连接，可靠的传输层协议之上。数据流中八位组字符串的任意一位都具有意义。而工作流管理系统的作用就是将现实世界中的业务过程转化成某种计算机化的形式表示，并在此形式表示的驱动下完成工作流的执行和管理。服务器运行监听的TCP端口值建议为389。服务器可以使用替代用的其它端口。客户必须支持在任一合法TCP端口上连接服务器。
2.5　安全考虑
　　当使用面向连接的传输协议时，LDAPv3提供了与LDAPv2兼容的认证机制：使用明文口令的简单认证和其它一些简单认证和安全层（SASL）机制。
2　工作流管理
　　根据工作流管理联盟（WFMC）的定义：工作流所要解决的主要问题是使在多个参与者之间按照某种预定义的规则传递文档、信息或任务的过程自动进行，从而实现某个预期的业务目标，或者是促使此目标的实现。
3　结束语
　　本文讨论了LDAP协议使用的协议模型、数据模型和协议要素的细节，给出了LDAP协议使用的多种数据报文、请求及响应的详细格式，希望能够对读者掌握LDAP这个下一代因特网服务与应用的基础提供帮助。
作者简介：张军　教师。从事计算机信息网络和因特网技术的开发与研究。
颜凯　教师。当情况变化需要调整流程时可通过修改参数表、任务列表、方法库等来完成。
作者单位：电子科技大学信息中心　四川.成都（610054）
参考文献
［1］　Douglas E. Comer. 用TCP/IP进行网际互连.第1卷：原理、协议和体系结构（第3版）.林　瑶，蒋　慧，杜蔚轩，等译. 电子工业出版社,1998
收稿日期:1999-06-21
