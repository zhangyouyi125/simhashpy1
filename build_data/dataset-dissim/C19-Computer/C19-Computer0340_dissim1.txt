计算机应用
COMPUTER APPLICATIONS
1999年 第19卷 第9期 Vol.19 No.9 1999



多功能IC卡系统设计与系统安全性
何大可　李晓航　饶　伟
　　摘　要　西南交大校园卡′96系统、清华大学校园IC卡系统是国内高校有代表性的校园IC卡系统。此类多功能IC卡系统的设计，特别是系统的安全设计，对企事业单位的（单用途）IC卡支付系统和实现“一卡通”多功能应用系统的安全设计均有普遍参考价值。
　　关键词　IC卡，多功能校园卡，系统安全，密码
DESIGN AND SECURITY OF MULTI-PURPOSE IC CARD SYSTEMS
He Dake　Li Xiaohang　Rao Wei
Institute of Computer Security & Comm. Secrecy , Southwest Jiaotong University , Sichuan.Chengdu 610031
　　Abstract　The systems of campus IC card of Southwest Jiaotong University and Tsinghua University are two representative campus IC card systems of high school in China. The design of this multi-purpose IC card system, especially its security design, may be given a reference to the security design of IC card payment system(single-purpose) and multi-purpose "one card going current" practical IC card system for all enterprises and institutions.
　　Keywords　IC card, Multi-purpose campus IC card, System security, Cryptogram
1　引言
　　IC卡(Intergrated Circuit Card)即集成电路卡，也常被称为智能卡（Smart Card)。将具有存储、口令检验或加密和其它数据处理能力的集成电路芯片镶嵌于塑料基片中，便成为通常见到的IC卡。按IC卡的结构，即卡片中所嵌的集成电路及外围电路等的不同，通常可分为四大类：
　　存储器卡：卡中IC大多数为标准的串行EEPROM。
　　逻辑加密卡：卡中IC为带保密逻辑的串行EEPROM。
　　CPU卡或微处理器卡：在前条基础上增加CPU，有的还带专用的协处理器,如模乘法处理器。
　　非接触式IC卡：卡面无金属电触点，与外界的能量及数据交换通过调制电磁波实现。
　　由于IC卡容量大、保密性好（存储器卡除外），因而与磁卡等其它卡片相比有较大优势:
　　. 良好的读写性能。IC卡是集成电路卡，它无需往复机械动作即可完成多次人―机―卡间的会话过程，使卡在应用时更易操作。
　　等待读入一状态集Stk={st1,st2,…,stm},
　　Stemp=Stemp U {Stk U ck′},k=k+1,ck′=1
　　for all Si∈S do
　　　if Stemp是Si的一个k子序列then
　　　　Si中的相应子序列的计数ck=ck+1,ck′=ck
　　　fi
　　od
　　if datacount>=最小范例数 then
　　　if k<v 且Stemp的支持度（support）大于
　　　　最小支持度(min―support) then　　　　　　　　　　　　　　　　　　　　　//预测
　　　　Stemp1=Stemp
　　　　for j=k+1 to v do　　　　　　　　　　　　　　　　　　　//找未来最大可能序列
　　　　　在S中找出包含Stemp1子序列的具有最大cj+1的j+1子序列Stemp2
　　　　　if Stemp ==>Stemp2的信任度(conf)大于最低信任度(min―conf) then
　　　　　　Stemp1=Stemp2
　　　　　else
　　　　　　break　　　　　　　　　　　　　　　　　　　　　　　　　　//退出此层循环
　　　　　fi
　　　　od
　　　　如果j>k,则Stemp1为未来最大可能序列，输出预测情况。中高档IC卡采用的逻辑电路设计、集成电路制造工艺和访问控制与密码技术，使它能有效阻止对卡中数据的非受权读取和篡改。
2　问题描述
2.1　实时过程控制的特点
　　与通常的数据库管理系统中的数据（如商场购物数据，银行储蓄、贷款数据等）相比，生产过程中产生的数据有着明显的特点，主要表现在以下几个方面：
　　重复性　生产过程一般是一批一批地生产产品的，设备运转具有明显的周期性，若数据采集是按一定的时间间隔进行，则每周期采集的数据量是一定的。
　　IC卡的这些优势，一方面降低了系统对网络的依赖程度并提高了响应速度；另一方面又为发行商、应用系统管理者和持卡人三方面的利益提供了有效的保护。所以,不但“三金工程”开始选用IC卡,其它一些IC卡应用系统也不断涌现,如超出食堂卡概念的校园IC卡系统，以致于“一卡通”的单位内部IC卡应用系统。
　　为了便于讨论，下面我们以校园IC卡系统为例来陈述，但其设计原则和结论，对企事业单位的IC卡支付系统的安全设计和实现“一卡通”应用系统的安全设计都有普遍意义。
　　等待读入一状态集Stk={st1,st2,…,stm},
　　Stemp=Stemp U {Stk U ck′},k=k+1,ck′=1
　　for all Si∈S do
　　　if Stemp是Si的一个k子序列then
　　　　Si中的相应子序列的计数ck=ck+1,ck′=ck
　　　fi
　　od
　　if datacount>=最小范例数 then
　　　if k<v 且Stemp的支持度（support）大于
　　　　最小支持度(min―support) then　　　　　　　　　　　　　　　　　　　　　//预测
　　　　Stemp1=Stemp
　　　　for j=k+1 to v do　　　　　　　　　　　　　　　　　　　//找未来最大可能序列
　　　　　在S中找出包含Stemp1子序列的具有最大cj+1的j+1子序列Stemp2
　　　　　if Stemp ==>Stemp2的信任度(conf)大于最低信任度(min―conf) then
　　　　　　Stemp1=Stemp2
　　　　　else
　　　　　　break　　　　　　　　　　　　　　　　　　　　　　　　　　//退出此层循环
　　　　　fi
　　　　od
　　　　如果j>k,则Stemp1为未来最大可能序列，输出预测情况。
　　此方案的优点有：该IC卡的支付范围大，系统建设统一、规范。但此方案的缺点也不少。主要的缺点有两条：一是使用单位难以处理网络系统突发故障；二是卡中的敏感数据使用单位难以有效利用，所以很难建设包括门禁、考勤、医疗在内的“一卡通”多功能应用系统。
　　. 利用逻辑加密卡或CPU卡实现校内的“一卡通”多功能应用系统。
　　此方案的优缺点与前一方案正好相反。比如，它可以应付网络系统或局部供电系统突发故障，保证学生上机、用餐这类时间性极强的活动的支付正常进行；也容易设计多功能的系统，将门禁、考勤、考试、学籍、医疗、消费等多功能集于一身。
　　. 利用“磁条――IC复合卡”实现银行信用卡、单位多功能卡的合一。
2　问题描述
2.1　实时过程控制的特点
　　与通常的数据库管理系统中的数据（如商场购物数据，银行储蓄、贷款数据等）相比，生产过程中产生的数据有着明显的特点，主要表现在以下几个方面：
　　重复性　生产过程一般是一批一批地生产产品的，设备运转具有明显的周期性，若数据采集是按一定的时间间隔进行，则每周期采集的数据量是一定的。
蔡庆生　教授，博士研究生导师。但由于持卡人的资金需要在二系统之间拨付，涉及银行事务，所以对使用单位的设计者和承建人的技术水平有极高的要求，也需要参与的银行积极配合。
2.2　自主的校园IC卡应用系统设计要点
　　“自主的校园IC卡应用系统”指上节中的第二种建设方案或途径。以下我们总是限定在这种意义下来讨论，并简称其为“IC卡系统”，包括单用途的就餐卡和多功能的“一卡通”系统。根据我们的经验，需要注意解决如下问题。
　　系统总体设计者的遴选　应当委托有经验的专家与使用部门负责人一块进行，也可移植改造兄弟单位已经证明是成功的系统。在没有总体设计的情况下盲目实施系统建设，将会带来烦恼和隐患。
　　明确系统运行环境　最重要的是对“实时全联网”或“可离线”环境条件的认定。对于单用途的就餐卡系统，可以设计为“实时全联网”支付系统；但是对于多功能的“一卡通”系统，设计为“实时全联网”系统是很不现实的，因为目前一般单位内部的网络系统还很难实现全年无故障运行。
　　明确子系统管理者的使用要求　特别是涉及安全的使用要求。比如，提款和高额购物支付要求持卡人提供口令（PASSWORD）；而对于就餐时间十分集中的大学食堂，这种要求通常是服务员和就餐者双方都无法忍受的。不同子系统的不同需求，决定了系统的安全设计框架和安全风险控制策略。
　　系统防攻击的安全设计　主要包括发卡子系统的安全，收费、加费与结算子系统的安全、IC卡防篡改的安全。
　　系统防软硬件故障的安全设计　比如，如何应付在任一时刻发生的IC卡物理损坏或停电，如何保护集中的与分散的底帐数据（库）。在这一领域中，目前已有了大量的知识发现算法，大部分算法都能从数据库中发现有效的知识，由于算法的设计目标是从各种类型的大中型数据库中挖掘知识，具有一定的通用性，但算法效率较低，难以满足工业生产过程中的实时性要求，很难直接用于实时过程控制中。研究方向：人工智能、知识发现。
3.1　系统设计目标
3.1.1　系统总目标
　　本系统总目标是：一卡覆盖全校主要管理和消费应用，并支持持卡人长期使用（从本科到博士毕业留校任教）。目前考虑的应用包括：校内银行、上机管理、教务学籍管理、图书借阅、校医院医疗卡（同时具有急救信息卡功能）、游泳馆管理子系统、校内(小额)消费购物支付、科研经费管理、校宾馆客人的消费结算等。
3.1.2　系统近期目标
　　明确系统的近期目标是必要的。根据最紧迫的需求，一般可对系统的近期目标作如下设计：
　　上机管理；校图书馆图书借阅；校医院就诊与付费。
3.2　系统安全设计
　　校园IC卡系统或企业IC卡系统的安全设计是至关重要而又常常被一般设计者忽视的问题(我们在设计本系统之前, 曾分析了某些校园食堂IC卡系统,并指出了其中存在的不少安全方面的漏洞和隐患)。信任度指此k子序列的支持度与i子序列St1,St2,…,Sti的支持度的比值。
3.2.1　系统安全设计目标
　　按子系统不同需求的分级安全保护: 如校内银行应用子系统按银行信用卡系统要求保护；
　　系统的小额消费在联网与不联网情况下均能够安全进行，并能实时或在事后实施安全的结算；
　　最大限度地减小系统经营者和系统用户的风险。
3.2.2　系统的主要安全技术措施
　　多级的密钥与口令管理；
　　按不同子系统安全需求的多种密码保护;
　　实现支持联网与不联网小额支付应用的用户消费余额底帐；
　　利用小额消费限额控制风险的运行管理；
　　用户卡的挂失与消费余额认定, “黑名单”的发布与 “灰名单”（指可能被系统的攻击者操作过的卡片名单）的跟踪。
　　下图描述了西南交大校园卡′96系统的总体功能模块设计。

系统总体功能模块图
4　校园IC卡应用系统的建设实施
4.1　系统构成
4．1．1　硬件构成
　　校园IC卡, 存放数据信息，代码和储值等。信任度指此k子序列的支持度与i子序列St1,St2,…,Sti的支持度的比值。
　　终端系统, 负责完成管理员或用户与系统的人机交互，实现读取卡中的信息以及向卡中写入信息,并输出相关信息和控制信号。
　　读／写卡器, 是IC卡与系统进行数据交换的媒介。
4．1.2　软件构成
　　软件平台
　　网络操作系统　如采用NOVELL公司的NETWARE 4.11。
　　汉字系统　如采用UCDOS 5.0网络版。
　　数据库系统　如采用Visual FoxPro 3.0 。
　　应用系统软件
　　本应用系统软件由两部分组成：
　　a) 读卡器上层软件系统
　　用BORLAND C++3.1开发，分别以DOS下的C函数和Windows下的动态连接库的形式透明的向用户提供低层调用接口。
　　工业生产过程控制是很特殊的一个领域，计算机在其中多数起着数据采集、状态监测和实时控制的作用，这一过程中同样会产生大量的实时采集数据（如电流、电压、温度、气压、流量、电机转速、开关量等），人工一般是很难理解这些数据及其关系的，更不用说及时地总结并进行预测了，如果能让计算机自动实时地从产生的数据中抽取知识或规则，并利用获得的知识对即将进行的过程进行估计预测，或根据已获得的知识对发生偏离的过程进行实时纠正，那么将会收到更加良好的效果。
　　b) 网络管理系统软件
　　它由以下几个功能模块组成：校园IC卡发放系统 、校园IC卡结算管理系统、校园IC卡挂失管理系统（黑名单库）、学生上机统计管理系统、图书馆借阅管理系统（开发中，照片及条码已准备就绪）、校医院收费系统（血型等部分健康数据已准备）、学生学籍档案管理系统（待开发）、教师档案管理系统（未开发）、教职工工资管理系统（未开发）等。
4.2　应用系统数据编码原则
　　应用系统数据编码是信息系统的一项重要基础工作，也是校园IC卡系统正常运转的基本保证。根据该系统的实际需求，并结合学校现有的代码规范，我们制定出一套编码方案。
　　再设序列集S={S1,S2,．．．,Sv}，其中Si={Sti1 U {c1},Sti2 U {c2}，…，Stip U {cp},…,Stik U {ck}},1≤i≤v，1≤p≤k，其中，cp为子序列{Sti1,Sti2,…,Stip}在D中重复的总次数。信任度指此k子序列的支持度与i子序列St1,St2,…,Sti的支持度的比值。
　　数据编码要具有唯一性，以及可维护性。
注：本文研究得到国家自然科学基金资助。
4.3　数据结构与编码方案
　　以ATMEL公司的AT88SC1604型IC卡为例。AT88SC1604型IC卡是具有16KBIT存储容量的保密逻辑卡，它有四个主要应用数据区。根据不同的应用需求，我们为各区设计了相应的数据结构。其中AZ1区为校银行应用区，该区读写均需口令，故安全性最好；AZ2区为上机收费及小额消费区，它是条件读写区；AZ3区是公开档案区，在通过了卡的主口令检查认可之后, 是无条件可读的；AZ4区被用做经费注入的备份记录区。
　　. 状态比较函数(compare)，根据具体领域而定义的一个判别两个范例序列中相应位置的两个状态值集是否相似的函数，通过此函数，可依次比较两序列中相应项是否均相似来判断两个序列是否相似，此函数返回值为-1，0或1，分别表示<，=，>。新IC卡采用单面定制（校园风景照）与单面个人化的形式，后者的数据包括卡号、持卡人单位、姓名、血型、借书证条码（39码）和持卡人免冠彩色头像（均由专用打卡机打印在IC卡上）。这为IC 卡在图书馆和校医院的使用奠定了坚实的基础。
4.3.2　发行区数据结构与编码
　　发行区数据为8字节，具有唯一标识多功能校园卡用户的功能。为了说明方便，再定义有关概念如下：
　　. 范例数(case―number),指D中的序列（范例）总个数。其中, 持卡人标识码采用身份证号的压缩变形。
4.3.3　公开档案区数据结构与编码
　　以下描述了公开档案区AZ3的数据结构（自1996年西南交大校园IC卡发行起即采用，由此奠定了该系统的多功能特性）：
　　RW控制字、发行卡号、身份证ID(对于未成年无身份证者，参照身份证号码编码原则编制代用身份号，同时对该卡加以特殊标记)、学号／工作证号、姓名(其间出现的生僻汉字用汉语拼音标注)、单位(采用变长子字段设计以节约存储，加速检索)、(单位/专业)代码、性别、民族、政治面貌、婚否、分类码、入学(工作)、借书证号(图书馆条码)、照片存储地址、现住址、家庭所在地、乘车区间、籍贯、学生类型、血型/身高/体重、危急症/过敏症、医疗证号、游泳证号及体检记录、日消费限额、AZ1用户进入口令(密文形式)、AZ1加密算法与参数(密文形式)、发卡时间、更新时间、发卡或更新操作员代码、本区校验算法参数(密文形式)、本区校验码、特殊标记(对未办理身份证者加以标记并特殊处理)
4.4　相关读写设备的选型或研制
　　根据我们的经验，IC卡读写设备的质量和可靠性是系统成败的关键因素之一。本文将根据这一领域的特殊情况，提出一种实时有效的自动数据挖掘算法，以便使计算机能在实时过程控制中自动挖掘，并根据挖掘的结果进行趋势预测。自1997年底起，西南交大校园IC卡系统全部改用西南交大计算机安全与通信保密研究所（CSCSI）自行研制的CSCSI-1型读写卡器。为了说明方便，再定义有关概念如下：
　　. 范例数(case―number),指D中的序列（范例）总个数。
　　在PC机上对CSCSI―1型读卡器进行性能指标测试，试验所用的PC机配置为486/1OOMHz，ISA总线，8M内存。测试对象是AT88SC1604卡从1749字节开始的20个字节。测试按PC串口通信波特率分为两组，一组的波特率为19200，另一组的波特率为9600。每组又分为两种情况，一种“写”是指将这20个字节的内容由全FF写成全00，另一种“写”是将这20个字节的内容由全FF写成0F。实验所得数据如表1所示（单位：毫秒）。
　　高校计算机上机管理收费IC卡系统的一个关键技术指标是每一用户卡的平均处理时间。有时, 此项指标甚至是应用系统成败的关键。据我们所知,CSCSI―1型读卡器的读写速度高于若干市售的同类产品。使用CSCSI―1型读卡器, 上机管理收费IC卡系统的用户卡平均处理时间可做到两秒左右。
表1　CSCSI―1型读卡器读写速度

Baud“写”内容读写擦擦写擦写读
19200FF→001091098120812081318
　FF→0F109604714714879
9600FF→001091098120812081318
　FF→0F109604714714879


5　结束语
　　校园IC卡系统是第一作者多年的梦想, 曾反映在1990年与王育民合著的《保密学―基础与应用》一书的封面设计中。 经过三年的实践，我校完成了全国首批多功能校园卡之一 ――西南交大校园卡′96系统的第一阶段建设，个别子系统还通过了省教委的正式鉴定。通过实践, 我们认识到多功能校园IC卡系统是一个需要长期建设、经营, 不断完善其功能与性能的应用系统。S′本质上是D的一个投影，Si′={Sti1,Sti2,…,Stim}。
作者简介：何大可　教授。
　　. 最低信任度(min―confidence),用户给定的值，某规则的信任度必须大于此值方可视为有效规则，有效规则可用来预测未来趋势。
李晓航　硕士。主要从事密码学、IC卡应用研究、计算机软件开发工作。
饶伟　硕士。我们曾多次参与实时过程中的数据采集及控制软件的开发，在受到基于范例推理CBR(Case Based Reasoning）方法［1］及KDD中序列模式发现(Sequential Pattern Mining)［2］［3］［4］［5］的启发下,考虑到实时过程控制中的特殊性，给出了实时过程控制中的数据挖掘算法DMRP(Data Mining in Real-time Processing)。
作者单位：西南交通大学计算机安全与通信保密研究所　四川.成都（610031 )
参考文献
［1］　王育民，何大可.保密学――基础与应用.西安：西安电子科技大学出版社，1990
［2］　何大可,等.多功能校园卡――IC卡应用系统实例.密码学进展――CHINACRYPT′98. 北京：科学出版社，1998
收稿日期:1999-06-02(修改稿)
